/*!
 * v0.1.5
 * Copyright (c) 2014 First Opinion
 * formatter.js is open sourced under the MIT license.
 *
 * thanks to digitalBush/jquery.maskedinput for some of the trickier
 * keycode handling
 */
(function(a,b){if(typeof define==="function"&&define.amd){define(["jQuery"],b)}else{if(typeof exports==="object"){b(require("jQuery"))}else{b(a.jQuery)}}}(this,function(f){var e=function(){var j={};var i=4;var h=new RegExp("{{([^}]+)}}","g");var k=function(n){var m=[],l;while(l=h.exec(n)){m.push(l)}return m};j.parse=function(q){var s={inpts:{},chars:{}};var p=k(q),m=q.length;var o=0,r=0,n=0;var l=function(v){var u=v.length;for(var t=0;t<u;t++){s.inpts[r]=v.charAt(t);r++}o++;n+=v.length+i-1};for(n;n<m;n++){if(o<p.length&&n===p[o].index){l(p[o][1])}else{s.chars[n-o*i]=q.charAt(n)}}s.mLength=n-o*i;return s};return j}();var a=function(){var h={};var i=typeof navigator!=="undefined"?navigator.userAgent:null;h.extend=function(j){for(var l=1;l<arguments.length;l++){for(var k in arguments[l]){j[k]=arguments[l][k]}}return j};h.addChars=function(k,j,l){return k.substr(0,l)+j+k.substr(l,k.length)};h.removeChars=function(k,l,j){return k.substr(0,l)+k.substr(j,k.length)};h.isBetween=function(j,k){k.sort(function(m,l){return m-l});return j>k[0]&&j<k[1]};h.addListener=function(l,j,k){return typeof l.addEventListener!=="undefined"?l.addEventListener(j,k,false):l.attachEvent("on"+j,k)};h.preventDefault=function(j){return j.preventDefault?j.preventDefault():j.returnValue=false};h.getClip=function(j){if(j.clipboardData){return j.clipboardData.getData("Text")}if(window.clipboardData){return window.clipboardData.getData("Text")}};h.getMatchingKey=function(o,n,m){for(var j in m){var l=m[j];if(o===l.which&&n===l.keyCode){return j}}};h.isDelKeyDown=function(l,k){var j={backspace:{which:8,keyCode:8},"delete":{which:46,keyCode:46}};return h.getMatchingKey(l,k,j)};h.isDelKeyPress=function(l,k){var j={backspace:{which:8,keyCode:8,shiftKey:false},"delete":{which:0,keyCode:46}};return h.getMatchingKey(l,k,j)};h.isSpecialKeyPress=function(l,k){var j={tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}};return h.getMatchingKey(l,k,j)};h.isModifier=function(j){return j.ctrlKey||j.altKey||j.metaKey};h.forEach=function(n,o,k){if(n.hasOwnProperty("length")){for(var l=0,j=n.length;l<j;l++){if(o.call(k,n[l],l,n)===false){break}}}else{for(var m in n){if(n.hasOwnProperty(m)){if(o.call(k,n[m],m,n)===false){break}}}}};return h}();var b=function(k,h){var j=function(l){if(l==="*"){return/.*/}return new RegExp(l)};function i(n){var l=[],m=[];h.forEach(n,function(p){h.forEach(p,function(t,s){var r=k.parse(t),q=j(s);l.push(q);m.push(r);return false})});var o=function(p){var q;h.forEach(l,function(s,r){if(s.test(p)){q=r;return false}});return q===undefined?null:m[q]};return{getPattern:o,patterns:m,matchers:l}}return i}(e,a);var g=function(){var h={};h.get=function(j){if(typeof j.selectionStart==="number"){return{begin:j.selectionStart,end:j.selectionEnd}}var i=document.selection.createRange();if(i&&i.parentElement()===j){var m=j.createTextRange(),l=j.createTextRange(),k=j.value.length;m.moveToBookmark(i.getBookmark());l.collapse(false);if(m.compareEndPoints("StartToEnd",l)>-1){return{begin:k,end:k}}return{begin:-m.moveStart("character",-k),end:-m.moveEnd("character",-k)}}return{begin:0,end:0}};h.set=function(j,k){if(typeof k!=="object"){k={begin:k,end:k}}if(j.setSelectionRange){j.focus();j.setSelectionRange(k.begin,k.end)}else{if(j.createTextRange){var i=j.createTextRange();i.collapse(true);i.moveEnd("character",k.end);i.moveStart("character",k.begin);i.select()}}};return h}();var c=function(j,m,i){var l={persistent:false,repeat:false,placeholder:" "};var h={"9":/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};function k(o,p){var n=this;n.el=o;if(!n.el){throw new TypeError("Must provide an existing element")}n.opts=i.extend({},l,p);if(typeof n.opts.pattern!=="undefined"){n.opts.patterns=n._specFromSinglePattern(n.opts.pattern);delete n.opts.pattern}if(typeof n.opts.patterns==="undefined"){throw new TypeError("Must provide a pattern or array of patterns")}n.patternMatcher=j(n.opts.patterns);n._updatePattern();n.hldrs={};n.focus=0;i.addListener(n.el,"keydown",function(q){n._keyDown(q)});i.addListener(n.el,"keypress",function(q){n._keyPress(q)});i.addListener(n.el,"paste",function(q){n._paste(q)});if(n.opts.persistent){n._processKey("",false);n.el.blur();i.addListener(n.el,"focus",function(q){n._focus(q)});i.addListener(n.el,"click",function(q){n._focus(q)});i.addListener(n.el,"touchstart",function(q){n._focus(q)})}}k.addInptType=function(o,n){h[o]=n};k.prototype.resetPattern=function(o){this.opts.patterns=o?this._specFromSinglePattern(o):this.opts.patterns;this.sel=m.get(this.el);this.val=this.el.value;this.delta=0;this._removeChars();this.patternMatcher=j(this.opts.patterns);var n=this.patternMatcher.getPattern(this.val);this.mLength=n.mLength;this.chars=n.chars;this.inpts=n.inpts;this._processKey("",false,true)};k.prototype._updatePattern=function(){var n=this.patternMatcher.getPattern(this.val);if(n){this.mLength=n.mLength;this.chars=n.chars;this.inpts=n.inpts}};k.prototype._keyDown=function(n){var o=n.which||n.keyCode;if(o&&i.isDelKeyDown(n.which,n.keyCode)){this._processKey(null,o);return i.preventDefault(n)}};k.prototype._keyPress=function(n){var o,p;o=n.which||n.keyCode;p=i.isSpecialKeyPress(n.which,n.keyCode);if(!i.isDelKeyPress(n.which,n.keyCode)&&!p&&!i.isModifier(n)){this._processKey(String.fromCharCode(o),false);return i.preventDefault(n)}};k.prototype._paste=function(n){this._processKey(i.getClip(n),false);return i.preventDefault(n)};k.prototype._focus=function(){var n=this;setTimeout(function(){var o=m.get(n.el);var q=o.end>n.focus,p=o.end===0;if(q||p){m.set(n.el,n.focus)}},0)};k.prototype._processKey=function(o,p,n){this.sel=m.get(this.el);this.val=this.el.value;this.delta=0;if(this.sel.begin!==this.sel.end){this.delta=-1*Math.abs(this.sel.begin-this.sel.end);this.val=i.removeChars(this.val,this.sel.begin,this.sel.end)}else{if(p&&p===46){this._delete()}else{if(p&&this.sel.begin-1>=0){this.val=i.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta-=1}else{if(p){return true}}}}if(!p){this.val=i.addChars(this.val,o,this.sel.begin);this.delta+=o.length}this._formatValue(n)};k.prototype._delete=function(){while(this.chars[this.sel.begin]){this._nextPos()}if(this.sel.begin<this.val.length){this._nextPos();this.val=i.removeChars(this.val,this.sel.end-1,this.sel.end);this.delta=-1}};k.prototype._nextPos=function(){this.sel.end++;this.sel.begin++};k.prototype._formatValue=function(n){this.newPos=this.sel.end+this.delta;this._removeChars();this._updatePattern();this._validateInpts();this._addChars();this.el.value=this.val.substr(0,this.mLength);if(typeof n==="undefined"||n===false){m.set(this.el,this.newPos)}};k.prototype._removeChars=function(){if(this.sel.end>this.focus){this.delta+=this.sel.end-this.focus}var o=0;for(var q=0;q<=this.mLength;q++){var p=this.chars[q],n=this.hldrs[q],s=q+o,r;s=q>=this.sel.begin?s+this.delta:s;r=this.val.charAt(s);if(p&&p===r||n&&n===r){this.val=i.removeChars(this.val,s,s+1);o--}}this.hldrs={};this.focus=this.val.length};k.prototype._validateInpts=function(){for(var q=0;q<this.val.length;q++){var p=this.inpts[q];var r=!h[p],o=!r&&!h[p].test(this.val.charAt(q)),n=this.inpts[q];if((r||o)&&n){this.val=i.removeChars(this.val,q,q+1);this.focusStart--;this.newPos--;this.delta--;q--}}};k.prototype._addChars=function(){if(this.opts.persistent){for(var o=0;o<=this.mLength;o++){if(!this.val.charAt(o)){this.val=i.addChars(this.val,this.opts.placeholder,o);this.hldrs[o]=this.opts.placeholder}this._addChar(o)}while(this.chars[this.focus]){this.focus++}}else{for(var n=0;n<=this.val.length;n++){if(this.delta<=0&&n===this.focus){return true}this._addChar(n)}}};k.prototype._addChar=function(n){var o=this.chars[n];if(!o){return true}if(i.isBetween(n,[this.sel.begin-1,this.newPos+1])){this.newPos++;this.delta++}if(n<=this.focus){this.focus++}if(this.hldrs[n]){delete this.hldrs[n];this.hldrs[n+1]=this.opts.placeholder}this.val=i.addChars(this.val,o,n)};k.prototype._specFromSinglePattern=function(n){return[{"*":n}]};return k}(b,g,a);var d="formatter";$.fn[d]=function(h){if(typeof h=="object"){this.each(function(){if(!$.data(this,"plugin_"+d)){$.data(this,"plugin_"+d,new c(this,h))}})}this.resetPattern=function(i){this.each(function(){var j=$.data(this,"plugin_"+d);if(j){j.resetPattern(i)}});return this};return this};$.fn[d].addInptType=function(h,i){c.addInptType(h,i)}}));