(function(d){var a=new Array();var c=new Array();d.fn.doAutosize=function(j){var g=d(this).data("minwidth"),q=d(this).data("maxwidth"),l="",p=d(this),k=d("#"+d(this).data("tester_id"));if(l===(l=p.val())){return}var f=l.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");k.html(f);var n=k.width(),m=(n+j.comfortZone)>=g?n+j.comfortZone:g,h=p.width(),e=(m<h&&m>=g)||(m>g&&m<q);if(e){p.width(m)}};d.fn.resetAutosize=function(g){var j=d(this).data("minwidth")||g.minInputWidth||d(this).width(),k=d(this).data("maxwidth")||g.maxInputWidth||(d(this).closest(".tagsinput").width()-g.inputPadding),l="",f=d(this),h=d("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:f.css("fontSize"),fontFamily:f.css("fontFamily"),fontWeight:f.css("fontWeight"),letterSpacing:f.css("letterSpacing"),whiteSpace:"nowrap"}),e=d(this).attr("id")+"_autosize_tester";if(!d("#"+e).length>0){h.attr("id",e);h.appendTo("body")}f.data("minwidth",j);f.data("maxwidth",k);f.data("tester_id",e);f.css("width",j)};d.fn.addTag=function(f,e){e=jQuery.extend({focus:false,callback:true},e);this.each(function(){var l=d(this).attr("id");var g=d(this).val().split(a[l]);if(g[0]==""){g=new Array()}f=jQuery.trim(f);if(e.unique){var h=d(this).tagExist(f);if(h==true){d("#"+l+"_tag").addClass("not_valid").tooltip({type:"danger",position:"bottom auto",title:"该标记已存在"})}}else{var h=false}if(f!=""&&h!=true){d("<span>").addClass("tag").append(d("<span>").text(f).attr("title",f),d("<a>",{href:"#",title:"删除标签",text:"x"}).addClass("remove-btn").click(function(){var m=d(this).parent().index();return d("#"+l).removeTagByIndex(m)})).insertBefore("#"+l+"_addTag");g.push(f);d("#"+l+"_tag").val("");if(e.focus){d("#"+l+"_tag").focus()}else{d("#"+l+"_tag").blur()}d.fn.tagsInput.updateTagsField(this,g);if(e.callback&&c[l]&&c[l]["onAddTag"]){var k=c[l]["onAddTag"];k.call(this,f)}if(e.callback&&c[l]&&c[l]["onChange"]){var j=g.length;var k=c[l]["onChange"];k.call(this,d(this),g[j-1])}}});return false};d.fn.removeTag=function(e){e=unescape(e);this.each(function(){if(d(this).data("options").disabled){return}var j=d(this).attr("id");var g=d(this).val().split(a[j]);d("#"+j+"_tagsinput .tag").remove();str="";for(i=0;i<g.length;i++){if(g[i]!=e){str=str+a[j]+g[i]}}d.fn.tagsInput.importTags(this,str);if(c[j]&&c[j]["onRemoveTag"]){var h=c[j]["onRemoveTag"];h.call(this,e)}});return false};d.fn.removeTagByIndex=function(e){this.each(function(){if(d(this).data("options").disabled){return}var k=d(this).attr("id");var g=d(this).val().split(a[k]);var j=g.splice(e,1);d("#"+k+"_tagsinput .tag").remove();str=g.join(a[k]);d.fn.tagsInput.importTags(this,str);if(c[k]&&c[k]["onRemoveTag"]){var h=c[k]["onRemoveTag"];h.call(this,j)}});return false};d.fn.tagExist=function(f){var g=d(this).attr("id");var e=d(this).val().split(a[g]);return(jQuery.inArray(f,e)>=0)};d.fn.importTags=function(e){var f=d(this).attr("id");d("#"+f+"_tagsinput .tag").remove();d.fn.tagsInput.importTags(this,e)};d.fn.setDisabled=function(e){d.fn.tagsInput.setDisabled(this,e)};d.fn.tagsInput=function(e){var g=jQuery.extend({interactive:true,defaultText:"回车添加标签",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},hide:true,delimiter:",",unique:true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2,disabled:false},e);var f=0;this.each(function(){if(typeof d(this).attr("data-tagsinput-init")!=="undefined"){return}d(this).data("options",g);d(this).attr("data-tagsinput-init",true);if(g.hide){d(this).hide()}var l=d(this).attr("id");if(!l||a[d(this).attr("id")]){l=d(this).attr("id","tags"+new Date().getTime()+(f++)).attr("id")}var k=jQuery.extend({pid:l,real_input:"#"+l,holder:"#"+l+"_tagsinput",input_wrapper:"#"+l+"_addTag",fake_input:"#"+l+"_tag"},g);a[l]=k.delimiter;if(g.onAddTag||g.onRemoveTag||g.onChange){c[l]=new Array();c[l]["onAddTag"]=g.onAddTag;c[l]["onRemoveTag"]=g.onRemoveTag;c[l]["onChange"]=g.onChange}var h='<div id="'+l+'_tagsinput" class="tagsinput"><div id="'+l+'_addTag">';if(g.interactive){h=h+'<input id="'+l+'_tag" value="" data-default="'+g.defaultText+'" />'}h=h+'</div><div class="tags_clear"></div></div>';var j=d(h).insertAfter(this);if(g.disabled){j.addClass("disabled").find("input").prop("disabled",true)}if(d(k.real_input).val()!=""){d.fn.tagsInput.importTags(d(k.real_input),d(k.real_input).val())}if(g.interactive){d(k.fake_input).val(d(k.fake_input).attr("data-default"));d(k.fake_input).css("color",g.placeholderColor);d(k.fake_input).resetAutosize(g);d(k.holder).bind("click",k,function(m){if(g.disabled){return}d(m.data.fake_input).focus()});d(k.fake_input).bind("focus",k,function(m){if(g.disabled){return}if(d(m.data.fake_input).val()==d(m.data.fake_input).attr("data-default")){d(m.data.fake_input).val("")}d(m.data.fake_input).css("color","#000000")});if(g.autocomplete_url!=undefined){autocomplete_options={source:g.autocomplete_url};for(attrname in g.autocomplete){autocomplete_options[attrname]=g.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){d(k.fake_input).autocomplete(g.autocomplete_url,g.autocomplete);d(k.fake_input).bind("result",k,function(m,o,n){if(o){d("#"+l).addTag(o[0]+"",{focus:true,unique:(g.unique)})}})}else{if(jQuery.ui.autocomplete!==undefined){d(k.fake_input).autocomplete(autocomplete_options);d(k.fake_input).bind("autocompleteselect",k,function(m,n){d(m.data.real_input).addTag(n.item.value,{focus:true,unique:(g.unique)});return false})}}}else{d(k.fake_input).bind("blur",k,function(m){var n=d(this).attr("data-default");if(d(m.data.fake_input).val()!=""&&d(m.data.fake_input).val()!=n){if((m.data.minChars<=d(m.data.fake_input).val().length)&&(!m.data.maxChars||(m.data.maxChars>=d(m.data.fake_input).val().length))){d(m.data.real_input).addTag(d(m.data.fake_input).val(),{focus:true,unique:(g.unique)})}}else{d(m.data.fake_input).val(d(m.data.fake_input).attr("data-default"));d(m.data.fake_input).css("color",g.placeholderColor)}return false})}d(k.fake_input).bind("keypress",k,function(m){if(b(m)){m.preventDefault();if((m.data.minChars<=d(m.data.fake_input).val().length)&&(!m.data.maxChars||(m.data.maxChars>=d(m.data.fake_input).val().length))){d(m.data.real_input).addTag(d(m.data.fake_input).val(),{focus:true,unique:(g.unique)})}d(m.data.fake_input).resetAutosize(g);return false}else{if(m.data.autosize){d(m.data.fake_input).doAutosize(g)}}});if(g.delimiter!=","){d(k.fake_input).on("input",function(){d(this).val(d(this).val().replaceAll(g.delimiter,""))})}k.removeWithBackspace&&d(k.fake_input).bind("keydown",function(n){if(n.keyCode==8&&d(this).val()==""){n.preventDefault();var m=d(this).closest(".tagsinput").find(".tag:last").index();d("#"+l).removeTagByIndex(m);d(this).trigger("focus")}});d(k.fake_input).blur();if(k.unique){d(k.fake_input).keydown(function(m){if(m.keyCode==8||String.fromCharCode(m.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){d(this).removeClass("not_valid").tooltip("destroy")}})}}});return this};d.fn.tagsInput.updateTagsField=function(f,e){var g=d(f).attr("id");d(f).val(e.join(a[g]))};d.fn.tagsInput.importTags=function(h,j){d(h).val("");var k=d(h).attr("id");var e=j.split(a[k]);for(i=0;i<e.length;i++){d(h).addTag(e[i],{focus:false,callback:false})}if(c[k]&&c[k]["onChange"]){var g=c[k]["onChange"];g.call(h,h,e[i])}};d.fn.tagsInput.setDisabled=function(f,e){d(f).data("options").disabled=e;d(f).next().toggleClass("disabled",e).find("input").prop("disabled",e)};var b=function(e){var f=false;if(e.which==13){return true}if(typeof e.data.delimiter==="string"){if(e.which==e.data.delimiter.charCodeAt(0)){f=true}}else{d.each(e.data.delimiter,function(h,g){if(e.which==g.charCodeAt(0)){f=true}})}return f}})(jQuery);