!function(d){if(typeof jQuery==="undefined"){throw new Error("ezui requires jQuery")}window.get=function(h,g){var f=null;if(h instanceof c){f=h.$elem}else{if(typeof h=="string"){f=d("#"+h,g)}else{f=d(h)}}return f.data(d.fn.baseTag.keyName)};window.onbeforeunload=function(){return TagUtils.isFormModify(document)};d.parser={parse:function(f,h){var g=d("[data-toggle]",h||f&&f.page);g.each(function(){var i=d(this).data();if(i.toggle&&d(this)[i.toggle]){if(f){i.pageProxy=f}if(HtmlTag.hasProxyData()){var l={};for(var j in i){var k=i[j];if(j.lastIndexOf("_proxy")>-1){k=HtmlTag.getProxyValue(k);j=j.replace("_proxy","")}l[j]=k}i=l}d(this)[i.toggle](i)}})}};d.fn.changeClass=function(f,g){d(this).removeClass(f);d(this).addClass(g)};d(function(){d.parser.parse()});d.pageProxy=Class.extend({init:function(g,f){this.page=g;this.parent=f;this.id="proxy_"+d.pageProxy.index++;d.pageProxy.proxyMap[this.id]=this;this.pageReady=null;this.jQueryReady=null;this.registerFunc=[];this.hasParsed=false},getFnProxy:function(h,g){var f=this.jQueryProxy(g);return f&&f[h]?f:(d.pageProxy.funcMap[h]?d.pageProxy.funcMap:window)},jQueryProxy:function(f){return get(f)?get(f).opts.pageProxy:this},addPageReady:function(f){if(this.hasParsed){f.call(document);return}if(!this.pageReady){this.pageReady=d.Callbacks("once")}this.pageReady.add(f)},execPageReady:function(){if(this.pageReady){var f=this.pageReady;this.pageReady=null;f.fire()}},execJQueryReady:function(){if(this.jQueryReady){var f=this.jQueryReady;this.jQueryReady=null;f.fire()}},$:function(){var f=arguments[0];if(typeof f=="function"){if(!this.jQueryReady){this.jQueryReady=d.Callbacks("once")}this.jQueryReady.add(f)}else{if(typeof f=="string"&&arguments.length==1&&f.indexOf("<")==-1){return d.pageProxy.util.find(f,this)}else{return d.apply(null,arguments)}}},get:function(k,h){var f=arguments;var g=k;var j=h;if(typeof k=="string"){f[0]="#"+k;f[0]=this.$.apply(this,f)}var i=get.apply(null,f);if(!i){i=get(g,j)}return i},openDialog:function(){return d.openDialog.apply(this,arguments)},register:function(g,f){this[g]=f;this.registerFunc.push(g);if(!window[g]){window[g]=f}else{d.pageProxy.funcMap[g]=f}},destroy:function(){var h=this.registerFunc;for(var f=0;f<h.length;f++){var g=this.registerFunc[f];if(d.pageProxy.funcMap[g]){delete d.pageProxy.funcMap[g]}else{if(window[g]==this[g]){delete window[g]}}}delete d.pageProxy.proxyMap[this.id]}});d.pageProxy.proxyMap={};d.pageProxy.funcMap={};d.pageProxy.index=0;d.pageProxy.util={find:function(f,g){var h=g?d(g.page).find(f):d(f);if(h.length==0&&g){return this.find(f,g.parent)}else{return h}},findFn:function(h,f){var g=null;if(f){g=f[h]?f[h]:(d.pageProxy.funcMap[h]||window[h])}else{g=window[h]}return g},findFnProxy:function(g,f){return f&&f[g]?("$.pageProxy.proxyMap."+f.id+"."):(d.pageProxy.funcMap[g]?"$.pageProxy.funcMap":"")},loadContent:function(g,j){if(!g.url||j.data("isLoading")){return}var f=j.data("pageProxy"),i=new Date().getTime();var h=d.extend({modal:false},g,{headers:{rtnType:"html"},onBeforeLoad:function(l){var k=true;if(f){if(TagUtils.isFormModify(j)){k=confirm("重新加载此网站？\n系统可能不会保存您所做的更改。")}}if(k){k=d.util.exec(g.onBeforeLoad,[l],g)}return k},onLoading:function(){if(!f){f=new d.pageProxy(j,g.pageProxy);j.data("pageProxy",f);g.pageProxy=f}d(document).data("context_data_map",{});var k=g.loadingText?"<p>"+g.loadingText+"</p>":"";j.data("token",i).html("<div class='spin-loading' style='padding-top:0'><i class='icon icon-spin icon-spinner icon-2x'></i>"+k+"</div>");d.util.exec(g.onLoading,null,g)},onLoadSuccess:function(t){if(i!=j.data("token")){return}var y=d.util.exec(g.onBeforeRender,[t],g);if(y===false){return}var x=/<script([^>]*?)>([\S\s]*?)<\/script>/img,p=/([^\w\.])(function\s+)?((\w+)\()/mg,w=/([^\w\.])((?:\$|get)\s*\()/mg,o=/\$\.openDialog\b/mg;var q=["alert","confirm","get","function","if","while","switch","catch","for"];var k=[],r=[],v=[];var u=t.replace(x,function(A,z,C){if(C){if(z.indexOf("noCompile")==-1){var B=C.replace(p,function(E,D,G,F,H){if(G){v.push(H);return E}else{if(q.contains(H)||(H.charAt(0)>"A"&&H.charAt(0)<"Z")){return E}else{return D+f.id+".getFnProxy('"+H+"', this)."+F}}});B=B.replace(w,function(E,F,D){return F+f.id+".jQueryProxy(this)."+D});B=B.replace(o,function(D){return f.id+".openDialog"});r.push(B)}else{r.push(C)}}else{k.push(A)}return""});var l=createTag("").append(u,false);l.append(k.join(""),false);var n=createTag("script");n.append("(function(){");n.append("\n    var "+f.id+" = $.pageProxy.proxyMap."+f.id+";\n");n.append(r.join(""));if(v.length){for(var s=0;s<v.length;s++){var m=v[s];n.append("\n    "+f.id+".register('"+m+"', "+m+");")}}n.append("\n})()");l.append(n);j.html(l.toString());f.hasParsed=false;d.parser.parse(f);f.hasParsed=true;f.execPageReady();f.execJQueryReady();d.util.exec(g.onLoadSuccess,[t],g);setTimeout(function(){var z=j.find("[data-jsp-path]").data("jspPath");z&&window.console&&console.log("当前jsp路径:"+z)},1000)},onLoadError:function(k){j.html(k.data);d.util.exec(g.onLoadError,[k],g)}});d.req(h)}};var a={};d.getContextData=function(g){var f=null;if(typeof g=="string"){g={key:g}}g=d.extend({async:false,modal:false},g);var i=g.onLoadSuccess;var h=g.key;g.url=new Url("sysCommon/getContextData","key",h);g.onLoadSuccess=function(j){if(j===false){f=a[h]}else{f=j;a[h]=j}i&&i.call(this,f)};d.req(g);return f};window.TagUtils={strToArray:function(f,g){if(!d.isArray(f)){if(typeof f=="number"){f+=""}if(f&&typeof f=="string"){f=f.split(g||",")}else{if(!d.isArray(f)){f=[]}}}return f},arrayToStr:function(f,g){return d.isArray(f)&&f.length>0?f.join(g||","):null},createButton:function(f){if(d.isArray(f)){var n=createTag("div").addClass("btn-group");for(var k=0;k<f.length;k++){TagUtils.createButton(f[k]).appendTo(n)}return n}if(!f.type){f.type="default";if(typeof f.outline=="undefined"){f.outline=true}}var g=d.extend({},d.fn.button.constructor.DEFAULTS,f);var j=createTag("button").attr("id",g.id).data("toggle","button").attr("type","button").addClass("ezui").addClass("btn").addClass(g.cls).css(g.style).css("height",g.height).css("width",g.width).attr("disabled",g.disabled).data("disabled",g.disabled).data("title",g.title).data("onClick",g.onClick);if(g.href){j.setName("a").attr("href",g.href).attr("target",g.target)}var m=g.type;if(g.outline){j.addClass("btn-outline-"+m);if(g.dashed){j.addClass("btn-dashed")}}else{j.addClass("btn-"+m)}if(g.size){j.addClass("btn-"+g.size)}if(g.hidden){j.addClass("hide")}if(typeof g.text!=="undefined"){createTag("span").append(g.text).appendTo(j)}if(g.iconCls){var l=this.createIcon(g.iconCls);if(!g.iconAlign||"left"==g.iconAlign){j.prepend(l)}else{j.append(l)}if(!g.text){j.addClass("icon-only")}}if(g.data){for(var h in g.data){j.data(h,g.data[h])}}if(g.attrs){for(var h in g.attrs){j.attr(h,g.attrs[h])}}return j},createIcon:function(f){if(typeof f=="string"){f={icon:f}}var g=createTag("i").addClass("icon").addClass(f.icon);if(f.cls){g.addClass(f.cls)}return g},createHref:function(g){if(typeof g=="string"){g={text:g}}var f=createTag("a").addClass(g.cls).css(g.style);if(typeof g.text!=="undefined"){if(g.textTag==false){f.append(g.text)}else{if(g.textTag){createTag(g.textTag).append(g.text).appendTo(f)}else{createTag("span").append(g.text).appendTo(f)}}}if(g.iconCls){if(g.iconAlign=="right"){this.createIcon(g.iconCls).appendTo(f)}else{this.createIcon(g.iconCls).prependTo(f)}}if(g.url){f.attr("href",g.url).attr("target",g.target)}else{var i=typeof g.onClick=="string"&&g.onClick.indexOf("(")>-1?sprintf("javascript:%s;",g.onClick):"javascript:;";f.attr("href",i)}if(g.data){for(var h in g.data){f.data(h,g.data[h])}}if(g.attrs){for(var h in g.attrs){f.attr(h,g.attrs[h])}}return f},createCheckbox:function(h){if(typeof h=="string"){h={text:h}}var k=h.type||"checkbox",j=h.disabled||false;var l=createTag("div").addClass("box-control").addClass(k).addClass("disabled",j).addClass(h.name).addClass(h.cls);var m=h.id;var f=createTag("input").attr("id",m).attr("name",h.name).attr("type",k).attr("value",h.value).attr("disabled",j).appendTo(l);if(h.checked){f.attr("checked",h.checked)}if(h.data){for(var i in h.data){f.data(i,h.data[i])}}if(h.attrs){for(var i in h.attrs){f.attr(i,h.attrs[i])}}var g=createTag("label").appendTo(l);if(typeof h.text!=="undefined"){createTag("span").append(h.text).appendTo(g)}return l},createRadio:function(f){if(typeof f=="string"){f={text:f}}f.type="radio";return this.createCheckbox(f)},createDropdown:function(f){var g=createTag(f.container||"div").addClass("dropdown").data("toggle","dropdown").addClass(f.cls).data("items",f.items).append(f.target).data("onClick",f.onClick);return g},createEmpty:function(f){f=d.extend({icon:"empty",description:"暂无数据"},f);var g=createTag("div").addClass("ez-empty").addClass(f.size,"ez-empty").addClass(f.cls);createTag("div").addClass("ez-empty-icon").append(this.createIcon("icon-"+f.icon)).appendTo(g);createTag("p").addClass("ez-empty-description").append(f.description).appendTo(g);if(f.content){createTag("div").addClass("ez-empty-footer").append(f.content).appendTo(g)}return g},hasScroll:function(h,j){var i=d(j);var g=j.style.overflowX;var f=j.style.overflowY;if(g===f&&(f==="hidden"||f==="visible")){return false}if(g==="scroll"||f==="scroll"){return true}return(i.innerHeight()<j.scrollHeight||i.innerWidth()<j.scrollWidth)},bindScrollEvent:function(f,h,i){var g=f.parentsUntil("body").filter(TagUtils.hasScroll);g.on("scroll."+h,i)},unbindScrollEvent:function(f,h){var g=f.parentsUntil("body").filter(TagUtils.hasScroll);g.off("scroll."+h,event)},isFormModify:function(h){var g=d(h).find("form:visible");var f=undefined;g.each(function(){var i=get(this);if(i&&i.isModify()){f=true;return false}});return f},transformToCollapsed:function(i,h,g){if(h){var j=i.parent(".pure-text-collapsed-container");if(!j.length&&i.innerHeight()>200){i.wrap('<div class="pure-text-collapsed-container"></div>');var f=createTag("div").addClass("pure-text-collapsed-button");TagUtils.createHref({text:"展示更多",iconCls:"icon-angle-down",iconAlign:"right"}).appendTo(f);i.after(f.toString());i.next(".pure-text-collapsed-button").find("a").on("click",function(){var k=d(this).closest(".pure-text-collapsed-container");k.replaceWith(i);if(g){g.options.collapsed=false}})}else{if(j.length&&i.innerHeight()<=200){j.replaceWith(i)}}}},createAvatar:function(g){var f=createTag("span").attr("id",g.id).addClass("ez-avatar").addClass(g.shape).addClass(g.type,"ez-avatar-").addClass(g.cls).append(g.text);var i;if(typeof g.size=="number"){i=g.size/2+"px";f.css("width",g.size).css("height",g.size).css("line-height",g.size).css("font-size",i)}else{f.addClass(g.size,"ez-avatar-")}if(g.icon){f.addClass("ez-avatar-icon");this.createIcon("icon-"+g.icon).css("font-size",i).appendTo(f)}if(g.src){f.addClass("ez-avatar-image");createTag("img").attr("src",g.src).attr("alt",g.alt).appendTo(f)}if(g.data){for(var h in g.data){f.data(h,g.data[h])}}if(g.attrs){for(var h in g.attrs){f.attr(h,g.attrs[h])}}return f},createBadge:function(h){var f=createTag("span").addClass("badge").addClass(h.cls);if(typeof h.text!=="undefined"&&h.dot){f.addClass("badge-status").addClass("badge-not-a-wrapper");createTag("span").addClass("badge-status-dot").appendTo(f);createTag("span").addClass("badge-status-text").append(h.text).appendTo(f)}else{if(typeof h.text!=="undefined"){f.addClass("badge-only-text").append(h.text)}else{f.append(h.content);var g=createTag("sup").appendTo(f);if(h.title){g.attr("title",h.title)}if(typeof h.count!=="undefined"){h.type="danger";g.addClass("scroll-number").addClass("badge-count");if(h.overflowCount&&h.count>h.overflowCount){g.append(h.overflowCount+"+")}else{g.append(h.count)}}else{if(h.dot){g.addClass("badge-dot")}}}}if(!h.type){if(h.dot){h.type="danger"}else{h.type="default"}}if(h.outline){f.addClass("badge-outline-"+h.type)}else{f.addClass("badge-"+h.type)}if(h.data){for(var i in h.data){f.data(i,h.data[i])}}return f},createTooltip:function(f){if(typeof f=="string"){f={title:f}}if(!f.position){f.position="bottom"}var g=createTag("div");if(f.content){g.addClass("tooltip-proxy").addClass(f.cls).data("toggle","tooltip").data("title",f.title).data("position",f.position).data("type",f.type).append(f.content)}else{g.attr("id",f.id).addClass("tooltip").addClass("statical").addClass(f.type).addClass(f.position);createTag("div").addClass("tooltip-arrow").appendTo(g);createTag("div").addClass("tooltip-inner").append(f.title).appendTo(g)}return g},createSwitch:function(g){var f=createTag("button").addClass("ez-switch").attr("id",g.id).addClass(g.cls).data("toggle","Switch").data("checked",g.checked);var h=createTag("span").addClass("ez-switch-inner").appendTo(f);if(g.size){f.addClass("ez-switch-"+g.size)}if(g.disabled){f.addClass("disabled")}if(g.checked){f.addClass("ez-switch-checked");if(g.checkedText){h.append(g.checkedText)}}else{if(g.unCheckedText){h.append(g.unCheckedText)}}if(g.onClick){f.data("onClick",g.onClick)}if(g.onChange){f.data("onChange",g.onChange)}return f},createStatistic:function(o){var i=createTag("div").addClass("ez-statistic").addClass(o.cls);if(o.title){createTag("div").addClass("ez-statistic-title").append(o.title).appendTo(i)}var j=createTag("div").addClass("ez-statistic-content").appendTo(i);if(o.prefix){createTag("span").addClass("ez-statistic-content-prefix").append(o.prefix).appendTo(j)}if(typeof o.value!=="undefined"){var l;var g=o.precision&&o.precision>0;if(g){l=NumberUtils.toFixed(o.value,o.precision)}else{l=parseInt(o.value)+""}var n=l+"",m="";var h=l.indexOf(".");if(h>=0){n=l.substring(0,h);m=l.substring(h+1,l.length)}var f=/(\d+)(\d{3})/;while(f.test(n)){n=n.replace(f,"$1,$2")}var k=createTag("span").addClass("ez-statistic-content-value").appendTo(j);createTag("span").addClass("ez-statistic-content-value-int").append(n).appendTo(k);if(g){createTag("span").addClass("ez-statistic-content-value-decimal").append("."+m).appendTo(k)}}if(o.suffix){createTag("span").addClass("ez-statistic-content-prefix").append(o.suffix).appendTo(j)}return i},createProgress:function(h){var g=createTag("div").addClass("ez-progress").addClass(h.cls);var l=createTag("div").addClass("ez-progress-bar").appendTo(g);if(h.series&&d.isArray(h.series)){for(var j=0;j<h.series.length;j++){var k=h.series[j];var f=createTag("div").addClass("ez-progress-bg").appendTo(l);if(k.type){f.addClass(k.type,"ez-progress-bg-")}if(k.percent){f.css("width",k.percent+"%")}}}else{if(h.percent){createTag("div").addClass("ez-progress-bg").css("width",h.percent+"%").appendTo(l);if(h.showInfo){createTag("span").addClass("ez-progress-text").append(h.percent+"%").appendTo(g)}}}return g},checkAuthorize:function(k){var j=this;var i=false;if(k){var h=JSON.stringify(k);var f=d("body").data("authorizeCache");if(f&&typeof f[h]!="undefined"){return f[h]}var g=new Url("sysPermission/authorize","authorize",k);d.req({url:g,async:false,onLoadSuccess:function(l){i=l;if(!f){f={}}f[h]=l;d("body").data("authorizeCache",f)}})}return i},validateDate:function(j,i,g,h){var k=null;if(j){var f=DatetimeUtils.formatJsonDate(j,h);i=DatetimeUtils.format(i,h);g=DatetimeUtils.format(g,h);if(i&&g){if(f<i||f>g){k=i==g?sprintf("请输入等于%s的日期",i):sprintf("请输入介于%s和%s之间的日期",i,g)}}else{if(i){if(f<i){k=sprintf("最小为%s",i)}}else{if(g){if(f>g){k=sprintf("最大为%s",g)}}}}}return k},validateNumber:function(i,g,f){var j=null;if(typeof i=="number"){var h=typeof f=="number";var k=typeof g=="number";if(h&&k){if(i<g||i>f){j=g==f?sprintf("请输入等于%s的数值",g):sprintf("请输入介于%s和%s之间的数值",g,f)}}else{if(h){if(i>f){j=sprintf("请输入小于等于%s的数值",f)}}else{if(k){if(i<g){j=sprintf("请输入大于等于%s的数值",g)}}}}}return j}};var c=Class.extend({init:function(i,g,j,k){this.elem=i;this.$elem=d(i);this.options=this.getOptions(g,j);this.opts=this.options;this.$elem.data(k,this);this.options.id=this.$elem.attr("id");if(!this.$elem.hasClass("ezui")){this.createTag()}this.initTag();var h=this.options.tooltip;if(h){delete this.options.tooltip;this.tooltip(h)}var f=this.options.popover;if(f){delete this.options.popover;this.popover(f)}},getOptions:function(f,g){return this.options?(d.extend({},this.options)):d.extend({},g,f)},getElem:function(){return this.$elem},createTag:function(){},exec:function(g,f){return d.util.exec(g,f,{context:this,pageProxy:this.opts.pageProxy})},getId:function(){return this.$elem.attr("id")||this.opts.tagId},req:function(g,f){var j=f||this.opts;var h=d.extend({async:true,modal:false,context:this,pageProxy:this.opts.pageProxy,url:j.url,onBeforeLoad:j.onBeforeLoad,onLoadSuccess:j.onLoadSuccess,onLoadError:j.onLoadError,onComplete:j.onComplete},g);var i=this;return d.req(h)},tooltip:function(f,g){this.getTooltipTarget().tooltip(f,g)},popover:function(f,g){this.getTooltipTarget().popover(f,g)},getTooltipTarget:function(){return this.$elem},addPageReady:function(f){if(this.options.pageProxy){this.options.pageProxy.addPageReady(f)}else{d(f)}}});d.fn.baseTag=function(h,j,g,i){var f=[];this.each(function(){var m=d(this);i=i||d.fn.baseTag.keyName;var l=m.data(i);if(!l){l=new g(this,h,g.DEFAULTS,i)}if(typeof h=="string"){var k=l[h](j);if(typeof k!="undefined"){f.push(k)}}});if(f.length>0){return f.length==1?f[0]:f}else{return this}};d.fn.baseTag.constructor=c;d.fn.baseTag.keyName="ez.ui";var e=c.extend({initTag:function(){this.initInputView();this.initValue(this.opts.value)},initInputView:function(){if(this.isPureText()){this.initInputViewText()}else{this.initInputViewEdit()}},initInputViewEdit:function(){},initInputViewText:function(){},getInput:function(){return this.$elem.find(".input-wrapper")},getValue:function(){return this.opts.value},getTypeValue:function(){return this.opts.value},setValue:function(g){var f=this.getTypeValue();g=this.trans2InpValue(g);if(this.isChange(g,f)){this.isModify=true;this.options.value=g;this.setViewValue(g);this.validate();this.change(g,f)}return this},initValue:function(g){g=this.trans2InpValue(g);if(this.isNull(g)){g=this.trans2InpValue(this.options.defaultValue)}this.originalValue=g;this.isModify=false;this.options.value=g;this.setViewValue(g);if(this.options.trigChangeInit&&this.isChange(g,this.trans2InpValue(null))){var f=this;this.addPageReady(function(){f.change(g,null)})}return this},setValueWithoutView:function(g){this.isModify=true;var f=this.getTypeValue();this.options.value=g;this.validate();this.change(g,f);return this},clear:function(){var g=this.trans2InpValue(null),f=this.getTypeValue();this.disableValidation();if(this.isChange(g,f)){this.isModify=true;this.options.value=g;this.setViewValue(this.options.value);this.change(g,f)}return this},reset:function(){var g=this.originalValue,f=this.getTypeValue();this.isModify=false;this.disableValidation();if(this.isChange(g,f)){this.options.value=g;this.setViewValue(g);this.change(g,f)}return this},isChange:function(g,f){return g!==f},trans2InpValue:function(f){return f},isNull:function(f){return f==null},setViewValue:function(f){if(this.opts.formatter){f=this.exec(this.opts.formatter,[f])}if(this.isPureText()){this.setTextValue(f)}else{this.setInputValue(f)}},setTextValue:function(f){if(!f){f="-"}if(this.options.escapeHtml){this.$elem.find(".input-text").text(f)}else{this.$elem.find(".input-text").html(f)}},setInputValue:function(f){},change:function(g,f){this.exec(this.opts.onChange,[g,f])},getText:function(){return this.getValue()},isPureText:function(){return this.opts.pureText},isReadonly:function(){return this.opts.readonly},setReadonly:function(g){var f=typeof g==="boolean"?g:!this.opts.readonly;!this.isPureText()&&this._readonly(f);this.opts.readonly=f;return this},_readonly:function(f){this.getInput().prop("readonly",f)},isDisabled:function(){return this.opts.disabled},setDisabled:function(g){var f=typeof g==="boolean"?g:!this.opts.disabled;!this.isPureText()&&this._disable(f);this.opts.disabled=f;return this},_disable:function(f){this.getInput().prop("disabled",f)},setRequired:function(g){if(this.isPureText()){return}var f=typeof g==="boolean"?g:!this.opts.required;if(!f){this.disableValidation()}this.opts.required=f;if(this.opts.label){this.$elem.find(".form-label").toggleClass("required",f)}return this},focus:function(){if(this.isPureText()){return}this.getInput().focus();return this},isHidden:function(){return this.opts.hidden},toggle:function(f){this.opts.hidden=typeof f==="boolean"?!f:!this.opts.hidden;this.$elem.toggle(f);this.disableValidation();return this},setLabel:function(f){this.options.label=f;this.$elem.find(".label-title").html(f);return this},show:function(){this.opts.hidden=false;this.$elem.show();return this},hide:function(){this.opts.hidden=true;this.$elem.hide();return this},disableValidation:function(){if(!this.isPureText()){var f=this.getTooltipTarget();f.removeClass("ui-input-invalid");if(f.data("ez.tooltip")){f.tooltip("destroy")}}},validate:function(f,h){var g=true;if(!this.isPureText()&&!this.isHidden()&&this.getTooltipTarget().is(":visible")){var i=this.getValue();var j=null;if(h!==false){if(this.opts.required&&!this.validateRequired(i)){g=false;j=this.opts.missingText}}if(g){j=this._extraValidate(i);g=j===true}if(g&&this.options.onValidate){j=this.exec(this.options.onValidate,[i]);if(d.isPlainObject(j)){g=j.isValid;j=j.msg}else{g=j===true}}this.errorMsg=j;this.showValidateResult(g,j,f)}return g},validateRequired:function(f){return f!=null},showInputHint:function(h,i,f){if(this.timer){clearTimeout(this.timer)}var g=this;this.timer=setTimeout(function(){var j=g.getTooltipTarget();if(j.data("ez.tooltip")){if(h){j.tooltip("destroy")}else{j.tooltip("setTitle",i)}}else{if(!h){j.tooltip({type:"danger",position:f||"right auto",title:i})}}},100)},showValidateResult:function(h,i,f){this.getTooltipTarget().toggleClass("ui-input-invalid",!h);if("tooltip"==this.options.validDisplayType){this.showInputHint(h,i,f)}else{if("tip"==this.options.validDisplayType){this.$elem.toggleClass("ez-form-item-with-help",!h);var g=this.getTooltipTarget().next(".text-danger");if(h){g.remove()}else{if(g.length==0){g=d("<span class='form-help-text bottom text-danger'></span>");this.getTooltipTarget().after(g)}else{g.show()}g.text(i)}}}return this},getTooltipTarget:function(){return this.$elem.find(".input-wrapper")},_extraValidate:function(f){return true}});e.DEFAULTS={width:"100%",required:false,disabled:false,readonly:false,hidden:false,trigChangeInit:false,onChange:null,missingText:"该项为必填项",validDisplayType:"tooltip",escapeHtml:true,defaultValue:null};d.fn.baseInputTag={constructor:e};var b=e.extend({initInputView:function(){this._super();this.dataMap={};if(this.opts.dataUrl){var f=this;this.isLoading=true;this.addPageReady(function(){f.load()})}else{if(this.opts.dataContext){this.opts.datas=d.getContextData(this.opts.dataContext)}if(this.opts.datas.length){this.loadData(this.opts.datas)}}},trans2InpValue:function(f){if(this.isMultiple()){f=TagUtils.strToArray(f)}else{if(f!=null&&typeof f!="string"){f+=""}f=f?[f]:[]}return f},isNull:function(f){return f.length==0},setViewValue:function(f){if(this.isLoading||(this.options.datas.length===0&&this.options.defaultOption===undefined&&!this.isPureText())){return}if(this.isPureText()){f=this.getText()}this._super(f)},getValues:function(){return this.getTypeValue()},getTypeValue:function(){return this.options.value.concat()},getValue:function(){var f=this.getTypeValue();return TagUtils.arrayToStr(f)},select:function(g){var f=this.isMultiple()?this.getValues():[];f.push(g);this.setValueWithoutView(f);this.exec(this.opts.onSelect,[g])},unselect:function(h){var g=this.getTypeValue();var f=g.indexOf(h);if(f>-1){g.splice(f,1);this.setValueWithoutView(g);this.exec(this.opts.onUnselect,[h])}},load:function(f){f=d.isPlainObject(f)?f:{url:f||this.opts.dataUrl};f.dataUrl=f.url;delete f.url;d.extend(this.opts,f);var g=this;this.req({url:this.opts.dataUrl,onLoading:function(){g.isLoading=true},onLoadSuccess:function(h){g.isLoading=false;this.loadData(h);if(this.options.selectFirst&&this.getValue()==null){this.initValue(null)}this.exec(this.opts.onLoadSuccess,[h])}});return this},loadData:function(l){if(d.isArray(l)){var f=this.opts;if(f.filterFn){l=this.exec(f.filterFn,[l])}this.options.datas=l;this.dataMap={};var m=l.length,p=f.valueField,g=f.textField;for(var j=0;j<m;j++){var h=l[j],n=h[p],o=h[g];this.dataMap[n]=o}if(!this.isPureText()){if(!this.isMultiple()&&f.blankOpt){var k={};k[f.valueField]="";k[f.textField]=f.blankOptText;l=[k].concat(l)}if(this.options.defaultOption){var n=this.options.defaultOption[p],o=this.options.defaultOption[g];this.dataMap[n]=o;l=[this.options.defaultOption].concat(l)}this._doLoadData(l)}else{if(this.options.defaultOption){var n=this.options.defaultOption[p],o=this.options.defaultOption[g];this.dataMap[n]=o}}if(this.options.selectFirst&&this.options.datas.length){this.options.defaultValue=this.options.datas[0][this.options.valueField]}if(typeof this.originalValue!="undefined"){this.setViewValue(this.getTypeValue())}this.exec(this.opts.onLoadData,[l])}},_doLoadData:function(){},getText:function(){var j=[],g=this.getTypeValue(),f=g.length;for(var h=0;h<f;h++){var k=this.dataMap[g[h]]||"";j.push(k)}return j.join(this.options.separator)},validateRequired:function(){var g=this.getTypeValue();if(this.isLoading){return g.length>0}var f=0;if(g.length){for(var h=0;h<g.length;h++){var j=this._getOptText(g[h]);if(j!=null&&j!=undefined){f++}}}return f>0},_extraValidate:function(k){var g=true;var j=this.options;if(this.isMultiple()){k=this.getTypeValue();var i=k.length,h=j.min,f=j.max;if(h!=null&&h>i){g=sprintf(j.minOptionsText,h)}if(g==true&&f!=null&&f<i){g=sprintf(j.maxOptionsText,f)}}if(g===true){g=this._super(k)}return g},isMultiple:function(){return this.opts.multiple},_getOptText:function(h){var i=null;var g=this._getOption(h);if(g!=null){var f=this.opts.textField;i=g[f]}return i},_getOption:function(l){var k=null;if(typeof l!="undefined"){var g=this.opts.datas;var f=g.length;var h=this.opts.valueField;for(var j=0;j<f;j++){if(l==g[j][h]){k=g[j];break}}}return k},isChange:function(g,f){g=g.join(",");f=f.join(",");return this._super(g,f)},change:function(g,f){if(!this.isMultiple()){g=TagUtils.arrayToStr(g);f=TagUtils.arrayToStr(f)}this._super(g,f)},getDatas:function(){return this.options.datas},setDefaultOption:function(f){this.options.defaultOption=f;this.loadData(this.options.datas)}});b.DEFAULTS=d.extend({},e.DEFAULTS,{valueField:"value",textField:"text",multiple:false,dataUrl:null,onSelect:null,onUnselect:null,onLoadSuccess:null,onBeforeLoad:null,onLoadError:null,filterFn:null,cascadeId:null,min:0,max:null,datas:[],separator:",",minOptionsText:"至少选中%s个选项",maxOptionsText:"最多选择%s个选项",blankOpt:false,blankOptText:"全部"});d.fn.baseSelectTag={constructor:b}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({getOptions:function(c,d){if(!c.type){c.type="default";if(typeof c.outline=="undefined"){c.outline=true}}return this._super(c,d)},initTag:function(){var c=this.opts;if(c.onClick){this.$elem.on("click",function(){var d=get(this);return d.exec(d.opts.onClick)})}if(c.title){this.$elem.tooltip({title:c.title})}},setDisabled:function(d){var c=typeof d==="boolean"?d:!this.opts.disabled;this.opts.disabled=c;if(!this.loading){if(c){this.$elem.attr("disabled",true)}else{this.$elem.removeAttr("disabled")}if(this.$elem.attr("href")){if(c){this.$elem.attr("onclick","return false;")}else{this.$elem.removeAttr("onclick")}}}else{this.defaultDisabled=c}return this},openLoadingDisabled:function(){this.defaultDisabled=this.opts.disabled;this.setDisabled(true);this.loading=true;return this},closeLoadingDisabled:function(){this.loading=false;this.setDisabled(this.defaultDisabled);return this},toggle:function(c){this.options.hidden=typeof c==="boolean"?!c:!this.options.hidden;this.$elem.toggle(c);return this},show:function(){this.toggle(true);return this},hide:function(){this.toggle(false);return this},setText:function(f,e){var d=createTag("");if(f){this.options.text=f;createTag("span").append(f).appendTo(d)}if(e){this.options.iconCls=e;var c=createTag("i").addClass("icon").addClass(e);if(this.opts.iconAlign=="left"){d.prepend(c)}else{d.append(c)}if(!f){this.$elem.addClass("icon-only")}}this.$elem.html(d.toString());return this},setType:function(c){if(this.options.type=="default"){this.$elem.removeClass("btn-outline-default")}this.$elem.removeClass("btn-"+this.options.type).addClass("btn-"+c);if(c=="default"){this.$elem.addClass("btn-outline-default")}this.options.type=c;return this},getText:function(){return this.opts.text},click:function(c){if(c){if(!this.opts.onClick){this.$elem.on("click",function(){var d=get(this);return d.exec(d.opts.onClick)})}this.opts.onClick=c}else{this.$elem.click()}return this},focus:function(){this.$elem.focus();return this},createTag:function(){var c=this.opts;c.id&&this.$elem.attr("id",c.id);this.$elem.attr("type","button").addClass("ezui btn");c.size&&this.$elem.addClass("btn-"+c.size);c.cls&&this.$elem.addClass(c.cls);c.title&&this.$elem.attr("title",c.title);c.hidden&&this.$elem.addClass("hide");c.disabled&&this.$elem.attr("disabled",c.disabled);this.setText(c.text,c.iconCls)},req:function(e,g){e=b.isPlainObject(e)?e:{url:e};if(b.isFunction(g)){e.onLoadSuccess=g}else{if(typeof g==="boolean"){e.async=g}}var c,d;var f=b.extend({},e,{onLoading:function(){this.openLoadingDisabled();c=this.options.text;d=this.options.iconCls;this.setText(this.options.loadingText,"icon-spinner icon-spin");this.exec(e.onLoading)},onComplete:function(){this.closeLoadingDisabled();this.setText(c,d);this.exec(e.onComplete)}});return this._super(f)}});a.DEFAULTS={iconAlign:"left",disabled:false,hidden:false,loadingText:"加载中"};b.fn.button=function(c,d){return b.fn.baseTag.call(this,c,d,a)};b.fn.button.constructor=a}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){if(this.opts.dataUrl){this.load(null,true)}else{if(this.opts.dataContext){var c=b.getContextData(this.opts.dataContext);if(c){this.opts.data=c;this.$elem.find(".ui-input").each(function(){var d=b(this).data("value");if(typeof d=="undefined"||d===""){var e=b(this).attr("id");if(typeof e!="undefined"&&typeof c[e]!="undefined"){b(this).data("value",c[e])}}})}}}},getOptions:function(c,d){if(this.$elem.attr("id")&&c.validModify==null){c.validModify=true}return this._super(c,d)},getData:function(){var c=b.extend({},this.options.data);this.eachInput(function(){var d=this.options.id;if(d){if(this.isDisabled()){delete c[d]}else{c[d]=this.getValue()}}});return c},load:function(c,d){c=b.isPlainObject(c)?c:{url:c||this.opts.dataUrl};b.extend(this.opts,c);this.req({url:this.opts.dataUrl,onLoadSuccess:function(e){if(d){this.initData(e)}else{this.loadData(e)}this.exec(this.opts.onLoadSuccess,[e])}});return this},isModify:function(){var c=false;if(this.opts.validModify){this.eachInput(function(){if(this.isModify&&!this.isPureText()&&!this.isHidden()){c=true;return false}})}return c},disableValidation:function(){this.eachInput(function(){this.disableValidation()});return this},validate:function(c){var e=null;this.eachInput(function(){if((!this.validate(null,c))&&e==null){e=this}});var f=this.options.onValid,d=false;if(e){if(f){this.exec(f,[d,e.errorMsg,e.options.label])}e.focus();setTimeout(function(){e.focus()},500)}else{d=true;this.exec(f,[d])}return d},submit:function(d,f,c){if(this.validate(c)){d=b.isPlainObject(d)?d:{url:d,onLoadSuccess:f};d.onLoadSuccess=d.onLoadSuccess||d.success;d.onBeforeLoad=d.onBeforeLoad||d.beforeSubmit;var e=b.extend({modal:true},d,{onBeforeLoad:function(g){g[this.getId()]=this.getData();return this.exec(d.onBeforeLoad,[g])},onLoadSuccess:function(g){this.resetStatus();this.exec(d.onLoadSuccess,[g])}});this.req(e)}},loadData:function(c,d){if(b.isPlainObject(c)){this.opts.data=c;this.eachInput(function(){var f=this.options.id;if(f){var e=c.hasOwnProperty(f);if(d){if(e){this.initValue(c[f])}}else{var g=e?c[f]:null;this.setValue(g)}}})}return this},initData:function(d,c){if(c){this.clear()}this.loadData(d,true);return this},resetStatus:function(){this.eachInput(function(){this.isModify=false});return this},clear:function(){this.options.data={};this.eachInput(function(){this.clear()});return this},reset:function(){this.eachInput(function(){this.reset()});return this},isHidden:function(){return this.opts.hidden},toggle:function(c){if(this.options.title||this.options.border||this.options.collapsible){this.$elem.closest(".panel").toggle(c)}else{this.$elem.toggle(c)}this.options.hidden=typeof c==="boolean"?!c:!this.options.hidden;return this},show:function(){if(this.options.title||this.options.border||this.options.collapsible){this.$elem.closest(".panel").show()}else{this.$elem.show()}this.options.hidden=false;return this},hide:function(){if(this.options.title||this.options.border||this.options.collapsible){this.$elem.closest(".panel").hide()}else{this.$elem.hide()}this.options.hidden=true;return this},setDisabled:function(c){this.eachInput(function(){this.setDisabled(c)});return this},setReadonly:function(c){this.eachInput(function(){this.setReadonly(c)});return this},eachInput:function(c){this.$elem.find(".ui-input").each(function(){var d=get(this);if(d&&d.getInput){return c.call(d)}})}});b.fn.form=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.form.constructor=a;a.DEFAULTS={width:null,height:null,title:null,border:false,collapsible:false,collapsed:false,hidden:false,validModify:false,notifyInvalid:true,onLoadSuccess:null,onBeforeLoad:null}}(window.jQuery);!function(b){var a=b.fn.baseInputTag.constructor.extend({initInputViewEdit:function(){this.$input=this.$elem.find(".form-control");if(typeof this.options.value=="undefined"){this.options.value=this.$input.val()}var f=this;this.$input.on("change",function(h){var i=b(this).val();i=f.trans2InpValue(i);f.setValueWithoutView(i)});if(this.options.onEnter){this.$input.on("keyup",function(h){if(h.keyCode=="13"){f.exec(f.options.onEnter,[h])}})}if(this.options.onIconClick){this.$elem.find(".form-control-feedback.clickable").on("click.iconClick",function(h){f.exec(f.options.onIconClick,[h])})}if(this.options.maxLength||this.options.minLength){var d=sprintf("length[%s,%s]",this.options.minLength?this.options.minLength:-1,this.options.maxLength?this.options.maxLength:-1);this.opts.validType=this.opts.validType?d+"&"+this.opts.validType:d}if(this.opts.validType&&this.opts.validType.indexOf("length[")>-1){if(!this.options.useCharLength){var g=["idCard","phone","postcode","email","url","tel","qq","letter","number","weixin","half-width"];for(var c=0;c<g.length;c++){var e=g[c];if(this.opts.validType.indexOf(e)>-1){this.options.useCharLength=true;break}}}if(this.options.useCharLength){this.opts.validType=this.opts.validType.replace("length[","charLength[")}}if(this.opts.validType&&this.options.validType.split("&").contains("email")&&b.fn.typeahead){this.$input.typeahead({items:"all",showHintOnFocus:true,selectOnBlur:false,autoSelect:false,changeInputOnMove:false,appendTo:"body",source:function(m,l){if(!m.length){l([]);return}m=StringUtils.replaceToHtmlCharacterEntities(m);var k=f.options.EMAIL_LIST;var j=m.indexOf("@"),i=[];i.push(m);var n=null;if(j>-1){n=m.slice(j+1);m=m.slice(0,j)}var h=b.map(k,function(p,o){if(n&&n==p){return""}return m+"@"+p});i=i.concat(h);l(i)}});this.$input.on("focus.autocomplete",function(){TagUtils.bindScrollEvent(f.$input,"autocomplete",function(h){f.$input.typeahead("hide")})});this.$input.on("blur.autocomplete",function(){TagUtils.unbindScrollEvent(f.$input,"autocomplete")})}},trans2InpValue:function(c){if(typeof c==="string"){c=AppParam.IS_AUTO_TRIM?c.trim():c}if(c===""){c=null}if(c!=null&&typeof c!="string"){c+=""}return c},createTag:function(){var d=this.opts;var c=createTag("input").attr("type","text").addClass("form-control").attr("placeholder",d.placeholder).attr("readonly",d.readonly).attr("disabled",d.disabled).addClass(d.size,"input-");this.$elem.append(c.toString())},setValidType:function(c){this.opts.validType=c;return this},_extraValidate:function(g){if(g!=null&&this.opts.validType){var f=this.opts.validType.split("&");for(var d=0;d<f.length;d++){var e=f[d];var c={};if(e.indexOf("fn")==0){var h=e.substring(3,e.length-1);c=this.exec(h,[g])}else{c=StringUtils.validate(g,e)}if(!c.isValid){return c.msg}}}return true},setInputValue:function(c){this.$input.val(c)},getInput:function(){return this.$input},getTooltipTarget:function(){var c=this.getInput();if(c.parent().hasClass("input-group")){return c.parent()}else{return c}},on:function(c,d){if(!this.isPureText()){this.$input.on(c,d)}return this},off:function(c,d){if(!this.isPureText()){this.$input.off(c,d)}return this},validate:function(c,d){if(!this.options.pureText&&this.getInput().parent().hasClass("form-item")){return this._super("auto bottom",d)}else{return this._super(c,d)}},setMaxLength:function(c){if(c!==undefined){this.options.maxLength=c;var d=sprintf("length[%s,%s]",this.options.minLength?this.options.minLength:-1,this.options.maxLength?this.options.maxLength:-1);this.opts.validType=this.opts.validType?d+"&"+this.opts.validType:d;if(this.options.useCharLength){this.opts.validType=this.opts.validType.replace("length[","charLength[")}}return this},setMinLength:function(c){if(c!==undefined){this.options.minLength=c;var d=sprintf("length[%s,%s]",this.options.minLength?this.options.minLength:-1,this.options.maxLength?this.options.maxLength:-1);this.opts.validType=this.opts.validType?d+"&"+this.opts.validType:d;if(this.options.useCharLength){this.opts.validType=this.opts.validType.replace("length[","charLength[")}}return this}});b.fn.textInput=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.textInput.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseInputTag.constructor.DEFAULTS,{useCharLength:false,EMAIL_LIST:("163.com,qq.com,hotmail.com,sina.com,gmail.com,126.com,yahoo.com.cn,msn.com,139.com,sohu.com").split(",")})}(window.jQuery);!function(a){var b=a.fn.textInput.constructor.extend({initTag:function(){this._super();var f=this.options.min;var e=parseFloat(f);if(typeof f!="undefined"&&e==f){this.options.min=e}var c=this.options.max;var d=parseFloat(c);if(typeof c!="undefined"&&d==c){this.options.max=d}},initInputViewEdit:function(){this._super();var c=this;this.getInput().off("change").on("change",function(f){var g=a(this).val();g=a.trim(g.replace(new RegExp("\\,","g"),""));g=a.trim(g.replace(new RegExp("\\.","g"),"."));g=g.replace(/\s/g,"");var d=c.getTypeValue();g=c.trans2InpValue(g);if(c.isChange(g,d)){c.setValue(g)}else{c.setViewValue(g)}}).on("keypress",function(f){var d=a(this).val();if(f.which==13){return true}if(f.which==45){return(d.indexOf("-")==-1?true:false)}var g=String.fromCharCode(f.which);if(g=="."){return(d.indexOf(g)==-1?true:false)}else{if(g==","){return true}else{if((f.which>=48&&f.which<=57&&f.ctrlKey==false&&f.shiftKey==false)||f.which==0||f.which==8){return true}else{if(f.ctrlKey==true&&(f.which==99||f.which==118)){return true}else{return false}}}}})},trans2InpValue:function(c){if(typeof c!="number"){c=parseFloat(c);if(isNaN(c)){c=null}}if(c!=null){c=parseFloat(NumberUtils.toFixed(c,this.opts.precision))}return c},setViewValue:function(c){c=this._format(c);this._super(c)},getText:function(){return this._format(this.getValue())},_format:function(f){if(f==null){return""}f=NumberUtils.toFixed(f,this.options.precision);var e=f,c="";var d=f.indexOf(".");if(d>=0){e=f.substring(0,d);c=f.substring(d+1,f.length)}var g=/(\d+)(\d{3})/;while(g.test(e)){e=e.replace(g,"$1,$2")}if(c){return e+"."+c}else{return e}},_extraValidate:function(c){var d=TagUtils.validateNumber(c,this.opts.min,this.opts.max);if(d){return d}return this._super(c)},setMin:function(c){this.options.min=c;this.validate();return this},setMax:function(c){this.options.max=c;this.validate();return this}});a.fn.numberInput=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.numberInput.constructor=b;b.DEFAULTS=a.extend({},a.fn.textInput.constructor.DEFAULTS,{min:null,max:null,precision:0})}(window.jQuery);!function(b){var a=b.fn.textInput.constructor.extend({initInputView:function(){if(!this.options.pureText){var d=this.$elem.find("textarea");var c=d.val();if(c){d.val("");this.options.value=c}}else{this.$pre=this.$elem.find("pre");var c=this.$pre.html();if(c){this.options.value=c}if(this.options.collapsed){b(window).off("resize.textarea").on("resize.textarea",function(f){var g=b(document.body).find('[data-toggle="textarea"]');g.each(function(){var e=get(b(this));if(e){if(e.options.pureText&&e.options.collapsed){TagUtils.transformToCollapsed(e.$pre,e.options.pureText,e)}}})})}}this._super()},initInputViewEdit:function(){this._super();var c=this;this.getInput().off("change").on("change",function(d){var f=b(this).val();f=f.trimEnd();f=f==""?null:f;c.setValueWithoutView(f)});if(this.options.maxLength){this.getInput().on("input",function(){c.updateWordcount()})}if(this.opts.editDialog){var c=this;this.getInput().addClass("ui-textarea-editDialog").prop("readonly",true).on("click",function(){var d=new Url("sysCommon/enterTextAreaEditDialog.do","options",{value:c.getValue(),readonly:c.isReadonly(),validType:c.opts.validType});var e={url:d};if(!c.isReadonly()){e.buttons=[{text:"确定",onClick:function(){var f=get("_textAreaEdit");if(f.validate()){c.setValue(f.getValue());b.closeDialog()}}}]}e.title=c.opts.label?c.opts.label:c.opts.editDialogTitleText;b.openDialog(e)})}},createTag:function(){var d=this.opts;var c=createTag("textarea").addClass("form-control").css("height",84).attr("placeholder",d.placeholder).attr("readonly",d.readonly).attr("disabled",d.disabled).addClass(d.size,"input-");this.$elem.append(c.toString())},setTextValue:function(c){this.$pre.text(c||"-");if(this.options.collapsed){TagUtils.transformToCollapsed(this.$pre,this.options.pureText,this)}},trans2InpValue:function(c){if(typeof c==="string"){c=c.trimEnd()}if(c===""){c=null}if(c!=null){if(typeof c!="string"){c+=""}else{c=c.replace(/\\n/g,"\n")}}return c},validate:function(c,d){return this._super("auto top",d)},setInputValue:function(c){this._super(c);this.updateWordcount()},updateWordcount:function(){var d=this.$elem.find(".textarea-wordcount");if(d.length){var e=this.getInput().val().trimEnd();var c=0;if(this.options.useCharLength){c=e.length;d.text(c+"/"+this.options.maxLength+"字")}else{c=e.cnLength();var f=NumberUtils.toFixed(c/2,0);d.text(f+"/"+(this.options.maxLength/2)+"字")}if(c>this.options.maxLength){d.addClass("danger")}else{d.removeClass("danger")}}},setMaxLength:function(c){this._super(c);this.updateWordcount();return this},setMinLength:function(c){this._super(c);this.updateWordcount();return this}});b.fn.textarea=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.textarea.constructor=a;a.DEFAULTS=b.extend({},b.fn.textInput.constructor.DEFAULTS,{editDialog:false,editDialogTitleText:"数据编辑",collapsed:false})}(window.jQuery);!function(b){var a=b.fn.textInput.constructor.extend({initInputViewEdit:function(){this._super();this.$codeImg=this.$elem.find(".input-group-addon");this.$feedbackIcon=this.$elem.find(".icon-verify-code");var d=this;this.$codeImg.on("click",function(f){d.resetVerifyCode()});var c=null;this.$input.attr("maxLength",4).on("keydown",function(){if(c){clearTimeout(c)}var e=event.target||event.srcElement;c=setTimeout(function(h){var g=b(e).val();d.setValue(g);if(g.length==4){var f=new Url("sysCommon/checkVerifyCode");f.addParam("code",g);b.req({url:f,modal:false,onLoadSuccess:function(i){var j=i.code==AppConstant.RESULT_SUCCESS;d.$feedbackIcon.toggleClass("icon-check",j).toggleClass("icon-times",!j).show();if(!j){d.focus();if(i.code==AppConstant.RESULT_LOGIN_FAIL_VERIFY_CODE_EXPIRE){d.$feedbackIcon.hide();d.msg="验证码已过期，请重新输入";b("img",d.$codeImg).attr("src",sprintf("sysCommon/getVerifyCode?time=%s",new Date().getTime()))}}else{d.msg=null}d.validate()}})}else{d.$feedbackIcon.removeClass("icon-check").hide();d.msg=null;d.validate()}},100)})},_extraValidate:function(c){if(!this.$feedbackIcon.hasClass("icon-check")){return this.msg||"请输入正确的验证码"}return this._super(c)},validate:function(c,d){return this._super("auto bottom",d)},resetVerifyCode:function(){this.msg=null;this.$feedbackIcon.hide();this.clear().focus();b("img",this.$codeImg).attr("src",sprintf("sysCommon/getVerifyCode?time=%s",new Date().getTime()));return this}});b.fn.verifyCode=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.verifyCode.constructor=a;a.DEFAULTS=b.extend({},b.fn.textInput.constructor.DEFAULTS)}(window.jQuery);!function(a){var b=a.fn.textInput.constructor.extend({initInputViewEdit:function(){this._super();this.$btn=this.$elem.find("button");var c=this;this.$btn.on("click",function(g){var f=c.exec(c.options.onBtnClick,[g]);if(f!==false){c.clear().focus();var d=get(this);d.setDisabled(true);d.setText("重发（60秒）");var h=59;c.resendTimer=setInterval(function(){d.setText("重发（"+(h--)+"秒）");if(h==0){c.clearTimeout();h=59}},1000)}});this.$input.attr("maxLength",6)},sendSms:function(){this.clearTimeout();this.$btn.trigger("click");return this},clearTimeout:function(){clearTimeout(this.resendTimer);var c=get(this.$btn);c.setText("重发");c.setDisabled(false)},validate:function(c,d){return this._super("auto bottom",d)}});a.fn.smsVerifyCode=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.smsVerifyCode.constructor=b;b.DEFAULTS=a.extend({},a.fn.textInput.constructor.DEFAULTS)}(window.jQuery);!function(a){var b=a.fn.baseSelectTag.constructor.extend({initInputView:function(){this._super();this.initCascade()},initInputViewEdit:function(){var f=this;this.btnEvents=[];var d={theme:"bootstrap",width:this.opts.width,disabled:this.opts.readonly||this.opts.disabled||this.opts.cascadeReadonly,allowClear:this.opts.allowClear,language:"zh-CN",size:this.opts.size,placeholder:this.options.placeholder||"请选择一个选项",isTableEdit:this.options.isTableEdit,loadMore:this.options.loadMore,dropdownMinWidth:this.options.dropdownMinWidth,dropdownMaxWidth:this.options.dropdownMaxWidth,dropdownMaxHeight:this.options.dropdownMaxHeight,button:this.createDropdownBtn()};var c=this.opts.multiple,e=this.opts.searchable;if(c){d.multiple=true;d.maximumSelectionLength=this.opts.max;d.allowClear=false;d.closeOnSelect=this.opts.closeOnSelect;d.placeholder=this.options.placeholder||"请选择一个或多个选项"}if(!e){d.minimumResultsForSearch=Infinity}d.cls="input-wrapper "+(this.options.cls||"");this.$select=this.$elem.find("select");this.$select.select2(d);this.$select.on("change",function(i){var h=a(this).val();if(!a.isArray(h)){if(h!=null&&typeof h!="string"){h+=""}h=h?[h]:[]}var g=h.concat();if(f.isChange(g.sort(),f.getTypeValue().sort())){f.setValueWithoutView(h);f.triggerCascade(h)}});this.$select.on("select2:open",function(g){a(".select2-dropdown:last").toggleClass("invalid",a(this).next().hasClass("ui-input-invalid"))});if(this.options.onSelect){this.$select.on("select2:select",function(h){var g=f.getData(h.params.data.id);f.exec(f.options.onSelect,[g])})}if(this.options.onUnselect){this.$select.on("select2:unselect",function(h){var g=f.getData(h.params.data.id);f.exec(f.options.onUnselect,[g])})}this.$select.on("focus",function(){f.exec(f.opts.onFocus)});if(!e&&c){this.$select.on("select2:opening select2:closing",function(g){var h=a(this).parent().find(".select2-search__field");h.prop("disabled",true)})}},createTag:function(){this.$elem.append(a("<select/>"))},focus:function(){this.$select.select2("focus");return this},getTooltipTarget:function(){return this.getInput().find(".select2-selection")},_readonly:function(c){this._disable(c)},_disable:function(c){this.$select.prop("disabled",c)},setViewValue:function(c){this._super(c);this.triggerCascade(c)},setInputValue:function(c){this.$select.val(this.isMultiple()?c:c.join(","));if(c.length&&!this.getText()){this.$select.trigger("change.select2");return}this.$select.trigger("change")},_doLoadData:function(d){if(a.isArray(d)){var e=this.opts.textField,f=this.opts.valueField;var h=createTag("");for(var g=0;g<d.length;g++){var j=d[g];var k=createTag("option").attr("value",j[f]).append(j[e]);var c=this.exec(this.opts.onOptionInit,[j,k]);if(c!==false){k.appendTo(h)}}this.$select.html(h.toString());if(this.$select.next().hasClass("select2-container--open")){this.$select.select2("close");this.$select.select2("open")}}},initCascade:function(){var d=this.options,c=d.cascadeId;if(c){this.$cascadeTarget=a("#"+c,d.pageProxy&&d.pageProxy.page);this.$cascadeTarget.data("cascade-readonly",true);this.cascadeUrl=this.$cascadeTarget.data("dataUrl");this.$cascadeTarget.removeAttr("data-data-url");this.$cascadeTarget.removeData("dataUrl")}},triggerCascade:function(d){if(this.$cascadeTarget){var c=this;var e=function(){var l=get(c.$cascadeTarget);if(d.length){l.setCascadeReadonly(false);if(l.options.datas.length&&l.isModify){l.clear()}if(c.cascadeUrl){var g=new Url(c.cascadeUrl,"value",d.join(","));l.req({url:g,modal:false,onLoadSuccess:function(i){l.loadData(i);l.exec(l.options.onLoadSuccess,[i])},onBeforeLoad:l.options.onBeforeLoad,onLoadError:l.options.onLoadError})}else{var j=[];for(var h=0;h<d.length;h++){var k=c._getOption(d[h]);if(k){var f=k[c.options.childrenField]||k.cascade;j=j.concat(f)}}l.loadData(j)}}else{l.setCascadeReadonly(true);if(l.isModify){l.clear()}}};if(get(this.$cascadeTarget)){e()}else{this.addPageReady(e)}}},select:function(e){var c=this.getTypeValue();if(c.contains(e)){return}if(this.isMultiple()){c.push(e)}else{c=[e]}this.setValue(c);var d=this.getData(e);this.exec(this.opts.onSelect,[d])},unselect:function(e){var c=this.getTypeValue();if(c.contains(e)){c.remove(e);this.setValue(c);var d=this.getData(e);this.exec(this.opts.onUnselect,[d])}},getData:function(g){var c=this.options.datas;if(c&&c.length){var d=this.options.valueField;for(var e=0;e<c.length;e++){var f=c[e];if(f[d]==g){return f}}}},setCascadeReadonly:function(c){if(!this.isPureText()){this.options.cascadeReadonly=c;if(!this.options.readonly){this._disable(c)}}return this},hidePanel:function(){this.$select.select2("close")},createDropdownBtn:function(){var h=this.exec(this.options.onBtnInit,[]);if(a.isArray(h)){var f=[];for(var e=0;e<h.length;e++){var d=h[e];var g=this.addClickEvent(d.onClick);d.data=a.extend({},d.data,{fnIndex:g});var c=TagUtils.createHref(d);f.push(c.toString())}return f.join("<i class='btn-linked-split'></i>")}},addClickEvent:function(f){var e=null;if(f){var c=this.btnEvents.length;for(var d=0;d<c;d++){if(this.btnEvents[d].toString()==f.toString()){e=d;break}}if(e==null){e=c;this.btnEvents.push(f)}}return e},toggle:function(c){this._super(c);if(c&&this.options.multiple){this._resizeSearch()}return this},show:function(){this._super();if(this.options.multiple){this._resizeSearch()}return this},_resizeSearch:function(){var c=this;setTimeout(function(){var d="";var e=c.$elem.find("input.select2-search__field");if(e.attr("placeholder")!==""){var d=c.$elem.find(".select2-selection__rendered").innerWidth()-18;d=d>160?d:160}else{var f=e.val().cnLength()+1;d=(f*0.75)+"em"}e.css("width",d)},150)}});a.fn.select=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.select.constructor=b;b.DEFAULTS=a.extend({},a.fn.baseSelectTag.constructor.DEFAULTS,{blankOpt:false,searchable:true,allowClear:true,width:"auto",selectFirst:false,isTableEdit:false,childrenField:"children",closeOnSelect:false,dropdownMinWidth:240,dropdownMaxWidth:null,loadMore:false,onOptionInit:null})}(window.jQuery);!function(b){var a=b.fn.baseSelectTag.constructor.extend({initInputViewEdit:function(){this.$ul=this.$elem.find("ul");var c=0;if(this.options.readonly||this.options.disabled){c=-1}if(this.options.multiple){this.selectBtnHtml=sprintf("<li class='modalselect-btn select' tabindex='%s'><i class='icon %s'></i>%s</li>",c,"icon-plus","<span>"+this.options.btnText+"</span>")}else{this.selectBtnHtml=sprintf("<li class='modalselect-btn edit' tabindex='%s'><i class='icon %s'></i></li>",c,"icon-edit")}this.$ul.html(this.selectBtnHtml);var d=this;this.$ul.on("click.modalselect.edit",".modalselect-btn",function(f){if(d.options.readonly||d.options.disabled){return false}b(this).blur();d.exec(d.options.onClick)}).on("click.modalselect.remove",".remove",function(h){if(d.options.readonly||d.options.disabled){return false}var f=b(this).parent();var i=f.data("id");f.remove();var g=d.getValues();g.remove(i);d.setValueWithoutView(g)})},setInputValue:function(e){var j=createTag(""),f=this.options.valueField,d=this.options.textField;for(var g=0;g<e.length;g++){var h=e[g];var c=createTag("li").attr("data-id",h).append(this._getOptText(h)).appendTo(j);if(!this.options.pureText){c.append("<span class='remove'>&times</span>")}}j.append(this.selectBtnHtml);this.$ul.html(j.toString())},_readonly:function(c){this.$ul.toggleClass("readonly",c)},_disable:function(c){this.$ul.toggleClass("disabled",c)},getTooltipTarget:function(){return this.$elem.find(".modalselect-btn")},focus:function(){this.$ul.find("[tabindex]").focus();return this}});b.fn.modalSelect=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.modalSelect.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseSelectTag.constructor.DEFAULTS,{btnText:"新增"})}(window.jQuery);!function(c){var a=c.fn.baseInputTag.constructor.extend({initInputViewEdit:function(){var d=this.opts;var l=this.opts.mask;var g=null;if(!l.contains("dd")){g=1}if(!l.contains("MM")){g=2}var j=l;var f=null;var k=l.indexOf("HH");if(k>-1){j=j.substring(0,k-1).trim();f=l.substring(k)}this.options.min=DatetimeUtils.parse(d.min,l);this.options.max=DatetimeUtils.parse(d.max,l);var h=this;this.$dateInp=this.$elem.find("input.date-input");this.$dateInp.datepicker({format:j.toLowerCase(),language:"zh-CN",autoclose:true,todayBtn:"linked",clearBtn:true,minViewMode:g,maxViewMode:2,startDate:this.options.min,endDate:this.options.max,isTableEdit:this.options.isTableEdit,todayHighlight:true}).on("changeDate",function(p){var s=p.date;if(s&&h._isTime()&&h.options.currentTime){var m=new Date();s.setHours(m.getHours());s.setMinutes(m.getMinutes());s.setSeconds(m.getSeconds())}var r=h.$elem.closest("[data-toggle='datetimeRange']");var q=true;if(r.length&&h.$timeCombobox){var o=null;if(h.$elem.hasClass("datetime-start")){o=r.find(".datetime-end")}else{o=r.find(".datetime-start")}if(document.body.contains(get(o).$timeCombobox[0])){if(s){var v=h.$timeInp.val();if(v==""){var t=[DatetimeUtils._padding(s.getHours())];if(l.contains("mm")){t.push(DatetimeUtils._padding(s.getMinutes()))}if(l.contains("ss")){t.push(DatetimeUtils._padding(s.getSeconds()))}h.$timeInp.val(t.join(":"))}else{var t=v.split(":");for(var n=0;n<t.length;n++){var u=parseInt(t[n]);if(!isNaN(u)){if(n==0){s.setHours(u)}else{if(n==1){s.setMinutes(u)}else{if(n==2){s.setSeconds(u)}}}}}}}q=false}}if(h.options.currentTime){h.setValue(s)}else{h.setValueWithoutView(s)}if(h.$timeCombobox){q&&h.$timeInp.trigger("click")}else{if(h.options.isTableEdit){h.$dateInp.focus()}}if(!s){h.$timeCombobox&&h.$timeInp.val("")}if(r.length){if(h.$elem.hasClass("datetime-start")){get(r.find(".datetime-end")).validate()}else{get(r.find(".datetime-start")).validate()}}}).on("show.datetime",function(){TagUtils.bindScrollEvent(h.$elem,"datetime",function(m){h.$dateInp.datepicker("hide")})}).on("hide.datetime",function(){var m=h.getTypeValue();m&&h.$timeInp&&h.$timeInp.focus()});if(f){var i=[];var e;if(f.contains("HH")){i.push("{{99}}");e=/^(20|21|22|23|[0-1]\d)$/}if(f.contains("mm")){i.push("{{99}}");e=/^(20|21|22|23|[0-1]\d):[0-5]\d$/}if(f.contains("ss")){i.push("{{99}}");e=/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/}this.$timeInp=this.$elem.find("input.time-input");this.$timeCombobox=c(this.createTimeCombobox(f).toString());this.$timeInp.on("blur",this,function(q){var n=h.getTypeValue();if(n){var r=new Date(n.getFullYear(),n.getMonth(),n.getDate());var p=c(this).val();if(e.test(p)){var m=p.split(":");r.setHours(m[0]||0);r.setMinutes(m[1]||0);r.setSeconds(m[2]||0)}else{c(this).val("");r.setHours(0);r.setMinutes(0);r.setSeconds(0)}h.setValueWithoutView(r);var o=h.$elem.closest("[data-toggle='datetimeRange']");if(o.length){if(h.$elem.hasClass("datetime-start")){get(o.find(".datetime-end")).validate()}else{get(o.find(".datetime-start")).validate()}}}}).on("focus",this,function(m){var n=h.getTypeValue();if(!n){h.focus()}}).on("input propertychange",function(p){var o=c(this).val();var n=h.$timeCombobox.find(".time-combobox-select");if(o==""){n.each(function(q){c(this).find(".active").removeClass("active");c(this).find("li:first").addClass("active");c(this).animate({scrollTop:0},300)})}else{if(e.test(o)){var m=o.split(":");n.each(function(q){c(this).find(".active").removeClass("active");c(this).find("li").eq(m[q]).addClass("active");c(this).animate({scrollTop:m[q]*32},300)})}}}).on("click",function(){if(h.isDisabled()||h.isReadonly()){return}var p=h.getTypeValue();if(!p){h.focus();return}if(!c(document.body).find(h.$timeCombobox).length){h.$timeCombobox.appendTo(c(document.body)).css("top","auto").css("left","auto").position({of:h.$timeInp,my:"left top",at:"left bottom+4px"}).show();var o=c(this).val();var n=h.$timeCombobox.find(".time-combobox-select");if(o==""){n.each(function(q){c(this).find("li:first").addClass("active")})}else{var m=o.split(":");n.each(function(q){c(this).find(".active").removeClass("active");c(this).find("li").eq(m[q]).addClass("active");c(this).scrollTop(m[q]*32)})}c(document).on("mousedown.timeCombobox",function(q){if(h.$timeCombobox.is(q.target)||h.$timeCombobox.find(q.target).length||h.$timeInp.is(q.target)||h.$timeInp.find(q.target).length){return}h.hideTimeCombobox();c(document).off("mousedown.timeCombobox")});TagUtils.bindScrollEvent(c(this),"timeCombobox",function(q){h.hideTimeCombobox()})}});h.$timeCombobox.find(".time-combobox-select ul li").on("click",function(o){c(this).siblings(".active").removeClass("active");c(this).addClass("active");var n=c(this).closest(".time-combobox-select");n.animate({scrollTop:c(this).index()*32},300);var p=h.getTypeValue();if(p){var m="";h.$timeCombobox.find(".time-combobox-select li.active").each(function(q){if(q==0){m=c(this).text()}else{m=m+":"+c(this).text()}});h.$timeInp.val(m);h.$timeInp.focus();if(n.is(h.$timeCombobox.find(".time-combobox-select:last"))){h.hideTimeCombobox()}}});c(window).off("resize.datetime").on("resize.datetime",function(m){c(".time-combobox").each(function(){var n=c(this).data("tag-id");var o=get(c("[data-tag-id='"+n+"']"));if(o){o.hideTimeCombobox()}})})}},createTag:function(){var h=createTag("div").addClass("datetime");var d=createTag("input").addClass("date-input form-control").attr("placeholder",this.opts.placeholder).attr("readonly",true);var e=this.opts.mask;if(e.contains("HH")){var f=createTag("div").addClass("input-group date");f.append(createTag("span").addClass("input-group-addon icon-calendar"));f.append(d);var g=createTag("div").addClass("input-group");if(this.opts.size){f.addClass("input-group-"+this.opts.size);g.addClass("input-group-"+this.opts.size)}g.append(createTag("span").addClass("input-group-addon icon-clock"));g.append(createTag("input").addClass("time-input form-control").attr("tabindex",-1).attr("readonly",true));h.append(f);h.append(g)}else{h.addClass("input-group");if(this.opts.size){h.addClass("input-group-"+this.opts.size)}h.append(createTag("span").addClass("input-group-addon icon-calendar"));h.append(d)}this.$elem.append(h.toString())},getValue:function(){return DatetimeUtils.format(this.getTypeValue(),"yyyyMMddHHmmss")},getText:function(){return DatetimeUtils.format(this.getTypeValue(),this.opts.mask)},getTypeValue:function(){return this.opts.value},setStartDate:function(d){this.options.min=DatetimeUtils.parse(d,this.options.mask);this.$dateInp.datepicker("setStartDate",this.options.min);return this},setEndDate:function(d){this.options.max=DatetimeUtils.parse(d,this.options.mask);this.$dateInp.datepicker("setEndDate",this.options.max);return this},trans2InpValue:function(d){return DatetimeUtils.parse(d,this.opts.mask)},getInput:function(){return this.$dateInp},getTooltipTarget:function(){return this.$dateInp},setTextValue:function(d){d=DatetimeUtils.format(d,this.opts.mask);this._super(d)},setInputValue:function(g){var h=g&&new Date(g.getFullYear(),g.getMonth(),g.getDate());this.$dateInp.datepicker("update",h);if(this._isTime()){var f=null;if(g){var e=this.opts.mask;var d=[DatetimeUtils._padding(g.getHours())];if(e.contains("mm")){d.push(DatetimeUtils._padding(g.getMinutes()))}if(e.contains("ss")){d.push(DatetimeUtils._padding(g.getSeconds()))}f=d.join(":")}this.$timeInp.val(f)}},_isTime:function(){var d=this.opts.mask;return d.contains("HH")||d.contains("mm")||d.contains("ss")},_disable:function(d){this.$dateInp.prop("disabled",d);this.$timeInp&&this.$timeInp.prop("disabled",d)},_readonly:function(d){this.$dateInp.prop("disabled",d);this.$timeInp&&this.$timeInp.prop("disabled",d)},_extraValidate:function(h){if(h){var e=this.options.mask;var i=TagUtils.validateDate(this.getTypeValue(),this.options.min,this.options.max,e);if(i){return i}if(this.$elem.hasClass("datetime-start")){var g=get(this.$elem.nextAll(".datetime-end")).getTypeValue();var d=this.getTypeValue();if(this._isTime()){if(g&&d>=g){return sprintf("请输入小于%s的日期",DatetimeUtils.format(g,e))}}else{if(g&&d>g){return sprintf("请输入小于等于%s的日期",DatetimeUtils.format(g,e))}}}if(this.$elem.hasClass("datetime-end")){var f=get(this.$elem.prevAll(".datetime-start")).getTypeValue();var d=this.getTypeValue();if(this._isTime()){if(f&&d<=f){return sprintf("请输入大于%s的日期",DatetimeUtils.format(f,e))}}else{if(f&&d<f){return sprintf("请输入大于等于%s的日期",DatetimeUtils.format(f,e))}}}}return this._super(h)},setValueWithoutView:function(e){var d=this.getTypeValue();if(this.isChange(e,d)){this._super(e)}return this},isChange:function(e,d){e=DatetimeUtils.format(e,"yyyyMMddHHmmss");d=DatetimeUtils.format(d,"yyyyMMddHHmmss");return this._super(e,d)},createTimeCombobox:function(f){var e=createTag("div").addClass("time-combobox").data("tag-id",this.options.tagId);if(f.contains("HH")){var d=createTag("div").addClass("time-combobox-select").appendTo(e);var k=createTag("ul").appendTo(d);for(var h=0;h<24;h++){createTag("li").append(h<10?"0"+h:h).appendTo(k)}if(f.contains("mm")){var g=createTag("div").addClass("time-combobox-select").appendTo(e);var j=createTag("ul").appendTo(g);for(var h=0;h<60;h++){createTag("li").append(h<10?"0"+h:h).appendTo(j)}if(f.contains("ss")){var l=createTag("div").addClass("time-combobox-select").appendTo(e);j.appendTo(l)}}}return e},hideTimeCombobox:function(){if(this.$timeInp.val()==""){var g=this.getTypeValue();var f=null;if(g){var e=this.opts.mask;var d=[DatetimeUtils._padding(g.getHours())];if(e.contains("mm")){d.push(DatetimeUtils._padding(g.getMinutes()))}if(e.contains("ss")){d.push(DatetimeUtils._padding(g.getSeconds()))}f=d.join(":")}this.$timeInp.val(f)}this.$timeCombobox.detach()}});c.fn.datetime=function(d,e){return c.fn.baseTag.apply(this,[d,e,a])};c.fn.datetime.constructor=a;a.DEFAULTS=c.extend({},c.fn.baseInputTag.constructor.DEFAULTS,{mask:"yyyy-MM-dd",min:null,max:null,size:"default",currentTime:null,isTableEdit:false});var b=c.fn.baseTag.constructor.extend({initTag:function(){var e=this.$elem.find(".ui-input").attr("data-toggle","datetime");c.parser.parse(this.options.pageProxy,this.$elem);var d=this.$elem.find(".date-input");if(d.length==2){e.eq(0).addClass("datetime-start");e.eq(1).addClass("datetime-end");this.$elem.datepicker({inputs:d})}},toggle:function(d){this.opts.hidden=typeof d==="boolean"?!d:!this.opts.hidden;this.$elem.toggle(d);this.$elem.find(".ui-input").each(function(){get(this).disableValidation()});return this},});c.fn.datetimeRange=function(d,e){return c.fn.baseTag.apply(this,[d,e,b])}}(window.jQuery);!function(b){var a=b.fn.baseSelectTag.constructor.extend({initInputViewEdit:function(){this.$boxGroup=this.$elem.find(".box-group");if(this.$boxGroup.length==0){this.$boxGroup=b(createTag("div").addClass("box-group").addClass("readonly",this.isReadonly()).addClass(this.options.cls).addClass("box-group-vertical",!this.options.horizontal).toString());this.$elem.append(this.$boxGroup)}var f=this;this.$boxGroup.on("checked",".box-control > input",function(){var g=[];f.getCheckboxes().each(function(){if(b(this).prop("checked")){g.push(b(this).val())}});f.setValueWithoutView(g);if(b(this).prop("checked")){var h=f._getOption(b(this).val());f.exec(f.opts.onSelect,[h])}else{var h=f._getOption(b(this).val());f.exec(f.opts.onUnselect,[h])}})},_readonly:function(f){this.$boxGroup.toggleClass("readonly",f)},_disable:function(f){this.$boxGroup.find(".box-control").toggleClass("disabled",f);this.getCheckboxes().prop("disabled",f)},disable:function(g,f){this.$boxGroup.find("[value="+g+"]").prop("disabled",f)},setInputValue:function(f){this.getCheckboxes().each(function(g){b(this).prop("checked",f.contains(b(this).val()))})},getCheckboxes:function(){return this.$boxGroup.find("[name="+this.getId()+"]")},_doLoadData:function(g){if(b.isArray(g)){var k=this.options,f=g.length,j=k.valueField,h=k.textField;var n=createTag("");for(var l=0;l<f;l++){var m=g[l];TagUtils.createCheckbox({type:k.type,text:m[h],name:this.getId(),value:m[j],disabled:k.disabled||m.disabled}).appendTo(n)}this.$boxGroup.html(n.toString());b.fn.checkbox.util.init(this.$boxGroup.find(".box-control"))}},focus:function(){this.$boxGroup.find("[name="+this.getId()+"]:eq(0)").focus()},getValue:function(){var f=this._super();if(this.opts.dataYesNo){if(this.opts.useBoolean){f=f?true:false}else{f=f?"1":"0"}}return f},trans2InpValue:function(f){if(this.opts.dataYesNo){if(this.opts.useBoolean){f=f?"1":null}else{f=f=="1"?f:null}}return this._super(f)}});a.DEFAULTS=b.extend({},b.fn.baseSelectTag.constructor.DEFAULTS,{horizontal:true});var c=a.extend({change:function(g,f){if(this.opts.dataYesNo){if(this.opts.useBoolean){g=g&&g.join("");g=g?true:false;f=f&&f.join("");f=f?true:false}else{g=g&&g.join("");g=g?"1":"0";f=f&&f.join("");f=f?"1":"0"}this.exec(this.opts.onChange,[g,f])}else{this._super(g,f)}}});b.fn.checkbox=function(f,g){return b.fn.baseTag.apply(this,[f,g,c])};b.fn.checkbox.util={init:function(g,f){f=b.extend({},f);g.off("click.checked").on("click.checked",function(n){var l=b(this);if(l.hasClass("disabled")||l.parent(".box-group").hasClass("readonly")){return false}if(f.onBeforeCheck){var k=b(this).find(":input");var h=f.onBeforeCheck.apply(k,[n,k.prop("checked")]);if(h===false){return false}}var m=b(this).find(":checkbox");if(m.length){var j=!m.prop("checked");m.prop("checked",j);if(f.onCheck){f.onCheck.apply(m,[n,j])}else{m.trigger("checked",[j])}return false}var i=b(this).find(":radio");if(i.length){var j=i.prop("checked");if(!j){i.prop("checked",true);if(f.onCheck){f.onCheck.apply(i,[n,true])}else{i.trigger("checked",[true])}}i.focus();return false}})}};b.fn.checkbox.constructor=c;c.DEFAULTS=b.extend({},a.DEFAULTS,{dataYesNo:null,multiple:true,type:"checkbox"});var d=a.extend({setInputValue:function(f){if(this.options.blankOpt&&!f.length){var g=this.trans2InpValue("");this.originalValue=g;this.options.value=g;this.getCheckboxes().eq(0).prop("checked",true)}else{this._super(f)}}});b.fn.radio=function(f,g){return b.fn.baseTag.apply(this,[f,g,d])};b.fn.radio.constructor=d;d.DEFAULTS=b.extend({},a.DEFAULTS,{multiple:false,type:"radio",selectFirst:false});var e=d.extend({setInputValue:function(f){if(this.options.blankOpt&&!f.length){var g=this.trans2InpValue("");this.originalValue=g;this.options.value=g;this.getCheckboxes().eq(0).prop("checked",true)}else{this._super(f)}}});b.fn.buttonRadio=function(f,g){return b.fn.baseTag.apply(this,[f,g,e])};b.fn.buttonRadio.constructor=e;e.DEFAULTS=b.extend({},d.DEFAULTS,{mode:null,outline:true})}(window.jQuery);!function(h){var g=function(i){var j="KB";if(i>=(1024*1024)){i=e(i/1024/1024);j="GB"}else{if(i>=1024){i=e(i/1024);j="MB"}else{if(i<0.05){i=0.1}else{i=e(i)}}}return i+j};h.util.getFileSize=g;var e=function(i){var j=parseInt(i);if(j==i){return j}else{return i.toFixed(1)}};var f=function(i){return{fileName:i.name,fileSize:i.size,suffix:i.name.substring(i.name.lastIndexOf(".")+1)}};var d=h.fn.baseTag.constructor.extend({initTag:function(){this.$fileInp=h(createTag("input").addClass("ui-upload-input").attr("type","file").attr("name","file").attr("accept",this.options.accept).attr("multiple",this.options.maxFileCnt>1).toString()).insertAfter(this.$elem);var j=this,i=j.options;this.$elem.off("click.uploadBtn").on("click.uploadBtn",function(k){if(!h(this).hasClass("disabled")&&!h(this).hasClass("readonly")&&!j.uploading){j.$fileInp.click()}});if(this.options.cropable){this.initCropImg()}else{this.$fileInp.on("change",function(n){var l=this.files;if(!l||l.length==0){return}j.uploading=true;var o=0,m=0;j.exec(i.onSelect,[l]);var k=function(){if(l.length==(o+m)){j.uploading=false;j.$fileInp.val("");j.exec(i.onUploadComplete)}};h.each(l,function(t,s){var u=f(s);var p=this.validate(u);if(p===true){var q={};if(i.encrypted){q.isEncrypted=true}var y=j.exec(i.onUploadBefore,[q,u,s]);if(y===false){m++;k.call(this);return}j.exec(i.onUploadStart,[u]);var r=new FormData();r.append("tagId",i.tagId);r.append("file",s);for(var w in q){var v=q[w]||"";v=v&&typeof v=="object"?JSON.stringify(v):v;r.append(w,v)}var x={url:i.uploadUrl,data:r,contentType:false,processData:false,onLoadSuccess:function(z){if(z&&z.success===false){m++;this.exec(i.onUploadError,[z.errorMsg,u,s])}else{o++;this.exec(i.onUploadSuccess,[z,u,s])}},onLoadError:function(z){m++;j.exec(i.onUploadError,[(z&&z.msg)||"系统异常",u,s])},onComplete:function(){k.call(this)}};if(i.onUploadProgress){x.xhr=function(){var z=h.ajaxSettings.xhr();if(z.upload){z.upload.addEventListener("progress",function(A){j.exec(i.onUploadProgress,[A,u])},false);return z}}}u.xhr=j.req(x)}else{m++;j.exec(i.onSelectError,[p,u,s]);k.call(this)}}.bind(j))})}},validate:function(k){var l=this.options;var j=l.fileType,i=true;if(j&&j!="*.*"){var m=j.split(",");if(!m.contains(k.suffix.toLowerCase())){return sprintf("只能上传[%s]类型的文件",j)}}if(k.fileSize<l.minFileSize*1024){return sprintf(d.DEFAULTS.minFileSizeText,g(l.minFileSize))}if(l.maxFileSize&&k.fileSize>l.maxFileSize*1024){return sprintf(d.DEFAULTS.maxFileSizeText,g(l.maxFileSize))}return true},isUploading:function(){return this.uploading},initCropImg:function(){var q=this,j=this.options;var n,p=null;this.$cropImgElem=h(q.options.cropImgHtmlTemplate);var s=q.$cropImgElem.filter(".crop-img-container");var k=s.find("img.original-img");var o=s.find(".spin-loading");var v=q.$cropImgElem.filter(".crop-img-footer-container");var m="";var u=v.find(".crop-img-hint-text");var l=j.minWidth&&j.maxWidth&&j.minHeight&&j.maxHeight&&j.minWidth==j.maxWidth&&j.minHeight==j.maxHeight;if(l){u.html("移动高亮区域，裁剪其为尺寸 "+j.minWidth+"×"+j.minHeight+" 的图片");m="裁剪框宽高必须为 "+j.minWidth+"×"+j.minHeight}else{if(j.aspectRatio){u.prepend("当前裁剪框宽高比例为 "+j.aspectRatio+"，尺寸为")}else{var r="";if(j.minWidth){if(j.maxWidth){r=sprintf("宽度限制为%s~%s，",j.minWidth,j.maxWidth)}else{r="宽度最小为"+j.minWidth+"，"}}else{if(j.maxWidth){r="宽度最大为"+j.maxWidth+"，"}}var t="";if(j.minHeight){if(j.maxHeight){t=sprintf("高度限制为%s~%s，",j.minHeight,j.maxHeight)}else{t="高度最小为"+j.minHeight+"，"}}else{if(j.maxHeight){t="高度最大为"+j.maxHeight+"，"}}if(r||t){m=sprintf("裁剪框的%s%s",r,t);u.prepend("当前裁剪框尺寸为 ");u.append(sprintf("，其%s%s",r,t))}else{u.prepend("当前裁剪框尺寸为")}}}var i=function(){q.uploading=false;q.$fileInp.val("");q.exec(j.onUploadComplete)};this.$fileInp.on("change",function(A){var z=this.files;if(!z||z.length==0){return}q.uploading=true;q.exec(j.onSelect,[z]);p=f(z[0]);var C=q.validate(p);if(C===true){n={};if(j.encrypted){n.isEncrypted=true}var w=q.exec(j.onUploadBefore,[n,p,z[0]]);if(w===false){i.call(q);return}h("body").css("overflow","hidden").append(q.$cropImgElem);v.toggle(false);o.toggle(true);var x={dragMode:"move",background:false,highlight:false,toggleDragModeOnDblclick:false,aspectRatio:j.aspectRatio,ready:function(){v.toggle(true);o.toggle(false);q.cropper=h(this).data("cropper")}};if(j.aspectRatio){if(typeof j.aspectRatio=="number"){x.aspectRatio=j.aspectRatio}else{var y=j.aspectRatio.split(":");if(y.length>1){x.aspectRatio=parseInt(y[0])/parseInt(y[1])}else{x.aspectRatio=parseFloat(j.aspectRatio)}}}if(j.minWidth){x.minCropBoxWidth=j.minWidth}if(j.maxWidth){x.maxCropBoxWidth=j.maxWidth}if(j.minHeight){x.minCropBoxHeight=j.minHeight}if(j.maxHeight){x.maxCropBoxHeight=j.maxHeight}if(l){x.cropBoxResizable=false}else{x.crop=function(){var D=h(this).data("cropper").getCropBoxData(true);D.width=D.width>4?D.width-4:0;D.height=D.height>4?D.height-4:0;u.find(".crop-box-width").text(D.width);u.find(".crop-box-height").text(D.height)}}var B=window.URL.createObjectURL(z[0]);k.attr("src",B).cropper(x)}else{q.exec(j.onSelectError,[C,p,z[0]]);i.call(q)}});v.find(".zoom-in-button").on("click",function(){if(q.cropper){q.cropper.zoom(0.1)}});v.find(".zoom-out-button").on("click",function(){if(q.cropper){q.cropper.zoom(-0.1)}});v.find(".reset-button").on("click",function(){if(q.cropper){q.cropper.reset()}});v.find(".rotate-left-button").on("click",function(){if(q.cropper){q.cropper.rotate(-90)}});v.find(".rotate-right-button").on("click",function(){if(q.cropper){q.cropper.rotate(90)}});v.find(".cancel-button").on("click",function(){i.call(q);h("body").css("overflow","");q.$cropImgElem.detach();k.cropper("destroy")});v.find(".crop-img-button").on("click",function(){var A=q.cropper.getCropBoxData(true);A.width=A.width>4?A.width-4:0;A.height=A.height>4?A.height-4:0;if(A.width==0||A.height==0){h.notify("裁剪框的尺寸不能为0","warning");return}else{if(l){A.width=j.minWidth;A.height=j.minHeight}else{if(m&&(j.minWidth&&A.width<j.minWidth)||(j.maxWidth&&A.width>j.maxWidth)||(j.minHeight&&A.heigth<j.minHeight)||(j.maxHeight&&A.heigth<j.maxHeight)){h.notify(m,"warning");return}}}q.exec(j.onUploadStart,[p]);var B=new FormData();B.append("tagId",j.tagId);B.append("file",q.$fileInp[0].files[0]);var w=q.cropper.getData(true);B.append("cropImgData",JSON.stringify(w));B.append("cropBoxData",JSON.stringify(A));for(var y in n){var z=n[y]||"";z=z&&typeof z=="object"?JSON.stringify(z):z;B.append(y,z)}var x={url:j.cropUploadUrl,data:B,contentType:false,processData:false,onLoadSuccess:function(C){if(C&&C.success===false){this.exec(j.onUploadError,[C.errorMsg,p,q.$fileInp[0].files[0]])}else{this.exec(j.onUploadSuccess,[C,p,q.$fileInp[0].files[0]])}},onLoadError:function(C){q.exec(j.onUploadError,[(C&&C.msg)||"系统异常",p,q.$fileInp[0].files[0]])},onComplete:function(){i.call(this)}};if(j.onUploadProgress){x.xhr=function(){var C=h.ajaxSettings.xhr();if(C.upload){C.upload.addEventListener("progress",function(D){q.exec(j.onUploadProgress,[D,p])},false);return C}}}p.xhr=q.req(x);h("body").css("overflow","");q.$cropImgElem.detach();k.cropper("destroy")})}});d.DEFAULTS={uploadUrl:"sysFile/uploadFile.do",fileType:"doc",maxFileSize:1024,minFileSize:0,maxFileCnt:1,maxFileCntText:"文件数量不能大于%s个",fileExistText:"文件【%s】已上传，确定要删除原文件吗？",maxFileSizeText:"文件大小不能大于%s",minFileSizeText:"文件大小不能小于%s",cropable:false,cropUploadUrl:"sysFile/cropUploadImg",cropImgHtmlTemplate:'<div class="crop-img-modal-backdrop"></div><div class="crop-img-container"><img class="original-img" style="max-width: 100%; display: none;" /><div class="spin-loading"><i class="icon icon-spinner icon-spin icon-3x"></i></div></div><div class="crop-img-footer-container">	  <div class="crop-img-hint-text"><span class="crop-box-width"></span>×<span class="crop-box-height"></span></div>	  <div class="crop-img-operate-container">	  	  <ul class="img-operate-list">		      <li title="放大" class="zoom-in-button"><i class="icon icon-search-plus-l"></i></li>			  <li title="缩小" class="zoom-out-button"><i class="icon icon-search-minus-l"></i></li>		  	  <li title="还原" class="reset-button"><i class="icon icon-return-left-l"></i></li>			  <li title="向左旋转" class="rotate-left-button"><i class="icon icon-anti-clockwise-l"></i></li>			  <li title="向右旋转" class="rotate-right-button"><i class="icon icon-clockwise-l"></i></li>		  </ul>		  <div class="crop-img-button-divider"></div>		  <span class="cancel-button"><i class="icon icon-times-l"></i>取消</span>		  <span class="crop-img-button"><i class="icon icon-check-l"></i>确定</span>	  </div></div>'};h.fn.uploadBtn=function(i,j){return h.fn.baseTag.apply(this,[i,j,d,"ez.uploadBtn"])};var c=h.fn.baseInputTag.constructor.extend({initInputView:function(){this.options.data={};this.btnEvents=[];this.$uploadCntr=this.$elem.find(".upload-cntr");this.$fileList=this.$uploadCntr.find(".ui-filelist");if(this.options.dataContext){var j=h.getContextData(this.options.dataContext);this.options.data=this._initFileMap(j)}var i=this;this.$fileList.on("click.download","a.download-file",function(m){if(i.options.downloadBtn){var l=h(this).closest(".ui-file");var k=l.attr("data-id");if(k){h.download(new Url("sysFile/downFile.do","fileId",k))}return false}}).on("click.file-btn",".file-btn",function(o){if((i.isDisabled()||i.isReadonly())&&!h(this).hasClass("preview-file-button")&&!h(this).hasClass("download-file-button")){return false}var m=h(this).attr("fn-index");var n=i.btnEvents[m];if(n){var l=h(this).closest(".ui-file");var k=l.attr("data-id");i.exec(n,[i.opts.data[k],l])}return false});this._super()},initInputViewEdit:function(){this.initUploadBtn()},initUploadBtn:function(){var i=this;this.$uploadBtn=this.$uploadCntr.find(".ui-upload-btn");this.$uploadBtn.uploadBtn({tagId:this.options.tagId,encrypted:this.options.encrypted,uploadUrl:this.options.uploadUrl,fileType:this.opts.fileType,maxFileSize:this.opts.maxFileSize,minFileSize:this.opts.minFileSize,maxFileCnt:this.opts.maxFileCnt,onUploadBefore:function(o,l,k){var j=i.exec(i.opts.onUploadBefore,[o,l,k]);if(j===false){i.addFile(k,"cancel");return false}var m=i.getRptNameFile(l.fileName);var n=null;if(m){n=sprintf(i.opts.fileExistText,l.fileName)}else{if(i.opts.maxFileCnt==1&&i.getValue()){m=i.getValue();n="最多上传一个文件，是否删除已上传文件？"}}if(n){if(confirm(n)){i.deleteFile(m)}else{i.addFile(l,"cancel");return false}}if(i.opts.maxFileCnt>1&&i.$fileList.find(".success, .ing, .init").length+1>i.opts.maxFileCnt){i.addFile(l,"fail",sprintf(i.opts.maxFileCntText,i.opts.maxFileCnt));return false}},onUploadStart:function(j){j.fileDiv=i.addFile(j,"ing")},onUploadProgress:function(l,k){var j=parseInt(l.loaded/(l.total+100)*100);k.fileDiv.find(".file-status span").text(sprintf("%s%",j))},onUploadSuccess:function(l,k){var j=l.fileId;h.extend(k,{fileId:j,path:l.path});i.opts.data[j]=k;h.notify(sprintf("【%s】上传成功",k.fileName),"success");i.replaceFile(k.fileDiv,k,"success");i.exec(i.opts.onUploadSuccess,[k,l])},onUploadComplete:function(){h(i.$uploadBtn).text("浏览文件");var j=[];i.$fileList.find("[data-id]").each(function(){j.push(h(this).data("id"))});if(j.join(",")!=i.getValue()){i.setValueWithoutView(j)}},onUploadError:function(k,j){i.replaceFile(j.fileDiv,j,"fail",sprintf("【%s】上传失败，%s",j.fileName,k))},onSelectError:function(k,j){i.addFile(j,"fail",k)}});this.uploadBtn=this.$uploadBtn.data("ez.uploadBtn")},getValue:function(){var k=this.getTypeValue();var l=[];var j=k.length;if(j){for(var m=0;m<j;m++){if(k[m]!=""){l.push(k[m])}}}return TagUtils.arrayToStr(l)},getTypeValue:function(){return this.options.value.concat()},getText:function(){var j=this.getTypeValue();var m=[];for(var k=0;k<j.length;k++){var l=j[k];var n=this._getFileName(l)||l;m.push(n)}return m.join(",")},trans2InpValue:function(o){o=TagUtils.strToArray(o);var n=this.opts,j=o.length;if(j){for(var l=0;l<j;l++){var k=o[l];if(!(k in n.data)){var m=h.req({url:new Url(n.dataUrl,"fileIds",o),async:false,context:this});n.data=this._initFileMap(m);break}}}return o},setViewValue:function(l){var n=createTag("");var j=l.length;if(j){for(var m=0;m<j;m++){var k=l[m];n.append(this.initFileTag(this.opts.data[k],"init"))}}this.$fileList.html(n.toString());TagUtils.transformToCollapsed(this.$fileList,this.options.pureText)},getRptNameFile:function(l){var j=false;var k=this.getTypeValue();for(var m=0;m<k.length;m++){var n=this._getFileName(k[m]);if(l==n){j=k[m];break}}return j},_initFileMap:function(l){var k={};if(h.isArray(l)){for(var j=0;j<l.length;j++){k[l[j].fileId]=l[j]}}return k},_readonly:function(i){this._disable(i)},_disable:function(i){get(this.$uploadBtn).setDisabled(i);this.$fileList.find(".file-operate").toggleClass("disabled",i)},_getFileName:function(i){var j=this.opts.data[i];return j&&j.fileName},addFile:function(k,i,l){var j=h(this.initFileTag(k,i,l).toString());if(i=="fail"){this.initFailTooltip(j,l)}this.$fileList.append(j);return j},replaceFile:function(m,k,i,l){var j=h(this.initFileTag(k,i,l).toString());if(i=="fail"){this.initFailTooltip(j,l)}m.replaceWith(j)},deleteFile:function(i){var j=this.$fileList.find("div[data-id='"+i+"']");j.remove()},initFailTooltip:function(i,j){i.tooltip({type:"danger",position:"auto top",title:j});h.notify(j,"danger")},initFileTag:function(B,t){if(!B){return null}var C=B.fileName;var z=createTag("div").addClass("ui-file").addClass(t).attr("data-id",B.fileId);var q=createTag("div").addClass("file-name").attr("title",C).appendTo(z);var D=createTag("i").addClass("icon").appendTo(q);if(t=="ing"){D.addClass("icon-spinner icon-spin")}else{D.addClass("icon-paperclip")}if(t=="init"||t=="success"){TagUtils.createHref({text:C,cls:"download-file"}).appendTo(q)}else{var A=createTag("span").append(C).appendTo(q);if(t=="fail"){A.addClass("fail")}}var k=createTag("div").addClass("file-size").appendTo(z);createTag("span").append(g(B.fileSize/1024)).appendTo(k);if(t!="init"){var u=createTag("div").addClass("file-status").addClass("ui-ellipsis").appendTo(z);createTag("span").append(this.getFileStatus(t)).appendTo(u)}var p=createTag("div").addClass("file-operate").appendTo(z);if(this.isDisabled()){p.addClass("disabled")}var x=[];if(!this.isPureText()){if(this.options.sortBtn&&this.options.maxFileSize>1){x.push({text:"↑",cls:"up-file-button",onClick:function(E,i){var F=i.prev();if(F.length===0){return}F.insertAfter(i);if(E){var j=[];this.$fileList.find("[data-id]").each(function(){j.push(h(this).data("id"))});this.setValueWithoutView(j)}}});x.push({text:"↓",cls:"down-file-button",onClick:function(E,i){var F=i.next();if(F.length===0){return}F.insertBefore(i);if(E){var j=[];this.$fileList.find("[data-id]").each(function(){j.push(h(this).data("id"))});this.setValueWithoutView(j)}}})}x.push({text:"删除",cls:"delete-file-button",onClick:function(F,E){if(F){E.remove();var j=F.fileId;var i=this.getTypeValue();i.remove(j);this.setValueWithoutView(i)}else{E.tooltip("destroy");var G=E.data("xhr");E.remove();G&&G.abort()}}})}if(t=="init"||t=="success"){if(this.options.previewBtn&&this.options.fileSuffixsImg.contains(B.suffix.toLowerCase())){var m=this.options.encrypted?("sysFile/viewImg/"+B.fileId):this.options.baseImgUrl+B.path;createTag("img").attr("src","").data("path",m).appendTo(q);x.push({text:"预览",cls:"preview-file-button",onClick:function(i){this.initPreviewImg(this.$elem.find("[data-id='"+i.fileId+"'] img"))}})}if(this.options.previewBtn&&"pdf"==B.suffix.toLowerCase()){x.push({text:"预览",cls:"preview-file-button",onClick:function(i){window.open("sysFile/pdf/"+i.fileId)}})}if(this.options.downloadBtn){x.push({text:"下载",cls:"download-file-button",onClick:function(i){h.download(new Url("sysFile/downFile.do","fileId",i.fileId))}})}var l=this.opts.onBtnInit;if(l){var s=this.exec(l);for(var w=0;w<s.length;w++){var o=s[w];if("下载"==o.text||"预览"==o.text){continue}x.push(o)}}}for(var w=0;w<x.length;w++){var o=x[w];var n=o.onClick,y=this.btnEvents.length,r=-1;for(var v=0;v<y;v++){if(this.btnEvents[v].toString()==n.toString()){r=v}}if(r==-1){r=y;this.btnEvents.push(n)}TagUtils.createHref({text:o.text,cls:o.cls?o.cls+" file-btn":"file-btn",iconCls:o.iconCls,disabled:o.disabled,attrs:{"fn-index":r}}).appendTo(p);if(w<x.length-1){createTag("span").addClass("btn-linked-split").appendTo(p)}}return z},getFileStatus:function(j){var i=null;switch(j){case"success":i="上传成功";break;case"fail":i="上传失败";break;case"ing":i="等待上传";break;case"cancel":i="已取消";break;default:break}return i},getSuccessCount:function(){return this.$fileList.find(".ui-file.success").length},getFailCount:function(){return this.$fileList.find(".ui-file.fail").length},isMultiple:function(){return this.opts.maxFileCnt>1},getInput:function(){return this.$uploadBtn},getTooltipTarget:function(){return this.$uploadBtn},_extraValidate:function(k){var i=true,j=this.opts;if(this.uploadBtn.isUploading()){i="文件上传中，不能提交";this.focus()}if(i===true&&j.maxFileCnt>1){if(this.getTypeValue().length>j.maxFileCnt){i=sprintf(j.maxFileCntText,j.maxFileCnt)}}return i},isChange:function(j,i){j=j.join(",");i=i.join(",");var k=this._super(j,i);if(!k){k=this.$fileList.find(".ui-file").length>0}return k},change:function(j,i){if(!this.isMultiple()){j=TagUtils.arrayToStr(j);i=TagUtils.arrayToStr(i)}this._super(j,i)},initPreviewImg:function(k){var j=null;if(this.options.pageProxy){j=this.options.pageProxy.page}else{j=h(document.body)}var l=null;j.find("[data-toggle='uploadImg'], [data-toggle='upload']").each(function(){var m=h(this).data("toggle");if(m=="uploadImg"){var n=get(h(this));if(n.options.previewable&&n.getTypeValue().length){var p=n.$elem.find(".ez-upload-list-item:not(.upload-fail, .uploading, .loading, .error)>.upload-img-wrapper>img:first-child");if(l){l=l.add(p)}else{l=p}}}else{if(m=="upload"){var o=get(h(this));if(o.options.previewBtn){var p=o.$elem.find("img");if(l){l=l.add(p)}else{l=p}}}}});if(l){var i=l.index(k);j.viewer({initialViewIndex:i,url:function(n){var o=get(h(n).closest("[data-toggle='uploadImg']"));if(o){return h(n).attr("src")}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return h(n).data("path")}}},scalable:false,title:function(o,q,n){var p=get(h(n).closest("[data-toggle='uploadImg']"));if(p&&p.options.label){return p.options.label}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return h(n).closest(".file-name").attr("title")}else{return null}}},filter:function(n){var o=h(n);if(o.hasClass("id-card-modal")){return false}var q=get(o.closest("[data-toggle='uploadImg']"));if(q&&q.options.previewable&&q.getTypeValue().length){var p=o.closest(".ez-upload-list-item:not(.upload-fail, .uploading, .loading, .error)");if(p.length){return true}}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return true}}return false},hide:function(){j.viewer("destroy")}}).viewer("show")}},createTag:function(){var l=createTag("div").addClass("upload-cntr");var i=this.options.maxFileCnt!=null&&this.options.maxFileCnt>1;if(i){l.addClass("multiple")}var k=createTag("div").addClass("upload-btn-wrapper").appendTo(l);var j={type:"default",text:"浏览文件",cls:"ui-upload-btn",iconCls:"icon-upload",size:this.options.size,outline:true,disabled:this.options.disabled||this.options.readonly,};TagUtils.createButton(j).appendTo(k);createTag("div").addClass("ui-filelist").appendTo(l);this.$elem.append(l.toString()).attr("data-toggle","upload")}});h.fn.upload=function(i,j){return h.fn.baseTag.apply(this,[i,j,c])};h.fn.upload.constructor=c;c.DEFAULTS=h.extend({},h.fn.baseInputTag.constructor.DEFAULTS,d.DEFAULTS,{showUploadTip:true,dataUrl:"sysFile/getFileMap.do",fileExistText:"文件【%s】已上传，确定要删除原文件吗？",fileSuffixsDoc:["doc","docx","pdf","xls","xlsx"],fileSuffixsImg:["gif","png","jpg","jpeg","bmp"],previewBtn:true,downloadBtn:true,onUploadSuccess:null,onDownload:function(i){h.download(new Url("sysFile/downFile.do","fileId",i.fileId))}});var b=h.fn.baseInputTag.constructor.extend({initInputView:function(){this.options.data={};this.$uploadCard=this.$elem.find(".ez-upload-picture-card-wrapper");this.$uploadImgList=this.$uploadCard.find(".ez-upload-list-picture-card");this.$uploadBtn=this.$uploadImgList.find(".ez-upload-select-picture-card");this._super();if(this.options.dataContext){this.options.data=h.getContextData(this.options.dataContext)}var i=this;this.$uploadImgList.on("click.detele",".icon-trash",function(k){if(i.isDisabled()||i.isReadonly()||i.isPureText()){return false}var j=h(this).closest(".ez-upload-list-item");i.deleteImg(j);k.stopPropagation()});this.$uploadImgList.on("click.upload",".ez-upload-list-item",function(){if(i.isDisabled()||i.isReadonly()||i.isPureText()){return false}if(i.options.maxFileCnt==1){i.$uploadBtn.click()}h(this).focus()});if(this.options.previewable){this.$uploadImgList.on("click.previewable",".icon-eye",function(k){k.stopPropagation();var j=h(this).closest(".ez-upload-list-item").find(".upload-img-wrapper>img:first-child");i.initPreviewImg(j)})}},initInputViewEdit:function(){var j=this,i=null;this.$uploadBtn.uploadBtn({tagId:this.options.tagId,accept:"image/*",fileType:this.options.fileType,uploadUrl:this.options.uploadUrl,encrypted:this.options.encrypted,maxFileSize:this.opts.maxFileSize,minFileSize:this.opts.minFileSize,maxFileCnt:this.opts.maxFileCnt,cropable:this.opts.cropable,aspectRatio:this.opts.aspectRatio,minWidth:this.opts.minWidth,maxWidth:this.opts.maxWidth,minHeight:this.opts.minHeight,maxHeight:this.opts.maxHeight,onSelect:function(){i=j.getTypeValue()},onSelectError:function(n,l,k){var p=window.URL.createObjectURL(k);if(j.options.maxFileCnt==1){var o=j.$uploadImgList.find(".ez-upload-list-item");j.deleteImg(o);j.$uploadBtn.addClass("hidden")}var m=h(j.createImgItem().toString());j.$uploadBtn.before(m);m.addClass("upload-fail").find(".upload-img-wrapper > img:first-child").attr("src",p);m.find(".ez-upload-list-item-actions").html("<span class='upload-fail-text'>上传失败</span><i class='icon icon-trash'></i>");m.tooltip({title:n,type:"danger",position:"auto top"});h.notify(sprintf("【%s】上传失败，%s",l.fileName,n),"danger")},onUploadBefore:function(p,m,l){var k=j.exec(j.opts.onUploadBefore,[p,m,l]);if(k===false){h.notify("已取消上传","danger");return false}if(j.opts.maxFileCnt>1&&j.$uploadImgList.find(".ez-upload-list-item:not(.upload-fail)").length+1>j.opts.maxFileCnt){var o=window.URL.createObjectURL(l);var n=h(j.createImgItem().toString());j.$uploadBtn.before(n);n.addClass("upload-fail").find(".upload-img-wrapper > img:first-child").attr("src",o);n.find(".ez-upload-list-item-actions").html("<span class='upload-fail-text'>上传失败</span><i class='icon icon-trash'></i>");n.tooltip({title:sprintf(j.opts.maxFileCntText,j.opts.maxFileCnt),type:"danger",position:"auto top"});return false}},onUploadStart:function(k){if(j.options.maxFileCnt==1){var l=j.$uploadImgList.find(".ez-upload-list-item");i.remove(j.getValue());j.deleteImg(l);j.$uploadBtn.addClass("hidden")}k.itemElem=h(j.createImgItem("uploading").toString());j.$uploadBtn.before(k.itemElem)},onUploadProgress:function(m,l){var k=parseInt(m.loaded/(m.total+100)*100);l.itemElem.find(".ez-upload-status > div").text(sprintf("已上传%s%",k))},onUploadSuccess:function(n,l,m){var k=n.fileId;i.push(k);h.extend(l,{fileId:k,path:n.path});j.opts.data[k]=n.path;j.initImgEvent(l.itemElem.find(".upload-img-wrapper > img:first-child"));l.itemElem.removeClass("uploading").attr("file-id",k);l.itemElem.find(".upload-img-wrapper > img:first-child").attr("src",j.options.encrypted?("sysFile/viewImg/"+k):j.options.baseImgUrl+n.path);h.notify(sprintf("【%s】上传成功",l.fileName),"success");j.exec(j.opts.onUploadSuccess,[l])},onUploadComplete:function(){if(j.options.maxFileCnt>1&&i.length>=j.options.maxFileCnt){j.$uploadBtn.addClass("disabled")}if(i.join(",")!=j.getValue()){j.setValueWithoutView(i)}},onUploadError:function(n,l,k){var m=window.URL.createObjectURL(k);l.itemElem.removeClass("uploading").addClass("upload-fail").find(".upload-img-wrapper > img:first-child").attr("src",m);l.itemElem.find(".ez-upload-list-item-actions").html("<span class='upload-fail-text'>上传失败</span><i class='icon icon-trash'></i>");l.itemElem.tooltip({title:n,type:"danger",position:"auto top"});h.notify(sprintf("【%s】上传失败，%s",l.fileName,n),"danger")}});this.uploadBtn=this.$uploadBtn.data("ez.uploadBtn");if(this.options.showUploadTip){this.initHintText()}},_readonly:function(i){this.$uploadBtn.toggleClass("readonly",i);this.$uploadCard.toggleClass("readonly",i)},_disable:function(i){if(this.options.maxFileCnt==1||i||this.getTypeValue().length<this.options.maxFileCnt){this.$uploadBtn.toggleClass("disabled",i)}this.$uploadCard.toggleClass("disabled",i)},setViewValue:function(l){this.$uploadImgList.find(".ez-upload-list-item").remove();var j=l.length;if(j){if(this.options.maxFileCnt==1){this.$uploadBtn.addClass("hidden")}else{if(j>=this.options.maxFileCnt){this.$uploadBtn.addClass("disabled")}else{if(!this.isDisabled()){this.$uploadBtn.removeClass("disabled")}}}var o=createTag("");for(var m=0;m<j;m++){var k=l[m];o.append(this.createImgItem("loading").attr("file-id",k))}this.$uploadBtn.before(o.toString());o=this.$uploadImgList.find(".ez-upload-list-item");this.initImgEvent(o.find(".upload-img-wrapper > img:first-child"));for(var m=0;m<j;m++){var k=l[m];var n=this.$uploadImgList.find(".ez-upload-list-item[file-id='"+k+"']");if(this.opts.data[k]){n.find(".upload-img-wrapper > img:first-child").attr("src",this.options.encrypted?("sysFile/viewImg/"+k):(this.options.baseImgUrl+this.opts.data[k]))}else{n.removeClass("loading").addClass("error").find(".ez-upload-status").html("<i class='icon icon-times-circle-o'></i><div>找不到图片</div>");n.find(".ez-upload-list-item-actions").html("<i class='icon icon-trash'></i>")}}}else{if(this.isPureText()){this.$uploadBtn.before(this.createImgItem("defalut").toString())}else{this.$uploadBtn.removeClass("hidden")}if(this.options.uploadType){this.$uploadCard.addClass("id-card")}}},trans2InpValue:function(n){n=TagUtils.strToArray(n);var m=this.opts,j=n.length;if(j){for(var l=0;l<j;l++){var k=n[l];if(!(k in m.data)){var o=h.req({url:new Url(m.dataUrl,"fileIds",n),async:false,context:this});m.data=o;break}}}return n},getTypeValue:function(){return this.options.value.concat()},getValue:function(){var k=this.getTypeValue();var l=[];var j=k.length;if(j){for(var m=0;m<j;m++){if(k[m]!=""){l.push(k[m])}}}return TagUtils.arrayToStr(l)},isMultiple:function(){return this.opts.maxFileCnt>1},getInput:function(){return this.$uploadBtn},getTooltipTarget:function(){if(this.options.maxFileCnt==1){var i=this.$uploadImgList.find(".ez-upload-list-item");if(i.length){return i}}return this.$uploadBtn},_extraValidate:function(k){var i=true,j=this.opts;if(this.uploadBtn.isUploading()){i="文件上传中，不能提交";this.focus()}if(i===true&&j.maxFileCnt>1){if(this.getTypeValue().length>j.maxFileCnt){i=sprintf(j.maxFileCntText,j.maxFileCnt)}}return i},createImgItem:function(j){var m=createTag("div").addClass("ez-upload-list-item").attr("tabindex",0);var i=createTag("div").addClass("upload-img-wrapper").appendTo(m);var l=createTag("img").attr("alt","图片加载失败").appendTo(i);if(!this.isPureText()&&this.options.maxFileCnt==1){l.attr("title","点击重新上传")}if(this.options.imgWidth){m.css("width",this.options.imgWidth+18).css("min-width","auto");l.css("width",this.options.imgWidth).css("min-width","auto");if(this.options.imgHeight==null){m.css("height","auto");l.css("height","auto")}else{m.css("height",this.options.imgHeight+18);l.css("height",this.options.imgHeight)}}else{if(this.options.imgHeight){m.css("height",this.options.imgHeight+18);l.css("height",this.options.imgHeight)}}if("idCard"==this.options.uploadType){createTag("img").addClass("id-card-modal").attr("src","source/framework/img/upload/id-card-modal.png").appendTo(i)}else{if("idCardReverse"==this.options.uploadType){createTag("img").addClass("id-card-modal").attr("src","source/framework/img/upload/id-card-reverse-modal.png").appendTo(i)}}createTag("div").addClass("ez-upload-list-item-actions").appendTo(m);var k=createTag("div").addClass("ez-upload-status").appendTo(m);if(j){switch(j){case"uploading":m.addClass("uploading");k.append("<i class='icon icon-spinner icon-spin'></i><div>等待上传</div>");break;case"loading":m.addClass("loading");k.append("<i class='icon icon-spinner icon-spin'></i><div>图片加载中</div>");break;case"defalut":m.addClass("defalut");k.append("<i class='icon icon-image-o'></i><div>未上传</div>");break;default:break}}return m},deleteImg:function(k){if(!k.length){return}var j=k.attr("file-id");if(!j){k.tooltip("destroy");k.remove();this.$uploadBtn.removeClass("hidden")}else{k.remove();var i=this.getTypeValue();i.remove(j);if(this.options.maxFileCnt==1){this.$uploadBtn.removeClass("hidden")}else{if(i.length+1==this.options.maxFileCnt){this.$uploadBtn.removeClass("disabled")}}this.setValueWithoutView(i)}},initImgEvent:function(i){var j=this;i.on("load",function(){var k=h(this).closest(".ez-upload-list-item");k.removeClass("uploading loading").find(".ez-upload-list-item-actions").append("<i class='icon icon-eye'></i><i class='icon icon-trash'></i>")}).on("error",function(){var k=h(this).closest(".ez-upload-list-item");k.removeClass("uploading loading").addClass("error").find(".ez-upload-status").html("<i class='icon icon-times-circle-o'></i><p>加载失败</p>");k.find(".ez-upload-list-item-actions").html("<i class='icon icon-trash'></i>")})},initHintText:function(){var j=this.options;var m=[];if(j.uploadTipRender){this.exec(j.uploadTipRender,[m])}var l=createTag("");for(var k=0;k<m.length;k++){createTag("li").append(m[k]).appendTo(l)}this.$uploadCard.find(".ez-upload-hint-text > ol").append(l.toString())},initPreviewImg:function(k){var j=h(document.body);var l=null;j.find("[data-toggle='uploadImg'], [data-toggle='upload']").each(function(){var m=h(this).data("toggle");if(m=="uploadImg"){var n=get(h(this));if(n.options.previewable&&n.getTypeValue().length){var p=n.$elem.find(".ez-upload-list-item:not(.upload-fail, .uploading, .loading, .error)>.upload-img-wrapper>img:first-child");if(l){l=l.add(p)}else{l=p}}}else{if(m=="upload"){var o=get(h(this));if(o.options.previewBtn){var p=o.$elem.find("img");if(l){l=l.add(p)}else{l=p}}}}});if(l){var i=l.index(k);j.viewer({initialViewIndex:i,url:function(n){var o=get(h(n).closest("[data-toggle='uploadImg']"));if(o){return h(n).attr("src")}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return h(n).data("path")}}},scalable:false,title:function(o,q,n){var p=get(h(n).closest("[data-toggle='uploadImg']"));if(p&&p.options.label){return p.options.label}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return h(n).closest(".file-name").attr("title")}else{return null}}},filter:function(n){var o=h(n);if(o.hasClass("id-card-modal")){return false}var q=get(o.closest("[data-toggle='uploadImg']"));if(q&&q.options.previewable&&q.getTypeValue().length){var p=o.closest(".ez-upload-list-item:not(.upload-fail, .uploading, .loading, .error)");if(p.length){return true}}else{var m=get(h(n).closest("[data-toggle='upload']"));if(m&&m.options.previewBtn){return true}}return false},hide:function(){j.viewer("destroy")}}).viewer("show")}}});h.fn.uploadImg=function(i,j){return h.fn.baseTag.apply(this,[i,j,b])};h.fn.uploadImg.constructor=b;b.DEFAULTS=h.extend({},c.DEFAULTS,{chooseFileText:"浏览图片",fileType:"img",dataUrl:"sysFile/getImgUrlMap",uploadType:null,uploadTipRender:null,baseImgType:"gif、png、jpg、jpeg、bmp",cropable:false,aspectRatio:null});var a=h.fn.baseTag.constructor.extend({initTag:function(){},toggle:function(i){this.opts.hidden=typeof i==="boolean"?!i:!this.opts.hidden;this.$elem.toggle(i);return this},show:function(){this.opts.hidden=false;this.$elem.show();return this},hide:function(){this.opts.hidden=true;this.$elem.hide();return this}});h.fn.idCard=function(i,j){return h.fn.baseTag.apply(this,[i,j,a])};h.fn.idCard.constructor=a;a.DEFAULTS=h.extend({},b.DEFAULTS)}(window.jQuery);!function(b){var a=b.fn.baseInputTag.constructor.extend({initInputView:function(){if(!this.options.pureText){var e=this.$elem.find("textarea");var d=e.val();if(d){this.options.value=d}}else{var c=this.$elem.find(".editor-text");var d=c.html();if(d){this.options.value=d}}this._super()},initInputViewEdit:function(){if(typeof CKEDITOR==="undefined"){throw new Error("ezui.editor requires ckeditor")}var d=this.opts.tagId;var c={filebrowserImageBrowseLinkUrl:"",filebrowserUploadUrl:b.util.getBaseUrl()+"/sysFile/editorUpload?type=file&tagId="+d,filebrowserImageUploadUrl:b.util.getBaseUrl()+"/sysFile/editorUpload?type=image&tagId="+d,readOnly:this.opts.readonly,height:this.opts.height,wordcount:{showWordCount:false,showParagraphs:false,showCharCount:true,maxCharCount:this.opts.max||10000,warnOnLimitOnly:true},allowedContent:true,on:{dialogShow:function(h){var g=h.data;if(g.getName()=="image2"){var f=g.getContentElement("info","src");if(f){f.disable()}g.selectPage("Upload")}}}};if(this.options.pluginsConfig){this.exec(this.options.pluginsConfig,[c])}this.$input=this.$elem.find("textarea");this.editor=CKEDITOR.replace(this.$input[0],c);var e=this;this.editor.on("instanceReady",function(){e.getInput().addClass(e.options.cls);e.exec(e.options.onEditorReady,[e])});this.editor.on("change",function(){var j=this.getData();if(e.getValue()!=(j.trim()||null)){if(j){var k=false;var g=false;var f=b("<div>"+j+"</div>");var i=e.options.baseImgUrl;f.find("img").each(function(){var l=b(this).attr("src");if(l&&!l.contains(i)){if(l.contains("file:///")){g=true}else{if(!l.contains("data:image")){if(!e.options.enableExternalLink){k=true;b(this).attr("src","")}}}}});if(g){Message.warning("粘贴内容包含本地图片，无权访问，请重新上传图片或者使用WPS复制粘贴")}if(k){var h=this;Message.warning("粘贴内容包含外链图片，无权访问，请重新上传图片");setTimeout(function(){h.setData(f.html())},100);return}j=j.substring(0,j.length-1)}e.setValueWithoutView(j||null)}});this.editor.on("focus",function(){b(document.body).trigger("mousedown");e.exec(e.options.onFocus)})},_readonly:function(c){this.editor.setReadOnly(c)},_disable:function(c){this._readonly(c)},setTextValue:function(c){var d=this.$elem.find(".editor-text");if(c){d.html(c);if(this.options.collapsed){TagUtils.transformToCollapsed(d,this.options.pureText)}}else{d.html(TagUtils.createEmpty().toString())}},setInputValue:function(c){this.$input.html(c);this.editor.setData(c||"")},focus:function(){if(this.isPureText()){return}this.$elem.attr("tabindex","0").focus();this.editor.focus();return this},validate:function(c,d){return this._super("auto top",d)},getInput:function(){return this.$input.next()},getTooltipTarget:function(){return this.$input.next()},getCharCount:function(){return this.editor.wordCount.charCount},_extraValidate:function(l){var c=this.editor.wordCount.charCount;var g=this.options.min;var k=this.options.max||10000;var m=g>0;var e=k>1;var d=null;if(m&&e){if(c<g||c>k){d=sprintf("文本长度不能小于%s字，超过%s字",NumberUtils.toFixed(g),parseInt(k))}}else{if(e){if(c>k){d=sprintf("文本长度不能超过%s字",parseInt(k))}}else{if(m){if(c<g){d=sprintf("文本长度不能小于%s字",NumberUtils.toFixed(g))}}}}if(d){return d}if(l!=null){var f=b("<div>"+l+"</div>");var j=this.options.baseImgUrl;var h=null;var i=this;f.find("img").each(function(){var n=b(this).attr("src");if(n&&n.contains("data:image")){return true}if(n&&n.contains("file:///")){h="粘贴内容包含本地图片，无权访问，请重新上传图片或者使用WPS复制粘贴。";return false}if(!i.options.enableExternalLink){if(!n||!n.contains(j)){h="粘贴内容包含外链图片，无权访问，请重新上传图片。";return false}}});if(h){return h}}return true}});b.fn.editor=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.editor.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseInputTag.constructor.DEFAULTS,{uploadUrl:"sysFile/ueditor",lang:"zh_CN",onIconInit:null,height:200,min:0,max:10000,collapsed:true,lengthText:"输入内容长度必须介于{0}和{1}之间",uploadingText:"文本编辑器中还有图片正在上传，请稍等",pluginsConfig:null})}(window.jQuery);!function(c){c(window).off("resize.modal.draggable").on("resize.modal.draggable",function(){c(".modal-content").css({top:0,left:0})});var a=c.fn.baseTag.constructor.extend({initTag:function(){var e=this.options;this._isSubmit=false;if(e.draggable){this.$elem.find(".modal-content").draggable({handle:".modal-header",containment:"parent"});this.$elem.find(".modal-header").css("cursor","move")}if(this.$elem.attr("data-toggle")){if(e.buttons){var g=this.createFooter(e.buttons);this.$elem.find(".modal-body:first").after(g.toString())}}this.$header=this.$elem.find(".modal-header");this.$body=this.$elem.find(".modal-body");this.$footer=this.$elem.find(".modal-footer");if(c.browser.msie){this.$body.css("max-height","76vh")}var f=this;this.$header.find(".max").on("click",function(){if(c(this).children().hasClass("icon-expand")){c(this).html('<i class="icon-minus"></i>');c(this).parents(".modal-content").addClass("modal-content-max").css("width","100%")}else{c(this).html('<i class="icon-expand"></i>');c(this).parents(".modal-content").removeClass("modal-content-max").css("width",e.width)}});this.$elem.on("hide.bs.modal",function(i){if(i.namespace!="bs.modal"){return false}i.stopPropagation();var h=true;if(TagUtils.isFormModify(f.$body)){h=confirm("离开此网站？\n系统可能不会保存您所做的更改。")}if(h&&e.onBeforeClose){h=f.exec(e.onBeforeClose)}return h}).on("hidden.bs.modal",function(h){h.stopPropagation();c(window).off("resize."+f.options.tagId);var i=f.$elem.find(".ui-input-invalid, .invalid-table");c.each(i,function(){if(c(this).data("ez.tooltip")){c(this).tooltip("destroy")}});f.exec(e.onClose)});this.$body.on("scroll.modal-body",function(){var h=f.$elem.find(".ui-input-invalid, .invalid-table");c.each(h,function(){if(c(this).data("ez.tooltip")){c(this).tooltip("hide")}})});if(e.url){var d=new c.pageProxy(this.$body,e.pageProxy);this.$body.data("pageProxy",d);e.pageProxy=d}c.parser.parse(e.pageProxy,this.$footer,true);if(e.shown){this.show()}},show:function(){if(this.options.url&&!this.loaded){this.loaded=true;this.refresh()}this._isSubmit=false;this.$elem.modal("show");if(c.bootstrapTable){this.$elem.find("[data-toggle='grid']").bootstrapTable("resetView")}return this},hide:function(){if(this.options.closable){this.$elem.modal("hide")}return this},refresh:function(d){d=c.isPlainObject(d)?d:{url:d||this.opts.url};if(this.opts.openWithModalTag){this.$elem.modal("hide")}c.extend(this.opts,d,{context:this,onLoading:function(){this.$footer.find("button.ezui").each(function(){get(this).openLoadingDisabled()});this.exec(d.onLoading)},onComplete:function(e){this.$footer.find("button.ezui").each(function(){get(this).closeLoadingDisabled()});this.exec(d.onComplete)}});c.pageProxy.util.loadContent(this.opts,this.$body);return this},setTitle:function(e){this.options.title=e;if(this.$header.length==0){this.$body.before(this.createHeader(e).toString());this.$header=this.$elem.find(".modal-header");var d=this.$elem.find(".modal-content:first");d.find('>.modal-header [data-dismiss="modal"], >.modal-footer > [data-dismiss="modal"]').off("click.dismiss.bs.modal").on("click.dismiss.bs.modal",c.proxy(this.hide,this))}else{this.$header.find("h4").html(e)}return this},destroy:function(){this.$elem.data("bs.modal",null).remove();this.opts.url&&this.opts.pageProxy&&this.opts.pageProxy.destroy();return this},createTag:function(){var e=this.opts;var g=createTag("div").addClass("modal-dialog modal-dialog-centered");var f=createTag("div").addClass("modal-content").css("height",typeof e.height=="number"?e.height+"px":e.height).css("width",typeof e.width=="number"?e.width+"px":e.width).appendTo(g);if(e.title){this.createHeader(e.title).appendTo(f)}var d=createTag("div").addClass("modal-body").addClass("page-wrapper").addClass(e.bodyCls).appendTo(f);if(!(e.content instanceof jQuery)){d.append(e.content)}if(!e.height){f.css("max-height",e.maxHeight).css("min-height",e.minHeight)}this.createFooter(this.options.buttons).appendTo(f);if(e.id){this.$elem.attr(e.id)}if(e.cls){this.$elem.addClass(e.cls)}this.$elem.attr("role","dialog").attr("data-backdrop",e.backdrop).html(g.toString());if(e.content instanceof jQuery){this.$elem.find(".modal-body").html(e.content)}},getOptions:function(d,f){var e=c.extend({},f,d,{onComplete:function(){this.$footer.find("button:not([data-dismiss])").removeProp("disabled");this.exec(d.onComplete)}});return this._super(e,f)},createHeader:function(g){var e=this.options;var d=createTag("div").addClass("modal-header").addClass(e.headerCls);if(e.halign=="center"){d.css("text-align","center")}createTag("h4").addClass("modal-title").append(g).appendTo(d);var f=createTag("div").addClass("modal-tool").appendTo(d);if(e.maximizable){f.append('<button type="button" class="max"><i class="icon-expand"></i></button>',false)}if(e.headerCloseBtn){f.append('<button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="icon icon-times-l"></i></button>',false)}return d},createFooter:function(h){var e=createTag("");if(h||this.options.closeBtn){var f=this.options;e.setName("div").addClass("modal-footer");if(f.falign=="left"){e.css("justify-content","flex-start")}else{if(f.falign=="center"){e.css("justify-content","center")}}if(this.options.closeBtn){e.append('<button type="button" class="btn btn-outline-default" data-dismiss="modal">关闭</button>',false)}if(h){if(typeof h=="string"){h=this.exec(h)}if(c.isArray(h)&&h.length>0){var d=h[h.length-1];if(!d.type){d.type="primary"}for(var g=0;g<h.length;g++){TagUtils.createButton(h[g]).appendTo(e)}}}}return e},setButton:function(f){var d=this.createFooter(f);if(d){if(this.$footer.length){this.$footer.replaceWith(d.toString())}else{this.$body.after(d.toString())}this.$footer=this.$elem.find(".modal-footer");var e=this;if(this.options.closeBtn){this.$footer.find('[data-dismiss="modal"]').on("click.dismiss.bs.modal",function(){e.hide()})}c.parser.parse(this.options.pageProxy,this.$footer,true)}return this},setSubmitSuccess:function(d){this._isSubmit=d;return this},isSubmitSuccess:function(){return this._isSubmit},setOnClose:function(e){var d=this.getOptions().onClose;if(d){this.options.onClose=function(){this.exec(d);this.exec(e)}}else{this.options.onClose=e}}});c.fn.ezModal=function(d,e){return c.fn.baseTag.apply(this,[d,e,a])};c.fn.ezModal.constructor=a;a.DEFAULTS={index:0,url:null,content:null,width:"60%",height:null,cls:null,headerCls:null,bodyCls:null,closeBtn:true,headerCloseBtn:true,maximizable:null,title:null,maxHeight:null,minHeight:null,closeBtnText:"关闭",halign:"left",falign:"right",shown:false,closable:true,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,onBeforeClose:null,onClose:null,draggable:true,backdrop:"static"};c.openDialog=function(e){c("button:focus").blur();if(e.openWithModalTag){var d=new c.pageProxy(this.$body,this instanceof c.pageProxy?this:undefined);var h=c("<div/>").appendTo(c(document.body));var f=c.extend({},e,{context:this,modal:true,pageProxy:d,onBeforeRender:function(i){if(i.indexOf('data-toggle="ezModal"')<0){h.remove();c.openDialog({title:"对话框加载失败",content:i,width:TagConstant.DialogWidth.NARROW});return false}},onComplete:function(){var j=h.children();if(j.attr("data-toggle")!="ezModal"){j=j.find("[data-toggle='ezModal']")}if(j.length){get(j).show();c.extend(get(j).options,e);var i=get(j).options.onClose;get(j).options.onClose=function(){d&&d.destroy();h.remove();this.exec(i)}}},});c.pageProxy.util.loadContent(f,h)}else{var f=c.extend({shown:true},e,{pageProxy:this,onClose:function(){this.destroy();this.exec(e.onClose)}});var g=get(c("<div class='modal'/>").appendTo(c(document.body)).ezModal(f));return g}};c.getDialog=function(){if(c(".modal-backdrop").length){return c(".modal:not(.message,.loading):visible:last")}else{return c(".modal-backdrop")}};c.getDialogObject=function(){return get(c.getDialog())};c.closeDialog=function(e){var d=c.getDialog();if(d.length>0){get(d).setSubmitSuccess(e).hide()}};c.closeAllDialog=function(e){var d=c(".modal:not(.message,.loading):visible");d.each(function(){get(this)&&get(this).setSubmitSuccess(e).hide()})};c.refreshDialog=function(e){var d=c.getDialog();if(d.length>0){get(d).refresh(e)}};c(document).on("keydown.modal",function(e){var d=e.keyCode||e.which||e.charCode;if((e.ctrlKey==true&&d==82)||(d==116)||(e.ctrlKey==true&&d==116)){if(c.getDialog().length){e.returnValue=false;e.cancelBubble=true;c.refreshDialog();return false}}});c.alert=function(l,k){if(!c.isPlainObject(l)){l={title:l};if(typeof k=="function"){l.callback=k}else{if(typeof k=="string"){l.type=k}}}var g=c.extend({},c.alert.defaults,l);var e=createTag("");var j=g.iconCls;if(j==null){j=c.alert.utils.getIconCls(g.type)}if(j){createTag("i").addClass("icon icon-4x").addClass(j).appendTo(e)}createTag("h3").append(g.title).appendTo(e);if(g.description){createTag("p").addClass("description").append(g.description).appendTo(e)}var d=g.buttons.length;if(d){var f=createTag("p").addClass("btn-cntr").appendTo(e);for(var h=0;h<d;h++){c.extend(g.buttons[h],{modalOptions:g});if(h==d-1){g.buttons[h].type="primary"}f.append(TagUtils.createButton(g.buttons[h]))}}g.modal=c.openDialog({content:e.toString(),closeBtn:false,width:400,cls:"message "+g.type||""});g.modal.$body.find(".btn-cntr >").each(function(n){c(this).button(g.buttons[n]);var m=n==d-1;if(m){get(this).focus()}});return g.modal};c.alert.defaults={title:null,type:"primary",iconCls:null,callback:null,draggable:false,buttons:[{text:"确 定",onClick:function(){var d=get(this).opts.modalOptions;d.modal.hide();d.callback&&d.callback()}}]};c.alert.utils={getIconCls:function(f,d){var e=null;switch(f){case"primary":e="icon-info-circle";break;case"success":e="icon-check-circle";break;case"warning":e="icon-exclamation-circle";break;case"danger":e="icon-times-circle";break;default:break}if(e&&!d){e+="-o"}return e}};c.confirm=function(f,g,e){if(typeof f=="string"){f={title:f};if(g){f.callback=g}if(e){f.type=e}}var d=c.extend({},c.confirm.defaults,f);return c.alert(d)};c.confirm.defaults={type:"warning",buttons:[{text:"取消",onClick:function(){var d=get(this).opts.modalOptions;d.modal.hide();d.callback&&d.callback.call(this,false)}},{text:"确定",onClick:function(){var d=get(this).opts.modalOptions;d.modal.hide();d.callback&&d.callback.call(this,true)}}]};var b=null;c.hideLoad=function(d){if(b!=null){b.hide();b=null}};c.load=function(f,e){var d=c.extend({},c.load.defaults,{title:f,iconCls:e});if(b==null){b=c.openDialog({content:sprintf("<i class='icon-spinner %s margin-right' style='font-size: 18px;line-height: 1;'></i>%s",d.iconCls,d.title),closeBtn:false,draggable:false,width:200,zindex:10000,cls:"loading"})}return b};c.load.defaults={title:"加载中。。。",iconCls:"icon-spin"};c(document).on("click",".alert > .close",function(){c(this).parent().remove()})}(window.jQuery);!function(a){window.Notification={open:function(c){return b(c)},success:function(c){c=a.extend({icon:"check-circle",iconCls:"success"},c);return b(c)},error:function(c){c=a.extend({icon:"times-circle",iconCls:"error"},c);return b(c)},warning:function(c){c=a.extend({icon:"exclamation-circle",iconCls:"warning"},c);return b(c)},info:function(c){c=a.extend({icon:"info-circle",iconCls:"info"},c);return b(c)},close:function(c){a(".ez-notification > #"+c).find(".ez-notification-close-button").last().trigger("click")}};function b(p){p=a.extend({},Notification.DEFAULTS,p);var n=null;var o=a(".ez-notification."+p.position);if(o.length===0){o=a('<div class="ez-notification" />').addClass(p.position).appendTo(a("body"))}var d=null;i();l();return d;function i(){var r=createTag("div").addClass("ez-notification-wrapper").attr("id",p.id).attr("cls",p.cls).css(p.style);var q=createTag("div").addClass("ez-notification-content").appendTo(r);if(p.icon){q.addClass("has-icon");g(p.icon,p.iconCls,q).appendTo(q)}if(p.title){j(p.title).appendTo(q)}if(p.content){k(p.content).appendTo(q)}if(p.buttons&&p.buttons.length){m(p.buttons).appendTo(q)}f().appendTo(r);d=a(r.toString());e()}function l(){a.parser.parse(null,d.find(".ez-notification-button"),true);var q=d.find(".icon-times-l.ez-notification-close-button");q.click(function(r){if(r.stopPropagation){r.stopPropagation()}else{if(r.cancelBubble!==undefined&&r.cancelBubble!==true){r.cancelBubble=true}}clearTimeout(n);c()})}function g(s,q){var r=createTag("div").addClass("icon icon-"+s).addClass(q);return r}function j(r){if(p.escapeHtml){r=h(r)}var q=createTag("div").addClass("ez-notification-title").append(r);return q}function k(q){if(p.escapeHtml){q=h(q)}var r=createTag("div").addClass("ez-notification-description").append(q);return r}function m(s){var r=createTag("div").addClass("ez-notification-button");if(!s[s.length-1].type){s[s.length-1].type="primary"}for(var q=0;q<s.length;q++){r.append(TagUtils.createButton(s[q]).toString())}return r}function f(){return createTag("button").addClass("ez-notification-close-button").addClass("icon-times-l").attr("role","button")}function e(){o.append(d);switch(p.position){case"topRight":case"bottomRight":d.css("margin-left","auto").css("right","-420px");d.animate({right:"0"},"fast");break;case"topLeft":case"bottomLeft":d.css("margin-right","auto").css("left","-420px");d.animate({left:"0"},"fast");break;default:break}if(p.duration>0){n=setTimeout(c,p.duration);d.hover(function(){clearTimeout(n)},function(){n=setTimeout(c,p.duration)})}}function c(){d.animate({height:0,opacity:0},100,"swing",function(){d.remove();if(o.children().length===0){o.remove()}if(p.onClose){p.onClose.apply()}})}function h(q){if(q){q=q.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return q}}Notification.DEFAULTS={escapeHtml:false,title:null,content:null,position:"topRight",iconCls:null,duration:8000,buttons:[],onClose:null,cls:null,style:null,id:null,icon:null}}(window.jQuery);!function(b){b.notify=function(d,c){if(typeof d==="object"){c=d.type;d={content:d.title,duration:d.timeOut,iconCls:d.iconCls}}if(!c){c="primary"}switch(c){case"primary":Message.info(d);break;case"success":Message.success(d);break;case"warning":Message.warning(d);break;case"danger":Message.error(d);break;default:break}};b.show=b.notify;window.Message={success:function(d,e,c){return a("success",d,e,c)},error:function(d,e,c){return a("error",d,e,c)},info:function(d,e,c){return a("info",d,e,c)},warning:function(d,e,c){return a("warning",d,e,c)}};function a(l,o,e,m){if(typeof o=="string"){o={content:o}}if(typeof e==="number"){o.duration=e}else{m=e}switch(l){case"success":o=b.extend({},Message.DEFAULTS,{icon:"check-circle"},o);break;case"error":o=b.extend({},Message.DEFAULTS,{icon:"times-circle"},o);break;case"warning":o=b.extend({},Message.DEFAULTS,{icon:"exclamation-circle"},o);break;case"info":o=b.extend({},Message.DEFAULTS,{icon:"info-circle"},o);break;default:break}var n=b(".ez-message");if(n.length===0){n=b('<div class="ez-message" />').addClass("topCenter").appendTo(b("body"))}var j=null;c();function c(){var p=createTag("div").addClass("ez-message-warpper").addClass(l).attr("id",o.id).attr("cls",o.cls).css(o.style);f(o.icon,o.iconCls).appendTo(p);if(o.content){i(o.content).appendTo(p)}d().appendTo(p);j=b(p.toString());h()}function f(q,p){return createTag("div").addClass("ez-message-icon icon-"+q).addClass(p)}function i(p){if(o.escapeHtml){p=g(p)}return createTag("div").append(p).addClass("ez-message-content")}function d(){var p=createTag("button").addClass("close");p.append(createTag("span").append("&times;"));return p}function h(){n.append(j);j.css("top","-16px").css("opacity","0");j.animate({top:"0",opacity:"1"},"fast");if(o.duration>0){var p=setTimeout(k,o.duration);j.hover(function(){clearTimeout(p)},function(){p=setTimeout(k,o.duration)})}j.find(".close").click(function(){k()})}function k(){j.animate({top:"-16",opacity:0},100,"swing",function(){j.remove();if(n.children().length===0){n.remove()}if(m){m.apply()}if(o.onClose){o.onClose.apply()}})}function g(p){if(p){p=p.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return p}}Message.DEFAULTS={escapeHtml:false,icon:null,iconCls:null,content:null,duration:4000,cls:null,style:null,onClose:null,id:null}}(window.jQuery);!function(d){if(d.fn.bootstrapTable){d.fn.bootstrapTable.Constructor.prototype.initToolbar=function(){var N=get(this.$el),B=N.opts,K=createTag(""),q=createTag("div").addClass("fixed-table-toolbar"),C=createTag("div").addClass("bs-bars pull-left"),s=createTag("div").addClass("columns columns-right pull-right"),m=[],j=[];if(B.onBtnInit){var L=N.exec(B.onBtnInit)||[];for(var T=0;T<L.length;T++){var G=L[T];G.pageProxy=N.opts.pageProxy;m.push(G)}}if(B.editBtn){m.push({text:"新增一行",iconCls:"icon-plus",cls:"edit-btn",onClick:function(){N.addRow({});var i=N.getRows().length-1;N.$elem.find("tbody > tr:eq("+i+")").find("td:eq(0)").click()}})}if(B.importBtn){var o=B.importBtnText;j.push({text:o,iconCls:"icon-import",onClick:function(){var ac=B.importFileType.split(",");var ab="";if(ac.length>1){ab=createTag("div").addClass("dropdown");ab.append('<a data-toggle="dropdown" href="javascript:;">下载导入模板</a>');ab.append('<ul class="dropdown-menu">');for(var Z=0;Z<ac.length;Z++){var X=createTag("li").appendTo(ab);TagUtils.createHref(ac[Z]+"模板").data("ext",ac[Z]).appendTo(X)}ab.append("</ul>")}else{ab=TagUtils.createHref("下载导入模板").data("ext",ac[0])}var aa=d.openDialog({title:o,width:560,closeBtn:false,bodyCls:"batch-import-container",content:sprintf(B.importHtmlTemplate,ab.toString(),ac.join("/"),d.util.getFileSize(B.importMaxFileSize))});var Y=null;aa.$body.find("#uploadBtn").uploadBtn({target:N,tagId:B.tagId,fileType:B.importFileType,uploadUrl:B.importUrl,maxFileSize:B.importMaxFileSize,onUploadBefore:function(af,ae,ad){var i=true;if(B.onBeforeImport){i=N.exec(B.onBeforeImport,[af])}if(i!==false){af._grid_import_flag="true";af._columns=N.getColumns();af._importHandler=B.importHandler;af._tagId=B.tagId}return i},onUploadStart:function(i){Y=d.load("上传文件中。。。")},onUploadSuccess:function(ak,ad){d.hideLoad(Y);if(!ak){throw new Error("grid保存导入数据时需要在importUrl中返回导入的数据（successDatas和errorDatas）")}d.closeDialog();var am=ak.successDatas.length,ai=ak.errorDatas.length;if(ai){var ag=null;aa=d.openDialog({width:"80%",title:"查看错误数据",content:sprintf(B.errorDatasHtmlTemplate,am,ai),buttons:[{text:"下载导入失败数据",onClick:function(){var ap=get(ag);var i=ap.options;var ao={tagId:N.options.tagId,columns:ap.getColumns(),exportFileType:i.exportFileType,showEditDesc:false,fileName:i.exportDataText,excelTitle:i.excelTitleExport,lineNum:i.lineNum,mergeCells:ap._mergeCells};var an=new Url("exportErrorData");an.addParam("_gridInfo",ao);d.download(an)}}],onClose:function(){d.req({url:"clearTableErrorData",modal:false})}});var af=[{id:"_msg",title:"错误信息",type:"textColumn",sortable:false,filter:false,fixed:"left",width:300,cellStyle:function(i){return"danger"}}];var al=0;for(var ah=0;ah<N.columns.length;ah++){var ae=N.columns[ah];if(!ae.ignore&&!ae.hidden){af.push(ae)}if(ae.headNum>al){al=ae.headNum}}af[0].rowspan=++al;var aj={title:null,columns:af,importBtn:false,exportBtn:false,page:true,pageSize:N.options.pageSize,datas:ak.errorDatas,filterRow:true,filterColumn:true,fixedHorizontalScroll:true};ag=aa.$body.find("table");ag.grid(aj)}else{if(am){d.notify(sprintf(B.importSuccessText,am),"success")}else{d.notify("上传文件没有要导入的数据")}}N.exec(B.onImport,[ak.successDatas,ak.errorDatas])},onUploadError:function(ad,i){d.hideLoad(Y);d.notify(sprintf("【%s】上传失败，%s",i.fileName,ad),"danger")},onSelectError:function(ad,i){d.notify(sprintf("【%s】上传失败，%s",i.fileName,ad),"danger")},onUploadComplete:function(){d.hideLoad(Y)}});aa.$body.find("a[data-ext]").on("click",function(){var i=d(this).data("ext");var ad=B.importTemplateName?B.importTemplateName:(B.importTemplateText+(B.title?"_"+B.title:""));N.exportData({exportFileType:i,fileName:ad,showEditDesc:B.showEditDescImport,datas:N.options.importTemplateData?undefined:[],lineNum:false})})}})}if(B.exportBtn){var S=[];if(B.exportCurrentPage){S.push(TagUtils.createRadio({text:"当前页",name:"exportRowType",value:"currentPage",checked:true}))}else{S.push(TagUtils.createRadio({text:"全部行",name:"exportRowType",value:"all",checked:true}));if(B.multiple){S.push(TagUtils.createRadio({text:"选中行",name:"exportRowType",value:"selected"}))}if(B.page){S.push(TagUtils.createRadio({text:"当前页",name:"exportRowType",value:"currentPage"}))}}var y=[];var P=true;for(var T=0;T<N.columns.length;T++){var l=N.columns[T];var g=l.ignore==null?l.hidden:l.ignore;if(!g){var A=!l.hidden;if(P&&!A){P=false}var I=createTag("li").append(TagUtils.createCheckbox({text:l.title,name:"column",value:l.id,checked:A}));y.push(I.toString())}}var k=TagUtils.createCheckbox({name:"checkAll",text:"全选",value:1,checked:P});var x=sprintf(B.exportCustomHtmlTemplate,S.join(""),k.toString(),y.join(""));var w=d(x);d.fn.checkbox.util.init(w.find(".box-control"));var F=w.find(".export_type .box-control");var O=w.find(".export_row_type .box-control");var e=w.find(".checkall :checkbox");var W=w.find(".columns :checkbox");w.find(".checkall .box-control").on("checked",function(X,i){W.prop("checked",i);return false});w.find(".columns .box-control").on("checked",function(Y,X){var i=X;if(X){W.not(d(this).find(":checkbox")).each(function(){var Z=d(this).prop("checked");if(!Z){i=false;return false}})}e.prop("checked",i)});j.push({text:B.exportBtnText,iconCls:"icon-export",onClick:function(){if(B.exportCustom){d.openDialog({content:w,title:"自定义导出",width:600,buttons:[{text:"确定",onClick:function(){var Z=F.find(":checked").attr("value");var Y=O.find(":checked").attr("value");var X=N.getColumns(true);var aa=[];w.find(".columns :checked").each(function(){var ac=d(this).attr("value");if(ac){for(var ab=0;ab<X.length;ab++){if(ac==X[ab].id){aa.push(X[ab]);break}}}else{var ad=d(this).next().text();for(var ab=0;ab<X.length;ab++){if(!X[ab].id&&ad==X[ab].title){aa.push(X[ab]);break}}}});if(aa.length==0){d.notify("请至少选择一列导出","danger");return}var i=N.exportData({exportFileType:Z,datas:Y,columns:aa,showEditDesc:N.options.showEditDescExport});if(i){d.closeDialog()}}}],onBeforeClose:function(){w.detach()}})}else{N.exportData({showEditDesc:N.options.showEditDescExport})}}})}if(B.filterColumn){var p=N.columns;var v=createTag("");var P=true;for(var T=0;T<p.length;T++){var Q=p[T];var A=!Q.hidden;if(P&&Q.hidden){P=false}var I=createTag("li").addClass("ui-ellipsis").append(TagUtils.createCheckbox({name:"columnCheckbox",text:Q.title,value:T,checked:A})).appendTo(v)}var k=TagUtils.createCheckbox({name:"checkAll",text:"全选",value:1,checked:P});var U=sprintf(B.filterHtmlTemplate,k.toString(),v.toString());var E=d(U);var M=E.find(".save-btn");var H=E.find(".cancel-btn");var n=E.find(".check-all :checkbox");var z=E.find(".columns :checkbox");d.fn.checkbox.util.init(E.find(".box-control"));E.find(".check-all .checkbox").on("checked",function(X,i){z.prop("checked",i);return false});E.find(".columns .checkbox").on("checked",function(Y,X){var i=X;if(X){z.not(d(this).find(":checkbox")).each(function(){var Z=d(this).prop("checked");if(!Z){i=false;return false}})}if(n.prop("checked")!=i){n.prop("checked",i)}});var R=function(){E.detach().removeClass("open");d(document).off("click.grid.filterColumn")};M.on("click.save",function(){var i=[];var X=false;z.each(function(Z){var aa=d(this);var ab=aa.prop("checked");var Y=!ab;if(p[Z].hidden!==Y){X=true;p[Z].hidden=!ab}i.push({id:p[Z].id,hidden:!ab})});if(X){N.$elem.bootstrapTable("filterColumns",i)}R()});H.on("click.close",function(){var i=true;z.each(function(X){d(this).prop("checked",!p[X].hidden);if(i&&p[X].hidden){i=false}});n.prop("checked",i);R()});j.push({iconCls:"icon-th-list",title:"显示或者隐藏表格列",onClick:function(){if(!E.hasClass("open")){E.appendTo(d("body")).position({of:this.$elem,my:"left top",at:"left bottom+4px"});d(document).on("click.grid.filterColumn",function(i){if(d(i.target).closest(".table-filter-column-panel").length==0){H.trigger("click.close")}})}else{H.trigger("click.close")}return false}})}var r=this.$container.prev(".hidden[data-target='"+N.options.tagId+"']");if(m.length||r.length){var t=createTag("div").addClass("pull-left").appendTo(C);if(m.length){if(r.length==0&&m[0]&&!m[0].type){m[0].type="primary"}for(var T=0;T<m.length;T++){var G=m[T];t.append(TagUtils.createButton(G))}}createTag("span").addClass("selected-cnt").appendTo(C);C.appendTo(q)}if(j.length){for(var T=0;T<j.length;T++){s.append(typeof j[T]=="string"?j[T]:TagUtils.createButton(j[T]))}s.appendTo(q)}if(this.options.search){var D=[];D.push('<div class="pull-right search">',sprintf('<input class="form-control" type="text" placeholder="%s">',this.options.formatSearch()),"</div>");q.append(D.join(""))}if(B.title){var J=createTag("h3").addClass("ez-h3").append(B.title);if(q.isEmpty()){J.css("margin-bottom:0px;")}if(m.length||r.children().length){J.css("float:none;margin-bottom:8px;")}J.prependTo(q)}if(!q.isEmpty()){q.appendTo(K)}if(!K.isEmpty()){this.$container.prepend(K.toString());if(!q.isEmpty()){this.$toolbar=this.$container.find(".fixed-table-toolbar");if(this.options.search){var h=this,u=0;var f=this.$toolbar.find(".search input");f.off("keyup drop blur").on("keyup drop blur",function(i){if(h.options.searchOnEnterKey&&i.keyCode!==13){return}if(d.inArray(i.keyCode,[37,38,39,40])>-1){return}clearTimeout(u);u=setTimeout(function(){h.onSearch(i)},h.options.searchTimeOut)})}d.parser.parse(N.options.pageProxy,this.$toolbar,true)}this.$tableTitle=this.$container.find(".fixed-table-title");if(r.length){var V=r.children().eq(0);if(V.hasClass("btn")&&V.data("type")=="default"){V.removeClass("btn-outline-default").addClass("btn-primary")}r.children().prependTo(this.$container.find(".bs-bars.pull-left .pull-left"));r.remove()}}}}var b=d.fn.baseTag.constructor.extend({initTag:function(){this.columns=[];this.bsColumns=[];this.btnEvents=[];this._mergeCells=[];this.countArr=[];this.total=this.options.datas.length;this.isModify=false;this.initHeader();this.$elem.bootstrapTable(this.getBsOptions());this.bootstrapTable=this.$elem.data("bootstrap.table");if(!this.opts.dataUrl&&this.opts.dataContext){this.autoMergeCell(this.bootstrapTable.getData())}this.bootstrapTable.$container.on("click.col.btn","[data-fn-index]",this,function(l){var f=d(this).data("fnIndex");if(typeof f!="undefined"){if(d(this).hasClass("disabled")){return false}var i=l.data,g=i.btnEvents[f],h=d(this).closest("tr"),k=h.data("index"),m=i.getRow(h);var j=d(this).parent().data("field");if(d(this).is(".button-column")){return d.util.exec(g,[m,k,i,h,j],{context:this,pageProxy:i.opts.pageProxy})}else{return d.util.exec(g,[k,m,i,h,j],{context:this,pageProxy:i.opts.pageProxy})}}})},initHeader:function(){var e=this.options,j=this;if(e.deleteEditBtn==null||e.deleteEditBtn=="undefined"){e.deleteEditBtn=e.editBtn}for(var g=0;g<e.columns.length;g++){if(e.columns[g].headNum||e.columns[g].cellMerge){e.bordered=true}}var m=this.bsColumns;for(var g=0;g<e.columns.length;g++){var o=this.getColumnOptions(e.columns[g]),n=o.options,k=o.bsOptions;if(n.headNum){e.bordered=true}var f=m[n.headNum];if(!f){f=[];m.push(f)}f.push(k);this.columns.push(n)}if(e.lineNum){m[0].unshift({field:"num",title:"#",width:40,align:"center",rowspan:m.length,wrapText:true,resizable:false,searchable:false,formatter:function(p,r,i){if(j.serverPage){var q=j.$elem.bootstrapTable("getOptions");return q.pageSize*(q.pageNumber-1)+i+1}else{return i+1}}})}if(e.multiple){m[0].unshift({field:"ck",width:40,rowspan:m.length,resizable:false,searchable:false,wrapText:true,checkbox:true})}if(e.edit&&e.editType=="row"&&e.editColumnBtn){var l=[{text:"修改",onClick:function(t,p,r,q){var s=r.options.onBeforeEdit;if(s){var i=r.exec(s,[t,p]);if(i==false){Message.warning("当前行不允许编辑");return false}}r.beginEdit(p);return false}}];if(e.deleteEditBtn){l.push({text:"删除",onClick:function(t,p,r,q){var s=r.options.onBeforeEdit;if(s){var i=r.exec(s,[t,p]);if(i==false){Message.warning("当前行不允许删除");return false}}r.deleteRow(p);return false}})}var h=70;if(e.deleteEditBtn){h+=30}if(e.sortBtn){h+=45}var o=this.getColumnOptions({id:"editBtn",type:"buttonColumn",rowspan:m.length,width:h,align:"left",resizable:false,searchable:false,sortBtn:e.sortBtn,buttons:l});m[0].push(o.bsOptions);this.columns.push(o.options)}},getBsOptions:function(){var e=this.options,i=this;if(d.util.isPhone){e.height="auto";e.fixedHorizontalScroll=true}if(e.height=="fill"){var g=function(o){var n=o.nextAll(":visible").length>0;if(n){return n}else{var p=o.parent();if(p.hasClass("page-body")||p.hasClass("modal-body")||p.length==0){return false}return g(p)}};if(g(this.$elem)){e.height="auto"}}var f={tagId:e.tagId,size:e.size,viewHeight:e.height,minHeight:e.minHeight,maxHeight:e.maxHeight,width:e.width,columns:this.bsColumns,lineNum:e.lineNum,multiple:e.multiple,method:"post",uniqueId:e.idField,striped:e.striped,undefinedText:null,bordered:e.bordered,search:e.filterRow,hidden:e.hidden,countArr:this.countArr,fixedHorizontalScroll:e.fixedHorizontalScroll,emptyDescription:e.emptyDescription,iconSize:"",buttonsClass:"outline-default",simplePage:e.simplePage,paginationDetailHAlign:"right",clickEdit:e.edit,contentType:"application/x-www-form-urlencoded",queryParamsType:"",queryParams:function(n){if(!i.total){var p={};var o=i.exec(e.onBeforeLoad,[p]);if(o==false){return false}i.paramTmp=p}var t={};for(var q in i.paramTmp){var s=i.paramTmp[q];s=(s&&typeof s=="object")?JSON.stringify(s):s;t[q]=s}var r={};if(e.page){r.page={pageNum:n.pageNumber||1,pageSize:n.pageSize||i.opts.pageSize,total:i.total};if(i.serverPage&&e.serverSort){r.page.sortInfo=n.sortInfo}}t._gridInfo=JSON.stringify(r);return t},ajaxOptions:{beforeSend:function(o){var n=d._getToken();if(n){o.setRequestHeader("Authorization","Bearer "+n)}}},responseHandler:function(n){if(n.rows){i.total=n.total;this.sidePagination="server"}return n},onLoadSuccess:function(q){if(d.isPlainObject(q)&&q.success===false){if(q.type=="sessionout"){d.alert({title:q.msg,type:"warning",buttons:[{text:"重新登录",onClick:function(){var s=q.loginUrl;var r=encodeURI(location.href);s+=((s.indexOf("?")==-1?"?":"&")+"redirectUrl="+r);location.href=s}}]})}else{var p=q.msg||"加载出错，请检查！";d.notify(p,"warning");if(q.type!="bizex"&&console){console.error("请求 %s 出错",d.util.getBaseUrl()+this.url);console.error(q)}}}else{var o=i.opts;var n=[];if(d.isArray(q)){n=q;i.total=n.length}else{n=q.rows;i.total=q.total;i.serverPage=true}i.exec(o.onLoadSuccess,[n,i.total])}},onPostBody:function(n){i.$elem.find(".ui-grid-img").each(function(){d(this).tooltip({position:"auto bottom",type:d(this).data("url")?"nopadding default":"default",title:function(){var p=d(this).data("url");var r=d(this).data("imgWidth");var o=d(this).data("imgHeigth");var q="";if(r){q+="width:"+r+"px;"}if(o){q+="height:"+heigth+"px;"}return p?sprintf("<img style='%s' src='%s'>",q||"max-width:100%;",p):"当前图片不存在"}})});if(n&&n.length>1){i.autoMergeCell(n)}i.initColumnButton();i.refreshSelectedCnt()},onClickRow:function(r,o,n,q){var p=o.attr("data-index");i.exec(i.opts.onClickRow,[p,r])},onDblClickRow:function(r,o,n,q){var p=o.attr("data-index");i.exec(i.opts.onDblClickRow,[p,r])},onCheck:function(n){i.refreshSelectedCnt();i.exec(e.onSelect,[n])},onUncheck:function(n){i.refreshSelectedCnt();i.exec(e.onUnselect,[n])},onCheckAll:function(n){i.refreshSelectedCnt();i.exec(e.onSelectAll,[n])},onUncheckAll:function(n){i.refreshSelectedCnt();i.exec(e.onUnselectAll,[n])}};if(e.rowStyler){f.rowStyle=function(q,n){var o={},p=i.exec(e.rowStyler,[n,q]);if(typeof p=="string"){o.classes=p}else{o.css=p}return o}}if(e.rowStyle){f.rowStyle=function(q,n){var o={},p=i.exec(e.rowStyle,[q,n]);if(typeof p=="string"){o.classes=p}else{o.css=p}return o}}var h=e.dataUrl;if(h){f.url=h}else{if(e.dataContext){this.options.datas=d.getContextData(e.dataContext)}this._localDatas=true;f.data=this.options.datas}if(e.page){f.pagination=true;f.pageSize=e.pageSize;f.pageList=[e.pageSize,e.pageSize*2,e.pageSize*3];f.serverSort=e.serverSort;f.multiSort=e.multiSort}else{f.footer=e.footer}var j=0,l=0,k=0,m=false;d.each(this.bsColumns,function(){d.each(this,function(){if(!this.hidden){k++;if(d.util.isPhone){this.fixed=null}else{if(this.fixed=="left"){j++}else{if(this.fixed=="right"){l++}}}}if(!m&&this.fixed){m=true}})});if(m){f.fixedColumns=m;f.leftFixedNumber=j;f.rightFixedNumber=l}return f},getRow:function(e){var f=e.data("index");return this.bootstrapTable.data[f]},getColumnOptions:function(m){var j=this;if(m.sortable==null){if(m.formatter){m.sortable=false}}if(m.colspan>1){m.sortable=false}var n=a[m.type];m=d.extend({escape:!m.formatter,ignore:m.hidden},n.DEFAULTS,{wrapTitle:this.options.wrapTitle,wrapText:this.options.wrapText},m);n.initOptions&&n.initOptions(m,this);var f=m.sortable;var h={field:m.id,type:m.type,title:(m.required?"<span class='ui-grid-required'>*</span>":"")+m.title,align:m.align,halign:m.halign,helpMessage:m.helpMessage,resizable:m.resizable,sortable:f,sorter:m.sorter,width:m.width,minWidth:m.minWidth,wrapTitle:m.wrapTitle,wrapText:m.wrapText,colspan:m.colspan,rowspan:m.rowspan,hidden:m.hidden,visible:!m.hidden,ignore:m.ignore,editable:m.edit&&!m.fixed,editType:m.editType,escape:m.escape,fixed:m.fixed,onBeforeEdit:m.onBeforeEdit,isShortcutKey:m.isShortcutKey,searchable:m.searchable};h["class"]=m["class"];var e=m.cellStyle;if(e){h.cellStyle=(function(i){var o=i.cellStyle;return function(p,s,t){var q={},r=j.exec(o,[p,s,t,i.id]);if(typeof r=="string"){q.classes=r}else{q.css=r}return q}}(m))}h.formatter=(function(o,i){return function(q,r,p){if(i.formatter){q=i.formatter(q,r,p,o,j)}if(o.formatter){q=a.utils.formatter(q,r,p,j,o)}else{if(o.onHrefClick){q=a.utils.initHrefColumn(q,r,p,j,o)}}return q}}(m,n));if(h.editable){var l={pageProxy:this.options.pageProxy,placeholder:m.placeholder,required:m.required,size:"default",onChange:(function(i){return function(q,o){var p=i.id;if(q instanceof Date){j.editRow[p]=DatetimeUtils.format(q,"yyyyMMddHHmmss")}else{if(d.isArray(q)){j.editRow[p]=q.join(",")}else{j.editRow[p]=q}}if(j.countArr.contains(p)){j.$elem.bootstrapTable("updateCountRow")}j.isModify=true;j.exec(i.onChange,[q,o,j.curEditRowId,j.editRow,p])}}(m))};if(m.onFocus){l.onFocus=(function(i){return function(){j.exec(i.onFocus,[j.editRow,j.curEditRowId,i.id])}}(m))}if(n.EDIT_ATTR_KEYS){for(var g=0;g<n.EDIT_ATTR_KEYS.length;g++){var k=n.EDIT_ATTR_KEYS[g];if(k in m){l[k]=m[k]}}}n.initEditOptions&&n.initEditOptions(m,l);h.editOptions=l}return{options:m,bsOptions:h}},autoMergeCell:function(A){var f=this.getColumns();this._mergeCells=[];var o=undefined;var p=function(E){var i=false;for(var j=0;j<o.length;j++){var G=o[j];var F=G.index+G.rowspan;if(E>=G.index){if(E===F-1){return true}if(E<F-1){i=true}}}return !i};for(var x=0;x<f.length;x++){var q=[];var h=f[x];var e=h.id;if(e){if("vertical"==h.cellMerge||"both"==h.cellMerge){var m=0;for(var v=0;v<A.length;v++){var C=A[v];var n=-1;if(v<A.length-1){var t=A[v][e];var y=A[v+1][e];if(t!=y){n=v}if(o&&p(v)){n=v}}else{n=v}if(n>=m){var B={field:e,index:m,rowspan:n-m+1};q.push(B);this.mergeCells(B)}if(n>-1){m=v+1}}}}if(q.length){o=q}}for(var x=0;x<f.length;x++){var h=f[x];var e=h.id;if(e){if("horizontal"==h.cellMerge||"both"==h.cellMerge){var s=[];for(var v=x+1;v<f.length;v++){var g=f[v];if(g.id&&("horizontal"==g.cellMerge||"both"==g.cellMerge)){s.push(g.id)}else{break}}var D=s.length;if(D>0){x=x+D;for(var v=0;v<A.length;v++){var C=A[v];var w=C[e];var z=-1;var r=e;for(var u=0;u<D;u++){var l=-1;if(C[s[u]]!=w){w=C[s[u]];l=u-1;if(l<=z){z=u;r=s[u]}}else{if(u==D-1){l=u}}if(l>z){var B={field:r,index:v,colspan:l-z+1};this.mergeCells(B);z=u;r=s[u]}}}}}}}this.$elem.bootstrapTable("updateCountRow")},refreshSelectedCnt:function(){if(this.bootstrapTable){var e=this.getSelected(false).length;var f=e?sprintf("已选中%s行",e):"";this.bootstrapTable.$toolbar.find("span.selected-cnt").text(f)}},initColumnButton:function(){if(!this.bootstrapTable){return}if(this.bootstrapTable.$fixedHeader&&this.bootstrapTable.$fixedHeader.find("th.operate-btn").length>0){return}var e=this;var f=this.bootstrapTable.$body.find(".table-dropdown-btn");f.each(function(){var i=d(this).data();var g=f.filter("[data-items_proxy='"+i.items_proxy+"']");var j=false;if(g.length>1){j=true}var h=HtmlTag.getProxyValue(i.items_proxy,j);var k=d(this).closest("tr");i=d.extend({},i,{textField:"text",items:h,menuContainer:"body",onClick:function(n){var l=n.data.fnIndex;if(typeof l!="undefined"){var m=e.btnEvents[l],o=k.data("index"),p=e.getRow(k);if(this.$elem.is(".button-column")){return e.exec(m,[p,o,e,k])}}}});d(this)["dropdown"](i)})},showWarningMsg:function(g,h,f){if(typeof h!="undefined"){g=d.util.getText(this.opts.invalidColText,h+1,f)+g}this.focus();var e=this.$elem.closest(".fixed-table-container");e.addClass("invalid-table");setTimeout(function(){if(e.data("ez.tooltip")){e.tooltip("setTitle",g).tooltip("show")}else{e.tooltip({type:"danger",position:"top",title:g})}},500)},focus:function(){var e=this.$elem.closest(".fixed-table-container");e.attr("tabindex","0").focus();return this},validate:function(s,p){var A=this.getRows();if(this.options.minLength&&A.length<this.options.minLength&&p!==false){s!==false&&this.showWarningMsg(sprintf("该表格至少输入%s行数据",this.options.minLength));return false}if(this.options.maxLength&&A.length>this.options.maxLength){s!==false&&this.showWarningMsg(sprintf("该表格最多输入%s行数据",this.options.maxLength));return false}var z=this.bootstrapTable.$body.is(":visible");var o=this.getColumns();for(var y=0;y<A.length;y++){var B=A[y];for(var w=0;w<o.length;w++){var h=o[w];var e=h.id;var t=B[e];var l=this.bootstrapTable.$body.find("tr[data-index='"+y+"']").find(".cell[data-field='"+e+"']");if(z&&l.is(":hidden")){continue}if(p!==false){if(h.required&&(typeof t=="undefined"||(typeof t=="string"&&t=="")||t==null)){s!==false&&this.showWarningMsg(d.util.getText(this.opts.invalidColText,y+1,h.title)+this.opts.requiredText);return false}}switch(h.type){case 1:if(t&&h.data.validType){var q=h.data.validType.split("&");for(var v=0;v<q.length;v++){var f=q[v];var n={};if(f.indexOf("fn")==0){var r=f.substring(3,f.length-1);n=this.exec(r,[t])}else{n=StringUtils.validate(t,f)}if(!n.isValid){s!==false&&this.showWarningMsg(d.util.getText(this.opts.invalidColText,y+1,h.title)+n.msg);return false}}}break;case 2:var g=TagUtils.validateNumber(t,h.data.min,h.data.max);if(g){s!==false&&this.showWarningMsg(d.util.getText(this.opts.invalidColText,y+1,h.title)+g);return false}break;case 3:var g=TagUtils.validateDate(t,h.data.min,h.data.max,h.data.mask);if(g){s!==false&&this.showWarningMsg(d.util.getText(this.opts.invalidColText,y+1,h.title)+g);return false}break;case 4:var u=h.data.min;var x=h.data.max;var m=[];if(t!=null&&t!=undefined){m=(t+"").split(",")}var g=false;if(u&&x){if(u>m.length||x<m.length){g=sprintf("请选择%s~%s个选项",u,x)}}else{if(u){if(u>m.length){g=sprintf("至少选择%s个选项",u)}}else{if(x){if(x<m.length){g=sprintf("最多选择%s个选项",x)}}}}if(g){s!==false&&this.showWarningMsg(g,y,h.title);return false}break;default:break}if(h.data.onValidate){var n=this.exec(h.data.onValidate,[t,B]);if(!n.isValid){s!==false&&this.showWarningMsg(d.util.getText(this.opts.invalidColText,y+1,h.title)+n.msg);return false}}}}this.disableValidation();return true},validateRow:function(l,p){var x=this.getRows()[l];if(x){var o=this.getColumns();for(var v=0;v<o.length;v++){var g=o[v];var e=g.id;var s=x[e];var i=this.bootstrapTable.$body.find("tr[data-index='"+l+"']").find(".cell[data-field='"+e+"']");if(i.is(":hidden")){continue}if(p!==false){if(g.required&&(typeof s=="undefined"||(typeof s=="string"&&s=="")||s==null)){this.showWarningMsg(this.opts.requiredText,l,g.title);return false}}switch(g.type){case 1:if(g.data.validType){var q=g.data.validType.split("&");for(var u=0;u<q.length;u++){var f=q[u];var n={};if(f.indexOf("fn")==0){var r=f.substring(3,f.length-1);n=this.exec(r,[s])}else{n=StringUtils.validate(s,f)}if(!n.isValid){this.showWarningMsg(n.msg,l,g.title);return false}}}break;case 2:var h=TagUtils.validateNumber(s,g.data.min,g.data.max);if(h){this.showWarningMsg(d.util.getText(this.opts.invalidColText,l+1,g.title)+h);return false}break;case 3:var h=TagUtils.validateDate(s,g.data.min,g.data.max,g.data.mask);if(h){this.showWarningMsg(d.util.getText(this.opts.invalidColText,l+1,g.title)+h);return false}break;case 4:var t=g.data.min;var w=g.data.max;var m=[];if(s!=null&&s!=undefined){m=(s+"").split(",")}var h=false;if(t&&w){if(t>m.length||w<m.length){h=sprintf("请选择%s~%s个选项",t,w)}}else{if(t){if(t>m.length){h=sprintf("至少选择%s个选项",t)}}else{if(w){if(w<m.length){h=sprintf("最多选择%s个选项",w)}}}}if(h){showMsg!==false&&this.showWarningMsg(h,l,g.title);return false}break;default:break}if(g.data.onValidate){var n=this.exec(g.data.onValidate,[s]);if(!n.isValid){showMsg!==false&&this.showWarningMsg(n.msg,l,g.title);return false}}}}this.disableValidation();return true},disableValidation:function(){var e=this.$elem.closest(".fixed-table-container");if(e.data("ez.tooltip")){e.tooltip("hide").tooltip("destroy")}e.removeClass("invalid-table");return this},load:function(e){this.total=0;this._mergeCells=[];e=d.isPlainObject(e)?e:{dataUrl:e||this.opts.dataUrl};d.extend(this.opts,e);this.$elem.bootstrapTable("refresh",{url:this.opts.dataUrl})},loadData:function(e){this._mergeCells=[];this._localDatas=true;if(this.bootstrapTable.options.pageNumber){this.bootstrapTable.options.pageNumber=1;this.bootstrapTable.options.sidePagination=undefined}this.$elem.bootstrapTable("load",e);this.total=e?e.length:0},refresh:function(){this.load()},addRow:function(e){if(this.isEditing()){this.endEdit()}this.isModify=true;if(e){e=d.extend({_new:true},e)}this.$elem.bootstrapTable("append",e);this.$elem.bootstrapTable("updateCountRow");this.disableValidation();this.exec(this.opts.onAdd,[e]);this.exec(this.opts.onChange)},insertRow:function(e,g){if(this.isEditing()){this.endEdit()}this.isModify=true;if(g){g._new=true}var f={index:e,row:g};this.$elem.bootstrapTable("insertRow",f);this.$elem.bootstrapTable("updateCountRow");this.disableValidation();this.exec(this.opts.onInsert,[g]);this.exec(this.opts.onChange)},deleteRow:function(f){if(this.isEditing()){this.endEdit()}this.isModify=true;if(typeof f!="undefined"){var e=this.getRows()[f];this.$elem.bootstrapTable("remove",f);this.$elem.bootstrapTable("updateCountRow");this.disableValidation();this.exec(this.opts.onDelete,[e,f]);this.exec(this.opts.onChange)}},deleteRowBy:function(f,e){if(this.isEditing()){this.endEdit()}this.isModify=true;this.$elem.bootstrapTable("remove",{field:f,values:e});this.$elem.bootstrapTable("updateCountRow");this.disableValidation();this.exec(this.opts.onChange)},updateRow:function(e,m){this.isModify=true;if(this.curEditRowId==e){var g=this.bootstrapTable.$body.find("tr:eq("+this.curEditRowId+")");for(var l in m){var j=g.find("[field='"+l+"']");var k=m[l];this.getRows()[e][l]=k;if(j.length){get(j).setValue(k)}else{var i=g.find("[data-field='"+l+"']");if(i.length){var h=this;d.each(this.bootstrapTable.columns,function(n,o){if(o.field==l){if(h.bootstrapTable.header.formatters[n]){k=h.bootstrapTable.header.formatters[n].call(h.bootstrapTable.columns[n],k,m,h.curEditRowId)}return false}});i.html(k)}}}}else{var f={index:e,row:m};this.$elem.bootstrapTable("updateRow",f);this.$elem.bootstrapTable("updateCountRow")}this.disableValidation();this.exec(this.opts.onUpdate,[m]);this.exec(this.opts.onChange)},getRows:function(){var e=undefined;if(this.bootstrapTable){e=this.$elem.bootstrapTable("getData")}else{e=this.options.datas}return e},showColumn:function(g){for(var e=0;e<this.columns.length;e++){var f=this.columns[e];if(f.id==g){f.hidden=false;this.$elem.bootstrapTable("showColumn",g);break}}},hideColumn:function(g){for(var e=0;e<this.columns.length;e++){var f=this.columns[e];if(f.id==g){f.hidden=true;this.$elem.bootstrapTable("hideColumn",g);break}}},setColumnIgnore:function(h,e){for(var f=0;f<this.columns.length;f++){var g=this.columns[f];if(g.id==h){g.ignore=true;break}}},getSelected:function(f){var e=this.opts.multiple;var h=this.$elem.bootstrapTable("getAllSelections");if(h.length==0&&f!==false){d.notify(this.opts.selectOneRowText,"danger")}var j=d.extend(true,[],h);for(var g=0;g<j.length;g++){delete j[g].ck}return j},getEditRow:function(){if(typeof this.curEditRowId!=="undefined"){return this.getRows()[this.curEditRowId]}},selectRow:function(e){this.$elem.bootstrapTable("check",e);return this},selectRowBy:function(f,e){this.$elem.bootstrapTable("checkBy",{field:f,values:e});return this},unselectRow:function(e){this.$elem.bootstrapTable("uncheck",e);return this},unselectRowBy:function(f,e){this.$elem.bootstrapTable("uncheckBy",{field:f,values:e});return this},selectAll:function(){this.$elem.bootstrapTable("checkAll");return this},unselectAll:function(){this.$elem.bootstrapTable("uncheckAll");return this},isHidden:function(){return this.options.hidden},toggle:function(e){this.options.hidden=typeof e==="boolean"?!e:!this.options.hidden;this.$elem.closest(".bootstrap-table").toggle(e);this.$elem.bootstrapTable("resetView");return this},show:function(){this.toggle(true);return this},hide:function(){this.toggle(false);this.disableValidation();return this},getRowIndex:function(e){if(e){return e.sort_index}},mergeCells:function(h){var g=0;for(var e=0;e<this.columns.length;e++){var f=this.columns[e];if(!f.ignore&&!f.hidden){if(h.field==f.id){break}else{g++}}}this._mergeCells.push({firstCol:g,lastCol:g+(h.colspan||1)-1,firstRow:h.index,lastRow:h.index+(h.rowspan||1)-1});this.$elem.bootstrapTable("mergeCells",h);this.$elem.removeClass("table-no-bordered").addClass("table-bordered");if(this.bootstrapTable){this.bootstrapTable.options.bordered=true;this.bootstrapTable.$container.find("td[colspan]:not([colspan=1])").each(function(){d(this).children("div.cell").attr("class","cell");if(d(this).next(":visible").length===0){d(this).css("border-right","none")}})}return this},getColumns:function(p){var g=[];for(var j=0;j<this.columns.length;j++){var e=this.columns[j];var f=e.ignore==null?e.hidden:e.ignore;if(!f){var m={id:e.id,title:e.title,width:e.width,excelWidth:e.excelWidth,align:e.align,halign:this.options.columns[j].halign,type:b.DEFAULTS.columnTypeMap[e.type],required:e.required,importRequired:e.importRequired,wrapText:e.wrapText,wrapTitle:e.wrapTitle,headNum:e.headNum,colspan:e.colspan,rowspan:e.rowspan,desc:e.desc,editReference:e.editReference,data:{},frozen:e.fixed=="left",fixed:e.fixed,cellMerge:e.cellMerge,defaultValue:e.defaultValue};var o=["onValidate","validType","valueField","textField","mask","precision","min","max","suffix","multiple","separator"];if(e.type!="areaColumn"){var l=true;if(p){if(e.type=="selectColumn"&&!e.dataUrl&&e.dataContext){l=e.dataContext.indexOf("select_dict")==-1}else{l=true}}else{l=true}if(l){o=o.concat("datas","dataMap")}else{o=o.concat("dataContext")}}for(var h=0;h<o.length;h++){var n=o[h];if(e[n]!=undefined){m.data[n]=e[n]}}g.push(m)}}return g},getColumn:function(j){var h=this.columns,e=h.length,f=null;for(var g=0;g<e;g++){if(h[g].id==j){f=h[g];break}}return f},loadColumnSource:function(k,g){var j=this.columns,e=j.length,f=null;for(var h=0;h<e;h++){if(j[h].id==k){f=j[h];break}}if(f!=null){f.url=g||f.url||f.dataUrl;this.req({async:false,onLoadSuccess:function(n){if(d.isArray(n)){var q={};for(var p=0;p<n.length;p++){var r=n[p];q[r[f.valueField]]=r[f.textField]}f.datas=n;f.dataMap=q;if(this.isEditing()){var m=this.bootstrapTable.$body.find("tr:eq("+this.curEditRowId+") [field='"+k+"']");if(m.length){get(m).loadData(n);var o=this.bootstrapTable.columns,l=null;for(var p=0;p<o.length;p++){if(o[p].field==k){l=o[p];break}}if(l!=null){l.editOptions.datas=n}}}}this.exec(f.onLoadSuccess,[n])}},f)}return this},getColumnText:function(j,h){var k=null;if(j&&h){var f=this.columns;for(var e=0;e<f.length;e++){var g=f[e];if(g.type=="selectColumn"&&g.id==j){k=g.dataMap[h];break}}}return k},setExcelTitleExport:function(e){this.opts.excelTitleExport=e},addClickEvent:function(h){var g=null;if(h){var e=this.btnEvents.length;for(var f=0;f<e;f++){if(this.btnEvents[f].toString()==h.toString()){g=f;break}}if(g==null){g=e;this.btnEvents.push(h)}}return g},exportData:function(o){var n=this.options;var f={};var k=this.exec(n.onBeforeExport,[f]);if(k!==false){o=d.extend({"export":true,datas:"all",columns:this.getColumns(true),exportFileType:this.options.exportFileType,showEditDesc:false,fileName:n.exportFileName||(n.exportDataText+(n.title?"_"+n.title:"")),excelTitle:n.excelTitleExport,excelExportHandler:n.excelExportHandler,lineNum:n.lineNum,mergeCells:this._mergeCells,params:f},o);if(o.datas.length==0){o.mergeCells=[]}if(!d.isArray(o.datas)&&(this._localDatas||o.datas=="selected")){switch(o.datas){case"all":o.datas=this.getRows();break;case"selected":o.datas=this.getSelected();if(o.datas.length==0){return false}break;case"currentPage":var j=[];var g=this.bootstrapTable;for(var h=g.pageFrom-1;h<g.pageTo;h++){j.push(o.datas[h])}o.datas=j;break;default:break}}var e=new Url("exportData");if(!d.isArray(o.datas)){e.urlStr=n.dataUrl;for(var m in this.paramTmp){var l=this.paramTmp[m];e.addParam(m,l)}if("currentPage"==o.datas){var g=this.bootstrapTable;o.pageNum=g.options.pageNumber;o.pageSize=g.options.pageSize}}e.addParam("_gridInfo",o);d.download(e);return true}},beginEdit:function(h,g){if(this.isEditing()){this.endEdit()}var e=this.bootstrapTable.$container.find("tr[data-index='"+h+"']");if(e){var f=e.find(".cell[data-field='"+g+"']");if(f.length==0){f=e.find(".cell[data-field]").eq(0)}f.click()}},endEdit:function(){var e={index:this.curEditRowId,row:this.editRow};this.$elem.find(".grid-input").each(function(){get(this).disableValidation()});this.$elem.bootstrapTable("updateRow",e);this.disableValidation();this.editing=true;this.curEditRowId=undefined;this.editRow=undefined;this.exec(this.options.onEndEdit,[e.row,e.index])},isEditing:function(){return this.options.edit&&this.$elem.find("tr.editing").length>0},setEditable:function(e){this.options.edit=!!e;this.options.edit=!!e},getEditFormItem:function(h){var e=null;if(this.isEditing()){var f=this.bootstrapTable.$container.find("tr[data-index='"+this.curEditRowId+"']");if(f.length){var g=f.find(".cell[data-field='"+h+"']");if(g.length){e=get(g.find(".grid-input.form-item"))}}}return e},moveUpRow:function(e,g){if(e>0){if(this.isEditing()){this.endEdit()}if(g==null||g==undefined){g=1}var f=e-g<0?0:e-g;var h=this.getRows();var j=h[e];h.splice(e,1);h.splice(f,0,j);this.loadData(h)}},moveDownRow:function(e,f){if(this.isEditing()){this.endEdit()}var g=this.getRows();if(e<g.length-1){if(f==null||f==undefined){f=1}var h=g[e];g.splice(e,1);g.splice(e+f,0,h);this.loadData(g)}},_isModify:function(){if(this.isModify&&!this.isHidden()){return true}return false},getCountRowNum:function(h){if(this.countArr.contains(h)){var g=this.bootstrapTable.$body.find("tr.count-row");var f=this.bootstrapTable.fieldsColumnsIndex[h];if(f){var e=g.find("td").eq(f).text();return parseFloat(e)}}}});d.fn.grid=function(e,f){return d.fn.baseTag.apply(this,[e,f,b])};d.fn.grid.constructor=b;b.DEFAULTS={height:null,cls:"",title:null,tHead:true,hidden:false,footer:true,dataUrl:null,page:false,simplePage:false,pageSize:100,serverSort:false,lineNum:true,multiple:false,minHeight:null,maxHeight:null,edit:false,editType:"row",editBtn:false,sortBtn:false,multiSort:false,idField:null,filterRow:false,exportBtn:false,filterColumn:false,bordered:true,importBtn:false,importUrl:"sysCommon/loadImportData",importTemplateName:null,importMaxFileSize:2048,importHandler:null,importTemplateData:false,importType:"cover",importFileType:"xls",exportFileType:"xls",collapsible:false,collapsed:false,autoColumnWidth:false,striped:true,rowStyler:null,autoRowHeight:false,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,onClickRow:null,onDblClickRow:null,onBtnInit:null,onBeforeImport:null,onSelect:null,onSelectAll:null,onUnselect:null,onUnselectAll:null,sortable:true,wrapTitle:false,wrapText:false,onContextMenu:null,onAdd:null,onDelete:null,onInsert:null,onUpdate:null,onBeforeEdit:null,editColumnBtn:true,onImport:function(e,l){var k=this.columns;for(var h=0;h<e.length;h++){var n=e[h];for(var g=0;g<k.length;g++){var f=k[g];if((n[f.id]==null||n[f.id]=="")&&(f.defaultValue||f.defaultValue==0)){n[f.id]=f.defaultValue}}}this.isModify=true;if(this.options.importType=="add"){var m=this.getRows();this.loadData(m.concat(e))}else{this.loadData(e)}},cols:[],datas:[],toolbarBtnOpts:{btnType:"grid",size:"sm"},importBtnText:"导入数据",importSuccessText:"导入文件中包含【%s】行数据，全部成功导入，请查看列表",importTemplateText:"导入模版",showEditDescImport:true,showEditDescExport:false,exportBtnText:"导出数据",exportDataText:"数据列表",excelTitleExport:null,excelExport:null,cancelText:"取消",cancelEditRowText:"当前行有不合法数据，确认要放弃编辑的数据吗？",afterPageText:"共{0}行",selectOneRowText:"请先选择一行",countText:"总计",invalidColText:"第{0}行【{1}】列的数据",requiredText:"不能为空",noImgText:"没有图片显示",columnTypeMap:{textColumn:1,numberColumn:2,datetimeColumn:3,selectColumn:4,areaColumn:5},importHtmlTemplate:'<button class="btn btn-primary" type="button" id="uploadBtn"><span class="icon icon-upload"></span>\n选择文件</button><div class="text-muted margin-top">请先%s，填写后上传</div><p class="text-muted">仅支持%s格式，且文件大小不能超过%s</p>',errorDatasHtmlTemplate:'<div class="alert alert-danger">成功导入%s行，<span class="text-danger">%s行导入失败<span></div><table class="ezui"></table>',filterHtmlTemplate:'<div class="table-filter-column-panel"><div class="toolbar"><div class="check-all">%s</div><div class="buttons"><a href="javascript:;" class="save-btn">确定</a><a href="javascript:;" class="cancel-btn">取消</a></div></div><div class="columns"><ul class="clearfix">%s</ul></div></div>',exportCustomHtmlTemplate:'<div class="export-custom-wrapper">                                                                          	<div class="form-item vertical">                                                                           		<label class="form-label">导出类型</label>                                                             		<div class="box-group input-wrapper export_type">                                                      			<div class="box-control radio">                                                                    				<input name="exportType" type="radio" value="xls" checked><label><span>excel</span></label>    			</div>                                                                                             			<div class="box-control radio">                                                                    				<input name="exportType" type="radio" value="dbf"><label><span>dbf</span></label>              			</div>                                                                                             		</div>                                                                                                 	</div>                                                                                                     	<div class="form-item vertical">                                                                           		<label class="form-label">导出行</label>                                                               		<div class="box-group input-wrapper export_row_type">                                                  			%s                                                                                           		</div>                                                                                                 	</div>                                                                                                     	<div class="form-item">                                                                                    		<label class="form-label">导出列</label>                                                               		<div class="box-group input-wrapper checkall">%s</div>                                                         	</div>                                                                                                     	<ul class="columns">%s</ul>                                                                                </div>                                                                                                       '};var a={utils:{formatter:function(i,j,e,g,h){var f=g.exec(h.formatter,[i,j,e,h.id]);if(d.isArray(f)){f=this.initColumnBtn(f,g)}return f},initColumnBtn:function(t,f,n,g,s,l){if(d.isArray(t)){if(l==undefined||l<2){l=3}if(g&&t.length>l){var m=false;d.each(t,function(w,j){if(j.children){m=true;return false}});if(!m){var r=t.splice(0,l-1);r.push({text:"更多",children:t});t=r}}var k=[];for(var p=0;p<t.length;p++){var h=t[p];if(typeof h=="string"){k.push(h)}else{if(h.authorize&&!TagUtils.checkAuthorize(h.authorize)){continue}var v=null;var u=h.text;if(h.disabled){v=createTag("span").addClass("disabled").attr("title",h.title).append(u)}else{h.textTag=false;if(h.children){for(var o=0;o<h.children.length;o++){var q=h.children[o];var e=f.addClickEvent(q.onClick);q.onClick=null;q.data=d.extend({},q.data,{fnIndex:e});q.textTag=false;q.cls=q.cls?(q.cls+" "+n):n}h.data=d.extend({},h.data,{items:h.children});h.iconCls=h.iconCls?h.iconCls:"icon-angle-down-l";h.iconAlign=h.iconAlign?h.iconAlign:"right";h.cls=h.cls?(h.cls+" table-dropdown-btn "+n):"table-dropdown-btn "+n;if(s=="button"){h.size="sm";h.style="margin-right: 4px";v=TagUtils.createButton(h)}else{v=TagUtils.createHref(h)}}else{var e=f.addClickEvent(h.onClick);h.data=d.extend({},h.data,{fnIndex:e});h.cls=h.cls?(h.cls+" "+n):n;if(s=="button"){h.size="sm";h.style="margin-right: 4px";v=TagUtils.createButton(h)}else{v=TagUtils.createHref(h)}}}k.push(v.toString())}}return k.join("<i class='btn-linked-split'></i>")}},initHrefColumn:function(i,j,e,f,h){if(typeof i=="undefined"){return}var g=[{text:i,onClick:h.onHrefClick}];return this.initColumnBtn(g,f,"button-column")}}};a.textColumn={initOptions:function(e,h){if(e.maxLength||e.minLength){var g=sprintf("length[%s,%s]",e.minLength?e.minLength:0,e.maxLength?e.maxLength:0);e.validType=e.validType?g+"&"+e.validType:g}if(e.validType&&e.validType.indexOf("length[")>-1){if(!e.useCharLength){var k=["idCard","phone","postcode","email","url","tel","qq","letter","number","weixin","half-width"];for(var f=0;f<k.length;f++){var j=k[f];if(e.validType.indexOf(j)>-1){e.useCharLength=true;break}}}if(e.useCharLength){e.validType=e.validType.replace("length[","charLength[")}}},EDIT_ATTR_KEYS:["onValidate","validType","multiple"],DEFAULTS:{editType:"textInput",align:"left",halign:"center",hidden:false,filter:true,ignore:null,sortable:true,resizable:true,fixed:null,wrapTitle:false,wrapText:false,headNum:0,colspan:1,rowspan:1,sorter:function(g,e){var h=/^[u4E00-u9FA5]+$/;var f=typeof g=="string"&&!h.test(g.substring(0,1))&&typeof e=="string"&&!h.test(e.substring(0,1));if(f){return g.localeCompare(e)}else{if(typeof g!="number"&&!g){return -1}else{if(typeof e!="number"&&!e){return 1}else{return g==e?0:(g>e?1:-1)}}}},required:false,importRequired:true,edit:true,validType:null,minWidth:80,onBeforeEdit:null,isShortcutKey:true,searchable:true,defaultValue:null}};a.numberColumn={initOptions:function(e,f){if(e.count){f.countArr.push(e.id)}},formatter:function(j,m,i,n,e){if(j){if(!isNaN(j)){var h=n.precision;j=NumberUtils.toFixed(parseFloat(j),h);var l=j,k="";var g=j.indexOf(".");if(g>=0){l=j.substring(0,g);k=j.substring(g+1,j.length)}var f=/(\d+)(\d{3})/;while(f.test(l)){l=l.replace(f,"$1,$2")}if(k){j=l+"."+k}else{j=l}}}return j},EDIT_ATTR_KEYS:a.textColumn.EDIT_ATTR_KEYS.concat(["precision","min","max"]),DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{editType:"numberInput",align:"right",halign:"center",min:null,max:null,precision:0,escape:false,count:false,searchable:true,defaultValue:null})};a.datetimeColumn={formatter:function(i,j,g,f,h){var e=f.mask;i=DatetimeUtils.format(DatetimeUtils.parse(i,e),e);return i},EDIT_ATTR_KEYS:a.textColumn.EDIT_ATTR_KEYS.concat(["mask","min","max","isTableEdit"]),DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{editType:"datetime",mask:"yyyy-MM-dd HH:mm",min:null,max:null,isTableEdit:true,sorter:function(f,e){return f==e?0:(f>e?1:-1)},searchable:true,defaultValue:null})};a.selectColumn={initOptions:function(h,k){if(h.dataUrl){k.req({url:h.dataUrl,async:false,onLoadSuccess:function(i){h.datas=i;this.exec(h.onLoadSuccess,[i])}},h)}else{if(h.dataContext){h.datas=d.getContextData(h.dataContext)}}var e=h.datas,g=h.valueField,f=h.textField;h.dataMap={};h.tagMap={};for(var j=0;j<e.length;j++){var l=e[j];h.dataMap[l[g]]=l[f];h.tagMap[l[g]]=l}},initEditOptions:function(f,g){g.dataUrl=f.dataUrl;g.onBeforeLoad=f.onBeforeLoad;g.onLoadSuccess=f.onLoadSuccess;g.onLoadError=f.onLoadError;g.datas=f.datas;g.onOptionInit=f.onOptionInit;g._cascadeId=f.cascadeId;if(f.onSelect){var e=f.onSelect;g.onSelect=function(h){this.exec(e,[h]);this.$select.select2("focus")}}else{g.onSelect=function(){this.$select.select2("focus")}}g.onLoadData=function(o){if(d.isArray(o)){var u=this.$elem.closest("table");var h=get(u);if(h){var t=this.$elem.closest(".editable-input").data("field");if(t){var r=h.columns,p=r.length,k=null;for(var n=0;n<p;n++){if(r[n].id==t){for(var l=0;l<p;l++){if(r[l].cascadeId==t){return}}k=r[n];var q=k.dataMap;for(var n=0;n<o.length;n++){var m=o[n];q[m[k.valueField]]=m[k.textField]}k.datas=o;k.dataMap=q;var s=h.bootstrapTable.columns;for(var l=0;l<s.length;l++){if(s[l].field==t){s[l].editOptions.datas=o;break}}break}}}}}}},formatter:function(n,q,l,r,e){var j=r.tagClassField;var o=r.tagTypeField;var k=r.tagMap[n];if(n){if(r.multiple){var p=n.split(",");var g=[];for(var h=0;h<p.length;h++){var f=p[h];g.push(r.dataMap[f]||f)}n=g.join(r.separator)}else{n=r.dataMap[n]||n}}if(r.tagMap!=null&&r.useTag&&n!=null){var m='<span class="badge badge-only-text ';if(k[j]!=null){m=m+k[j]+" "}if(k[o]!=null){m=m+"badge-outline-"+k[o]}if(k[j]==null&&k[o]==null){m="<span"}m=m+'">'+n+"</span>";return m}else{return n}},EDIT_ATTR_KEYS:a.textColumn.EDIT_ATTR_KEYS.concat(["min","max","valueField","textField","multiple","noResultText","closeOnSelect","isTableEdit","filterFn","loadMore","onBtnInit"]),DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{editType:"select",valueField:"value",textField:"text",dataUrl:null,datas:[],multiple:false,min:null,max:null,blankOpt:null,blankOptText:"请选择",escape:false,onSelect:null,onUnselect:null,onLoadSuccess:null,onBeforeLoad:null,onLoadError:null,onFilter:null,closeOnSelect:false,reloadEdit:null,separator:",",isTableEdit:true,searchable:true,defaultValue:null})};a.areaColumn={initOptions:function(e,f){e.dataMap=d.fn.area.utils.getAreaData()},formatter:function(i,k,f,e,g){var j=null;var h=[];while(e.dataMap[i]){if(e.dataMap[i].name){h.push(e.dataMap[i].name);i=e.dataMap[i].parent}}j=h.reverse().join(" - ");return j},DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{placeholder:"请选择所在地区",escape:false,editType:"area",searchable:true,defaultValue:null})};a.imgColumn={formatter:function(j,k,g,f,h){var i=createTag("i").addClass("ui-grid-img");if(j){var e=j;if(f.encrypted){e="sysFile/viewImg/"+j}else{if(!StringUtils.validate(j,"url").isValid){e=f.baseImgUrl+j}}var l="eye";if(f.onInitIcon){l=h.exec(f.onInitIcon,[j,k,g,f])}i.addClass("icon-"+l).attr("data-url",e).attr("data-img-width",f.imgWidth).attr("data-img-height",f.imgHeight)}else{i.addClass("icon-search")}return i.toString()},DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{align:"center",edit:false,filter:false,sortable:false,encrypted:false,ignore:true,defaultValue:null})};a.buttonColumn={initOptions:function(e,f){if(!e.id){e.id="operateBtn"+a.buttonColumn.DEFAULTS.columnIndex;a.buttonColumn.DEFAULTS.columnIndex++}if(e.buttons.length){e.buttonColumnTag=a.utils.initColumnBtn(e.buttons,f,"button-column",e.moreBtn,e.buttonType,e.moreBtnCount)}if(e.buttonType=="button"){e["class"]+=" btnCol"}},formatter:function(j,k,f,e,g){j=e.buttonColumnTag||"";if(e.onBtnInit){var i=g.exec(e.onBtnInit,[k,f]);if(d.isArray(i)){if(j){j+="<i class='btn-linked-split'></i>"}j+=a.utils.initColumnBtn(i,g,"button-column",e.moreBtn,e.buttonType,e.moreBtnCount)}}if(e.sortBtn){var h=[];if(f>0){h.push({text:"↑",onClick:function(n,l,m){m.moveUpRow(l)}})}if(f<g.getRows().length-1){h.push({text:"↓",onClick:function(n,l,m){m.moveDownRow(l)}})}if(h.length>0){if(j){j+="<i class='btn-linked-split'></i>"}j+=a.utils.initColumnBtn(h,g,"button-column")}}return j},DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{columnIndex:0,title:"操作",align:"center",edit:false,filter:false,sortable:false,wrapText:true,sortBtn:false,"class":"operate-btn",ignore:true,searchable:false,moreBtn:false,buttonType:"link"})};a.uploadColumn={initOptions:function(e,f){e.editType},formatter:function(o,p,k,q,e){if(o){var f=new Url("sysFile/getFileMap.do");f.addParam("fileIds",o.split(","));var m=d.req(f,false);if(m&&d.isArray(m)){var l=createTag("div").addClass("ui-filelist");for(var j=0;j<m.length;j++){var h=m[j];var g=createTag("div").addClass("ui-file success").data("id",h.fileId).appendTo(l);var n=createTag("a").addClass("download-file").append(createTag("span").append(h.fileName)).appendTo(g);createTag("div").addClass("file-size").append(createTag("span").append(d.util.getFileSize(h.fileSize/1024))).appendTo(g);if(!e.options.edit||!q.edit){if("pdf"==h.suffix.toLowerCase()){n.attr("href","javascript: window.open('sysFile/pdf/"+h.fileId+"');void(0);")}else{n.attr("href","javascript: $.download('sysFile/downFile.do?fileId="+h.fileId+"');")}}}return l.toString()}}return o},EDIT_ATTR_KEYS:a.textColumn.EDIT_ATTR_KEYS.concat(["fileType","cropable","wrapText","encrypted","maxFileSize","minFileSize","tagId","downloadBtn","previewBtn","maxFileCnt","uploadUrl","dataUrl","dataContext","onUploadSuccess","baseImgUrl"]),DEFAULTS:d.extend({},a.textColumn.DEFAULTS,{fileType:"doc,docx,xls,xlsx,pdf",editType:"upload",cropable:false,wrapText:true,encrypted:false,maxFileSize:2048,downloadBtn:false,previewBtn:false,maxFileCnt:1,uploadUrl:"sysFile/uploadFile.do",dataUrl:"sysFile/getFileMap.do",dataContext:null,defaultValue:null})};d.fn.grid.columnConfig=a;var c=d.fn.grid.constructor.extend({initTag:function(){this._super();this.bootstrapTable.$container.off("click.col.btn").on("click.col.btn","[data-fn-index]",this,function(k){var f=d(this).data("fnIndex");if(typeof f!="undefined"){var i=k.data,g=i.btnEvents[f],h=d(this).closest("tr"),l=i.getRow(h);var j=d(this).closest(".cell").data("field");i.exec(g,[l,j])}})},getBsOptions:function(){var f=this,e=this._super();var g=e.onPostBody;e.treeData=this.options.treeData,e.treeShowField=this.options.treeField||this.options.textField,e.parentIdField=this.options.parentField,e.onPostBody=function(h){if(h.length==0){return}var j=0,i=-1;d.each(f.bsColumns,function(){f.exec(g);for(var l=0;l<this.length;l++){var m=this[l].field;if(m){i++;if(m==e.treeShowField){var k={treeColumn:i,expanderExpandedClass:"",expanderCollapsedClass:"",onChange:function(){f.$elem.bootstrapTable("resetWidth")}};if(f.options.icon){d.extend(k,{expanderExpandedClass:"icon-caret-down",expanderCollapsedClass:"icon-caret-right"})}f.$elem.treegrid(k);return false}}}})};return e},getRow:function(e){return this.bootstrapTable.treeData[e.data("uniqueid")]},getRows:function(){var e=[];var f=function(h){for(var g=0;g<h.length;g++){var j=h[g];e.push(j);j.children&&f(j.children)}};f(this.$elem.bootstrapTable("getData"));return e},getSelected:function(f){var e=this.opts.multiple;var g=this.$elem.bootstrapTable("getAllSelections");if(g.length==0&&f!==false){d.notify(this.opts.selectOneRowText,"danger")}return g}});d.fn.treeGrid=function(e,f){return d.fn.baseTag.apply(this,[e,f,c])};d.fn.treeGrid.constructor=c;c.DEFAULTS=d.extend({},b.DEFAULTS,{parentField:"parent",lineNum:false,treeData:false,icon:true,footer:false})}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){this.$header=this.$elem.find("> .panel-heading");this.$body=this.$elem.find("> .panel-body");if(this.opts.collapsible){var c=this;this.$header.find(".collapsible").off("click").on("click",function(d){if(b(this).hasClass("collapsed")){c.expand()}else{c.collapse()}})}if(this.options.url){this.refresh()}},toggle:function(c){this.$elem.toggle(c);this.$elem.find(".tooltip-f").tooltip("destroy");return this},show:function(){this.$elem.show();return this},hide:function(){this.$elem.hide();this.$elem.find(".tooltip-f").tooltip("destroy");return this},refresh:function(c){c=b.isPlainObject(c)?c:{url:c};b.extend(this.options,{context:this},c);b.pageProxy.util.loadContent(this.options,this.$body);return this},getBody:function(){return this.$body},setTitle:function(d){var c=this.$header.find(".panel-actions");if(c.length>0){c.detach()}this.$header.html(d);this.$header.append(c);return this},collapse:function(){this.$body.fadeOut();var c=this.$header.find(".collapsible").addClass("collapsed");c.find("span").text("展开");c.find("i").removeClass("icon-angle-up").addClass("icon-angle-down");return this},expand:function(){this.$body.fadeIn();var c=this.$header.find(".collapsible").removeClass("collapsed");c.find("span").text("收起");c.find("i").removeClass("icon-angle-down").addClass("icon-angle-up");return this}});b.fn.card=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.card.constructor=a;a.DEFAULTS={url:null,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,loadingMessage:"正在处理，请稍待。。。",buttons:null}}(window.jQuery);!function(c){var b=c.fn.baseTag.constructor.extend({initTag:function(){var d=this.opts;this.$nav=this.$elem;if(this.opts.url){this.refresh()}else{this.loadData(this.opts.items)}var e=this;this.$nav.on("click","li:not(.dropdown)",function(){if(c(this).hasClass("active")||c(this).find("a").attr("href")!="javascript:void(0)"){return}var f=c(this).data("index");e.select(f)})},select:function(f){this.opts.selected=f;var d=this.$nav.find(".active");d.removeClass("active");var e=this.$nav.find("li[data-index="+f+"]");e.addClass("active");this.exec(this.opts.onSelect,[this.opts.items[f],f])},refresh:function(d){d=c.isPlainObject(d)?d:{url:d};c.extend(this.opts,d);this.req({onLoadSuccess:function(e){this.loadData(e);this.exec(this.opts.onLoadSuccess,[e])}})},loadData:function(g){this.opts.items=g;var m=createTag("");var j=g.length>6;var h=j?6:g.length;for(var f=0;f<h;f++){var p=g[f];var n=p[this.opts.textField];var o=this.opts.selected==f;var q=createTag("li").attr("id",p.id).addClass(p.cls).addClass(o?"active":null).attr("title",n).attr("data-index",f).appendTo(m);var d=p.url||"javascript:void(0)";createTag("a").attr("href",d).attr("target",p.target).append(n).appendTo(q)}if(j){var e=createTag("li").addClass("dropdown").appendTo(m);createTag("a").attr("href","#").addClass("dropdown-toggle").attr("data-toggle","dropdown").append("更多").append('<b class="caret"></b>').appendTo(e);var k=createTag("ul").addClass("dropdown-menu").appendTo(e);for(var f=6;f<g.length;f++){var p=g[f];var n=p[this.opts.textField];var l=createTag("li").attr("id",p.id).addClass(p.cls).attr("title",n).attr("data-index",f).appendTo(k);var d=p.url||"javascript:void(0)";createTag("a").attr("href",d).attr("target",p.target).append(n).appendTo(l)}}this.$nav.html(m.toString())}});c.fn.nav=function(d,e){return c.fn.baseTag.apply(this,[d,e,b])};c.fn.nav.constructor=b;b.DEFAULTS={selected:0,textField:"title"};var a=c.fn.baseTag.constructor.extend({initTag:function(){var e=this.opts;this.parentPageProxy=this.opts.pageProxy;this.$nav=this.$elem.find("> .tabs-bar > .nav-tabs");this.$tabContent=this.$elem.find("> .tab-content");var g=this;this.$nav.on("click",">li",function(){if(c(this).hasClass("active")||c(this).hasClass("disabled")){return}var i=g.$nav.find(".active");i.removeClass("active");c(this).addClass("active");var j=g.$tabContent.children(".active");j.removeClass("active");var h=c(this).index();g.getTab(h).addClass("active");if(g.opts.tabs[h].pageProxy){g.opts.pageProxy=g.opts.tabs[h].pageProxy}else{g.opts.pageProxy=g.parentPageProxy}if(!c(this).data("loaded")){g.refresh(h)}if(e.selectLasted){c.cookie(g.opts.jspPath,h)}g.exec(g.options.onSelect,[h])});this.$nav.on("click",".icon-times",function(){var k=c(this).parent();if(k.hasClass("disabled")){return}var i=k.index();var j=g.getTab(i);var h=true;if(TagUtils.isFormModify(j)){h=confirm("离开此网站？\n系统可能不会保存您所做的更改。")}if(h){k.remove();j.remove();g.opts.tabs.splice(i,1);k.hasClass("active")&&g.select(0)}return false});var f=null;if(e.selectLasted){var d=c.cookie(e.jspPath);if(typeof d!="undefined"&&d!=this.opts.selected){f=d}}if(f!=null){this.select(f)}else{this.refresh(this.opts.selected)}},addTab:function(d){var g=c.extend({},this.opts.tabDefaults,d);this.opts.tabs.push(g);var f=createTag("li").append(g.title);if(g.closable){createTag("i").addClass("icon-times").appendTo(f)}this.$nav.append(f.toString());if(!this.opts.nav){var e=createTag("div").addClass("tab-pane").attr("data-no-load",true).addClass(g.cls);if(g.clear){e.addClass("no-padding")}}this.$tabContent.append(e.toString());this.select(this.opts.tabs.length-1)},getSelected:function(){return this.$tabContent.find("> .tab-pane.active")},getSelectedIndex:function(){return this.$tabContent.find("> .tab-pane.active").index()},getTabIndex:function(e){var d=e.index();return d},refresh:function(e,d){var g=this.opts.tabs[e];if(g){d=c.isPlainObject(d)?d:{url:d||g.url};c.extend(g,{context:this,pageProxy:this.parentPageProxy},d);var f=this.getTab(e);c.pageProxy.util.loadContent(g,f);this.$nav.find("li:eq("+e+")").data("loaded",true)}},resetLoadStatus:function(d){this.$nav.find("li:eq("+d+")").removeData("loaded")},getTab:function(d){return this.$tabContent.find("> .tab-pane:eq("+d+")")},closeTab:function(d){this.$nav.find("li:eq("+d+")").find(".icon-times").click()},select:function(d){this.$nav.find("li:eq("+d+")").click()},load:function(e,d){this.refresh(e,d)}});c.fn.tabs=function(d,e){return c.fn.baseTag.apply(this,[d,e,a])};c.fn.tabs.constructor=a;a.DEFAULTS={height:"auto",width:"auto",selected:0,tabPosition:"top",border:true,selectLasted:false,tabDefaults:{url:null,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,loadingMessage:"正在处理，请稍待。。。"}}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var d=this.opts;if(d.dataUrl){this.load()}else{if(d.datas){this.loadData(d.datas)}}var c=this;this.$elem.on("click","li.sidebar-item",function(h,f){if(b(this).hasClass("active")){return false}var i=b(this).data("id");c.select(i);if(d.onClick){var g=c._getNode(i);return c.exec(d.onClick,[g])}});this.$elem.on("click","div.sidebar-title",function(){var f=b(this).parent();var i,e;if(c.options.keepOnlyParent){var h=b(this).closest("ul");if(f.hasClass("open")){if(!f.find("li.active").length){var g=h.find(">li.active");if(!g.hasClass("menu-close")){h.find("li.active").addClass("open").find(">div.sidebar-title .sidebar-collapse").toggleClass("icon-angle-up").toggleClass("icon-angle-down");i=g.find(">ul")}}else{f.addClass("menu-close")}e=f.find(">ul")}else{f.removeClass("menu-close").find("li.sidebar-sub.active").addClass("open");var j=h.find(">li.open");h.find("li.open").not(f.find("li.sidebar-sub").add(j)).removeClass("open").find(">div.sidebar-title .sidebar-collapse").toggleClass("icon-angle-up").toggleClass("icon-angle-down");i=f.find(">ul");e=j.find(">ul")}}else{if(f.hasClass("open")){e=f.find(">ul")}else{i=f.find(">ul")}}if(e&&e.length){c.closeMenu(e)}if(i&&i.length){c.openMenu(i)}});if(d.onContextMenu){this.$elem.delegate("a","contextmenu",function(f){var e=c._getNode(b(this));return c.exec(d.onContextMenu,[e,f])})}},unselect:function(){var c=this.$elem.find(".active").removeClass("active").data("id");if(this.options.onUnselect){var d=this._getNode(c);this.exec(this.options.onUnselect,[d])}return this},select:function(d){var e=this.$elem.find("[data-id='"+d+"']");if(e.length==0){return this}var f=this.$elem.find("li.sidebar-item.active");var i=f.parents("li.sidebar-sub.active");i.add(f).removeClass("active");var c=e.parents("li.sidebar-sub");if(this.options.keepOnlyParent){i.filter(".menu-close").removeClass("menu-close");var g=e.parent().find(">li.open");this.$elem.find("li.open").not(c.add(g)).removeClass("open").find(">div.sidebar-title .sidebar-collapse").removeClass("icon-angle-up").addClass("icon-angle-down");if(g.length){this.closeMenu(g.find(">ul"))}c.find(">div.sidebar-title .sidebar-collapse").addClass("icon-angle-up").removeClass("icon-angle-down")}c.add(e).addClass("active open");if(this.options.onSelect){var h=this._getNode(d);this.exec(this.options.onSelect,[h])}return this},selectFirst:function(){this.$elem.find("li[data-id]:eq(0)").click();return this},getSelect:function(){var c=this.$elem.find("li.sidebar-item.active");var d=c.data("id");return this._getNode(d)},expandAll:function(){this.$elem.find(".sidebar-sub").addClass("open");this.$elem.find(".sidebar-collapse").addClass("icon-angle-up").removeClass("icon-angle-down");return this},collapseAll:function(){this.$elem.find(".sidebar-sub").removeClass("open");this.$elem.find(".sidebar-collapse").removeClass("icon-angle-up").addClass("icon-angle-down");return this},refresh:function(c){return this.load(c)},load:function(c){c=b.isPlainObject(c)?c:{dataUrl:c||this.opts.dataUrl};b.extend(this.opts,c);this.req({url:this.opts.dataUrl,onLoading:function(){this.$elem.html("<div class='spin-loading'><i class='icon icon-spin icon-spinner icon-2x'></i></div>");this.exec(this.opts.onLoading)},onLoadSuccess:function(d){if(b.isArray(d)){this.loadData(d)}else{this.$elem.html(TagUtils.createEmpty().toString())}this.exec(this.opts.onLoadSuccess,[d])}});return this},loadData:function(c){function j(o,l){l++;var p=createTag("ul").addClass("sidebar-level-"+l);for(var n=0;n<o.length;n++){var m=o[n];var s=createTag("li").appendTo(p);var q=l==0?TagUtils.createIcon(m.iconCls||"icon-app"):null;var t=m[d];if(!m.children){s.addClass("sidebar-item").attr("title",t).data("id",m[e]);TagUtils.createHref({text:createTag("span").append(t),url:m[i]?f.options.urlPrefix+m[i]:null,target:m.target}).prepend(q).appendTo(s)}else{var k=f.options.open?((typeof m.open=="undefined")?true:m.open):false;s.addClass("sidebar-sub").addClass("open",k);var r=createTag("div").addClass("sidebar-title").attr("title",t).append(q).appendTo(s);createTag("span").append(t).appendTo(r);createTag("i").addClass("sidebar-collapse").addClass(k?"icon-angle-up":"icon-angle-down").appendTo(r);j(m.children,l).appendTo(s)}}return p}var f=this,e=this.options.idField,d=this.options.textField,i=this.options.urlField;if(!this.options.treeData){c=b.util.transListToTree(c,{idField:this.options.idField,textField:this.options.textField,parentField:this.options.parentField})}this.opts.datas=c;if(!c.length){this.$elem.html(TagUtils.createEmpty().toString());return}var g=createTag("");if(this.options.showCollapseIcon){createTag("div").addClass("sidebar-toggle icon-menu-unfold").attr("title","收起侧边栏").appendTo(g)}var h=-1;j(c,h).addClass("animation-fade").appendTo(g);this.$elem.html(g.toString());return this},_getNode:function(e){var c=this.opts.idField;var f=function(g,k){for(var h=0;h<g.length;h++){var j=g[h];if(j[c]==e){return j}else{if(j.children){j=f(j.children,e);if(j!=null){return j}}}}};var d=f(this.opts.datas,e);return d},toggle:function(c){this.$elem.toggle(c);return this},setUrlPrefix:function(c){if(c){this.options.urlPrefix=c}return this},scrollTo:function(d){var c=this.$elem.find("[data-id="+d+"]");if(c.length==1){if(c.closest("ul.sidebar-level-0").height()>this.$elem.height()){this.$elem.scrollTop(c.scrollTop())}}return this},toggleCollapsed:function(){this.$elem.toggleClass("collapsed");return this},isCollapsed:function(){return this.$elem.hasClass("collapsed")},on:function(d,e){var c="on"+d.charAt(0).toUpperCase()+d.slice(1);this.options[c]=e;return this},openMenu:function(c){var d=c.height();c.css({height:0,opacity:0}).addClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active");setTimeout(function(){c.css({height:d,opacity:1})},0);setTimeout(function(){c.removeClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active").css({height:"",opacity:""})},300);c.parent("li").addClass("open").find(">div.sidebar-title .sidebar-collapse").addClass("icon-angle-up").removeClass("icon-angle-down")},closeMenu:function(c){var d=c.height();c.css({height:d,opacity:1}).addClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active");setTimeout(function(){c.css({height:0,opacity:0})},0);setTimeout(function(){c.removeClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active").css({height:"",opacity:""});c.parent("li.open").removeClass("open").find(">div.sidebar-title .sidebar-collapse").removeClass("icon-angle-up").addClass("icon-angle-down")},300)}});b.fn.menu=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.menu.constructor=a;a.DEFAULTS={idField:"id",textField:"title",urlField:"url",urlPrefix:"",parentField:"parent",dataUrl:null,onClick:null,onBeforeClick:null,onDblClick:null,onContextMenu:null,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,treeData:false,open:true,keepOnlyParent:false}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var d=this.opts;if(d.dataUrl){this.load()}else{if(d.datas){this.loadData(d.datas)}}var c=this;this.$elem.on("click","li.sidebar-item",function(h,f){if(b(this).hasClass("active")){return false}var i=b(this).data("id");c.select(i);if(d.onClick){var g=c._getNode(i);return c.exec(d.onClick,[g])}});this.$elem.on("click","div.sidebar-title",function(){var e=b(this).parent();var f=e.find(">ul");if(e.hasClass("open")){c.closeMenu(f)}else{c.openMenu(f)}});if(d.onContextMenu){this.$elem.delegate("a","contextmenu",function(f){var e=c._getNode(b(this));return c.exec(d.onContextMenu,[e,f])})}},unselect:function(){var c=this.$elem.find(".active").removeClass("active").data("id");if(this.options.onUnselect){var d=this._getNode(c);this.exec(this.options.onUnselect,[d])}return this},select:function(d){var e=this.$elem.find("[data-id='"+d+"']");if(e.length==0){return this}var f=this.$elem.find("li.sidebar-item.active");var h=f.parents("li.sidebar-sub.active");h.add(f).removeClass("active");var c=e.parents("li.sidebar-sub");c.addClass("active open").find(">div.sidebar-title .tree-menu-collapse").addClass("icon-caret-down").removeClass("icon-caret-right");e.addClass("active");if(this.options.onSelect){var g=this._getNode(d);this.exec(this.options.onSelect,[g])}return this},selectFirst:function(){this.$elem.find("li[data-id]:eq(0)").click();return this},getSelect:function(){var c=this.$elem.find("li.sidebar-item.active");var d=c.data("id");return this._getNode(d)},expandAll:function(){this.$elem.find(".sidebar-sub").addClass("open");this.$elem.find(".tree-menu-collapse").addClass("icon-caret-down").removeClass("icon-caret-right");return this},collapseAll:function(){this.$elem.find(".sidebar-sub").removeClass("open");this.$elem.find(".tree-menu-collapse").removeClass("icon-caret-down").addClass("icon-caret-right");return this},refresh:function(c){return this.load(c)},load:function(c){c=b.isPlainObject(c)?c:{dataUrl:c||this.opts.dataUrl};b.extend(this.opts,c);this.req({url:this.opts.dataUrl,onLoading:function(){this.$elem.html("<div class='spin-loading'><i class='icon icon-spin icon-spinner icon-2x'></i></div>");this.exec(this.opts.onLoading)},onLoadSuccess:function(d){if(b.isArray(d)){this.loadData(d)}else{this.$elem.html(TagUtils.createEmpty().toString())}this.exec(this.opts.onLoadSuccess,[d])}});return this},loadData:function(c){function j(p,m){m++;var q=createTag("ul").addClass("sidebar-level-"+m);for(var o=0;o<p.length;o++){var n=p[o];var t=createTag("li").appendTo(q);var u=n[d];if(n.children){var k=f.options.open?((typeof n.open=="undefined")?true:n.open):false;t.addClass("sidebar-sub").addClass("open",k);var r=TagUtils.createIcon("tree-menu-collapse icon-caret-right");var s=createTag("div").addClass("sidebar-title").attr("title",u).append(r).appendTo(t);createTag("span").append(u).appendTo(s);j(n.children,m).appendTo(t)}else{t.addClass("sidebar-item").attr("title",u).data("id",n[e]);var l=f.options.urlPrefix+n[i];if(n[i].indexOf("http")>=0){l=n[i]}TagUtils.createHref({text:createTag("span").append(u),url:n[i]?l:null,target:n.target}).appendTo(t)}}return q}var f=this,e=this.options.idField,d=this.options.textField,i=this.options.urlField;if(!this.options.treeData){c=b.util.transListToTree(c,{idField:this.options.idField,textField:this.options.textField,parentField:this.options.parentField})}this.opts.datas=c;if(!c.length){this.$elem.html(TagUtils.createEmpty().toString());return}var g=createTag("");if(this.options.showCollapseIcon){createTag("div").addClass("sidebar-toggle icon-menu-unfold").attr("title","收起侧边栏").appendTo(g)}var h=-1;j(c,h).addClass("animation-fade").appendTo(g);this.$elem.html(g.toString());return this},_getNode:function(e){var c=this.opts.idField;var f=function(g,k){for(var h=0;h<g.length;h++){var j=g[h];if(j[c]==e){return j}else{if(j.children){j=f(j.children,e);if(j!=null){return j}}}}};var d=f(this.opts.datas,e);return d},toggle:function(c){this.$elem.toggle(c);return this},setUrlPrefix:function(c){if(c){this.options.urlPrefix=c}return this},scrollTo:function(d){var c=this.$elem.find("[data-id="+d+"]");if(c.length==1){if(c.closest("ul.sidebar-level-0").height()>this.$elem.height()){this.$elem.scrollTop(c.scrollTop())}}return this},toggleCollapsed:function(){this.$elem.toggleClass("collapsed");return this},isCollapsed:function(){return this.$elem.hasClass("collapsed")},on:function(d,e){var c="on"+d.charAt(0).toUpperCase()+d.slice(1);this.options[c]=e;return this},openMenu:function(c){var d=c.height();c.css({height:0,opacity:0}).addClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active");setTimeout(function(){c.css({height:d,opacity:1})},0);setTimeout(function(){c.removeClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active").css({height:"",opacity:""})},300);c.parent("li").addClass("open").find(">div.sidebar-title .icon").addClass("icon-caret-down").removeClass("icon-caret-right")},closeMenu:function(c){var d=c.height();c.css({height:d,opacity:1}).addClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active");setTimeout(function(){c.css({height:0,opacity:0})},0);setTimeout(function(){c.removeClass("ez-motion-collapse-legacy ez-motion-collapse-legacy-active").css({height:"",opacity:""});c.parent("li.open").removeClass("open").find(">div.sidebar-title .icon").removeClass("icon-caret-down").addClass("icon-caret-right")},300)}});b.fn.treeMenu=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.treeMenu.constructor=a;a.DEFAULTS={idField:"id",textField:"title",urlField:"url",urlPrefix:"",parentField:"parent",dataUrl:null,onClick:null,onBeforeClick:null,onDblClick:null,onContextMenu:null,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,treeData:false,open:true,keepOnlyParent:false}}(window.jQuery);!function(a){var b=a.fn.baseTag.constructor.extend({initTag:function(){this._newCount=0;var e=this;var d=this.opts;var c={data:{key:{name:d.textField},simpleData:{enable:true,idKey:d.idField,pIdKey:d.parentField}},view:{showIcon:false,fontCss:a.parseJSON(d.fontCss)},callback:{beforeClick:function(h,g,f){return e.exec(e.opts.onBeforeClick,[g,f])},onClick:function(g,i,h,f){e.exec(d.onClick,[h,g,f])},onAsyncSuccess:function(f,h,g,i){e.$elem.next().show().next().hide();e.exec(d.onLoadSuccess)},onRename:function(g,i,h,f){e.exec(d.onRename,[h,g,f])},onRemove:function(f,h,g){e.exec(d.onRemove,[g,f])}},icon:{parentIconOpen:d.parentIconOpen,parentIconClose:d.parentIconClose,leafIcon:d.leafIcon,}};if(d.onContextMenu){c.callback.onRightClick=function(f,h,g){e.exec(d.onContextMenu,[g,f])}}if(d.multiple){c.check={enable:true,chkboxType:d.chkboxType};c.callback.onCheck=function(g,h,f){e.exec(d.onCheck,[f,g])}}c.edit={enable:true,editNameSelectAll:true,showRemoveBtn:function(h,g){var f=d.showRemoveBtn;if(f!==true){return e.exec(f,[g])}else{return g[d.idField]!="root"}return false},showRenameBtn:function(h,g){var f=d.showRenameBtn;return false}};c.callback.beforeRemove=function(g,f){return e.exec(d.onBeforeRemove,[f])};c.view.addHoverDom=function(n,m){var g=a("#"+d.tagId);var f=a("#"+m.tId+"_a",g);h("addBtn","add","新增节点",function(){var o=d.onAdd;if(!o){var i={pId:m.id};i[d.idField]="newId";i[d.textField]="新节点"+(e._newCount++);e.addNodes(m,i)}else{e.exec(o,[m])}return false},function(p,o){var i=d.showAddBtn;if(i!==true){i=e.exec(i,[p,o])}return i||false});if(d.onBtnInit){var l=e.exec(d.onBtnInit);for(var k=0;k<l.length;k++){var j=l[k];h(j.id||("cus_btn_"+k),j.iconCls,j.title,j.onClick,j.showBtnFunc)}}function h(t,o,s,r,q){if(a.isFunction(q)&&!q(m)){return}var p=m.tId+"_"+t;if(a("#"+p,g).length>0){return}var i=a("<span class='button "+o+"' id='"+p+"' "+(s?"title='"+s:"")+(s?"'":"")+" onfocus='this.blur();'></span>");f.append(i);i.on("click",function(){r(m);return false})}};c.view.removeHoverDom=function(m,l){var f=a("#"+d.tagId);j("addBtn");if(d.onBtnInit){var k=e.exec(d.onBtnInit);for(var h=0;h<k.length;h++){var g=k[h];j(g.id||("cus_btn_"+h))}}function j(i){a("#"+l.tId+"_"+i,f).unbind().remove()}};if(d.drag){c.callback.beforeDrag=function(j,h){var g=d.onBeforeDrag;if(!g){for(var f=0;f<h.length;f++){if(h.functionId=="root"){return false}}}else{return e.exec(g,[h])}};if(d.onDrag){c.callback.onDrag=function(f,h,g){e.exec(d.onDrag,[g])}}c.callback.beforeDrop=function(j,i,k,h,f){var g=d.onBeforeDrop;if(!g){if(k.functionId=="root"&&h!="inner"){return false}}else{return e.exec(g,[i,k,h,f])}};c.callback.beforeDragOpen=function(g,f){return true};if(d.onDrop){c.callback.onDrop=function(h,j,i,k,g,f){e.exec(d.onDrop,[i,k,g,f,h])}}}else{c.callback.beforeDrag=function(){return false}}if(d.onAddDiyDom){c.view.addDiyDom=function(g,f){return e.exec(e.opts.onAddDiyDom,[f])}}if(d.dataUrl){if(d.async){c.async={enable:true,url:d.dataUrl,autoParam:[d.idField+"=parent","level"]};this.treeObj=a.fn.zTree.init(a("#"+d.tagId),c)}else{this.treeObj=a.fn.zTree.init(a("#"+d.tagId),c);this.req({url:d.dataUrl,onLoadSuccess:function(f){this.treeObj=a.fn.zTree.init(a("#"+this.opts.tagId),c,f);this.exec(this.opts.onLoadSuccess,[f])}})}}else{if(this.opts.dataContext){d.datas=a.getContextData(this.opts.dataContext)}this.treeObj=a.fn.zTree.init(a("#"+d.tagId),c,d.datas)}},expandAll:function(c){this.treeObj.expandAll(c)},updateNode:function(c){this.treeObj.updateNode(c)},getNodes:function(){return this.treeObj.getNodes()},addNode:function(c,e,d){if(typeof d=="undefined"||d==null){return this.treeObj.addNodes(c,e)}else{return this.treeObj.addNodes(c,d,e)}},refresh:function(){this.load()},load:function(c){if(this.opts.asyn){this.treeObj.reAsyncChildNodes(null,"refresh")}else{this.req({url:c||this.opts.dataUrl,onLoadSuccess:function(d){this.loadData(d);this.exec(this.opts.onLoadSuccess,[d])}})}},loadData:function(c){a.fn.zTree.init(a("#"+this.opts.tagId),this.treeObj.setting,c)},getCheckedNodes:function(c){return this.treeObj.getCheckedNodes(c)},getChangeCheckedNodes:function(){return this.treeObj.getChangeCheckedNodes()},getSelectedNode:function(){return this.treeObj.getSelectedNodes()[0]},getSelectedNodes:function(){return this.treeObj.getSelectedNodes()},checkNode:function(e,d,f,c){return this.treeObj.checkNode(e,d,f,c)},getNodeByParam:function(d,e,c){return this.treeObj.getNodeByParam(d,e,c)},selectNode:function(d,c,e){return this.treeObj.selectNode(d,c,e)},cancelSelectedNode:function(c){return this.treeObj.cancelSelectedNode(c)},setChkBoxType:function(c){this.treeObj.setting.check.chkboxType=c},checkAllNodes:function(c){this.treeObj.checkAllNodes(c)},showNode:function(c){this.treeObj.showNode(c)},hideNode:function(c){this.treeObj.hideNode(c)},getNodesByFilter:function(c){return this.treeObj.getNodesByFilter(c)},expandNode:function(f,g,e,c,d){this.treeObj.expandNode(f,g,e,c,d)},getNodesByParam:function(d,e,c){return this.treeObj.getNodesByParam(d,e,c)},removeNode:function(d,c){this.treeObj.removeNode(d,c)},getNodeByTId:function(c){return this.treeObj.getNodeByTId(c)},moveNode:function(e,d,c,f){return this.treeObj.moveNode(e,d,c,f)}});a.fn.tree=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.tree.constructor=b;b.DEFAULTS={idField:"id",textField:"text",parentField:"parent",dataUrl:null,onClick:null,onBeforeClick:null,onDblClick:null,onContextMenu:null,onBeforeLoad:null,onLoadSuccess:null,onLoadError:null,async:false,showIcon:false,showLine:false,multiple:false,drag:false,fontCss:null,showAddBtn:null,showRemoveBtn:null,showRenameBtn:null,onRename:null,onBeforeRemove:null,onBeforeDrag:null,onDrag:null,onBeforeDrop:null,onDrop:null,onAdd:null,onRemove:null,onBtnInit:null,parentIconOpen:"icon-folder-open",parentIconClose:"icon-folder",leafIcon:"icon-file-o",onAddDiyDom:null}}(window.jQuery);!function(a){var b=a.fn.baseTag.constructor.extend({initTag:function(){this.parentPageproxy=this.opts.pageProxy;this.$stepsTitle=this.$elem.hasClass("ez-steps-dot")?this.$elem.children(".ez-steps-item"):this.$elem.children(".steps-nav").children(".step");this.$stepsBody=this.$elem.children(".steps-content");this.stepsCnt=this.options.steps.length;var c=this;if(this.options.onClick){this.$elem.children(".steps-nav").addClass("clickable");this.$stepsTitle.on("click",function(f){var d=a(this).index();c.exec(c.options.onClick,[d,c.options.steps[d]])})}if(this.$stepsBody.length>0){this.refresh(this.options.active)}},next:function(){var d=this.opts;var c=this.exec(d.onBeforeNext,[d.active]);if(c!==false){var e=d.active+1;this.step(e);this.exec(d.onNext,[e]);return e==this.stepsCnt-1}},last:function(){var d=this.opts;var c=this.exec(d.onBeforeLast,[d.active]);if(c!==false){var e=d.active-1;this.step(e);this.exec(d.onLast,[e]);return e==0}},step:function(e){e=parseInt(e);if(e<this.stepsCnt&&e>=0){var c=this;this.$stepsTitle.each(function(h){if(c.$elem.hasClass("ez-steps-dot")){a(this).removeClass("ez-steps-item-finish ez-steps-item-process ez-steps-item-active ez-steps-item-wait");var g="ez-steps-item-finish";if(h==e){g="ez-steps-item-process ez-steps-item-active"}else{if(h>e){g="ez-steps-item-wait"}}a(this).addClass(g)}else{a(this).removeClass("active done");var g="";var f=createTag("span").addClass("number");if(h<e){g="done";f.addClass(c.options.doneIconCls)}else{f.append(h+1);if(e==h){g="active"}}a(this).addClass(g).find(".number").replaceWith(f.toString())}});if(this.$stepsBody.length>0){this.$stepsBody.children(":eq("+this.opts.active+")").hide();var d=this.$stepsBody.children(":eq("+e+")").show();if(!d.data("loaded")||this.opts.alwaysLoad){this.refresh(e)}this.opts.pageProxy=this.opts.steps[e].pageProxy}this.opts.active=e;this.exec(this.opts.onStep,[e])}},getActiveStep:function(){return this.opts.active},refresh:function(d,c){if(typeof d==="undefined"){d=this.getActiveStep()}var e=this.opts.steps[d];if(e){c=a.isPlainObject(c)?c:{url:c||e.url};a.extend(e,{context:this,pageProxy:this.parentPageproxy},c);var f=this.$stepsBody.children(":eq("+d+")");a.pageProxy.util.loadContent(e,f);f.data("loaded",true)}}});a.fn.steps=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.steps.constructor=b;b.DEFAULTS={doneIconCls:"icon-check",active:0}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var f=this,d=this.options;d.triggers=d.trigger.split(" ");var e=d.triggers.contains("sticky");var c={placement:d.position,trigger:d.trigger,html:true,container:e?null:"body",template:sprintf('<div class="tooltip %s" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',d.type),title:d.title};this.$elem.bsTooltip(c);if(e){f.show()}},show:function(){this.$elem.bsTooltip("show");return this},hide:function(){this.$elem.bsTooltip("hide");return this},destroy:function(){this.$elem.bsTooltip("disable");this.$elem.bsTooltip("destroy");this.$elem.removeData("ez.tooltip");return this},setTitle:function(c){this.options.title=c;this.$elem.data("bs.tooltip").options.title=c;this.$elem.bsTooltip("setContent");return this},getTitle:function(){return this.options.title},setType:function(c){var d=this.$elem.bsTooltip("tip");if(this.options.type){d.removeClass(this.options.type)}this.options.type=c;d.addClass(c);return this}});b(document).on("click.tooltip",function(d){var c=d.target||d.srcElement;b(document).find("[aria-describedby]").each(function(){if(!b(this).is(c)&&b(this).data("ez.tooltip")){var e=b(this).tooltip("getOptions");if(e.triggers.contains("click")){b(this).tooltip("hide")}}})});b.fn.bsTooltip=b.fn.tooltip;b.fn.tooltip=function(d,g){var f=this;if(b(this).hasClass("tooltip-proxy")){var c=b(f).find("[data-toggle]");if(c.length){c.eq(0).data("tooltip",d);b(this).replaceWith(b(this).children());return}var e=b(f).children();if(e.length==0){return}f=e.eq(0)}return b.fn.baseTag.apply(f,[d,g,a,"ez.tooltip"])};b.fn.tooltip.constructor=a;a.DEFAULTS={type:"",position:"auto",trigger:"hover focus"}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){this.btnEvents=[];if(this.options.loadMore){this.$list=this.$elem.find(".list-container")}else{this.$list=this.$elem}var e=this;var c=this.$elem.find(".ez-template");if(c.length){this.itemTemplate=c.html().replaceAll(" _src="," src=").replace(/data-actions=\"(\w+)\"/i,function(g,f){e.buttonsRender=f;return""});c.remove()}if(this.options.url){this.load()}else{if(!this.$list.children().length){if(this.options.dataContext){this.options.items=b.getContextData(this.options.dataContext)}this.loadData(this.options.items)}}this.$list.on("click.list.btn","[data-fn-index]",function(h){var f=b(this).data("fnIndex");if(typeof f=="number"){f=e.btnEvents[f]}var g=b(this).closest(".list-item").index();e.exec(f,[e.options.items[g],g])});if(this.options.loadMore){var d=createTag("div").addClass("list-load-more").append(TagUtils.createButton({text:this.options.loadMoreBtnText,type:"primary",size:"xs",outline:true}));this.$listMore=b(d.toString()).appendTo(this.$elem);this.$listMore.find("button").on("click",function(){e.loadMore()})}},load:function(c){c=b.isPlainObject(c)?c:{url:c||this.options.url};b.extend(this.options,c);this.req({url:this.options.url,onLoading:function(){this.$list.html(b('<div class="panel-loading">加载中。。。</div>'));this.exec(this.options.onLoading)},onLoadSuccess:function(d){if(b.isArray(d)){this.loadData(d)}this.exec(this.options.onLoadSuccess,[d])}});return this},loadData:function(c){if(b.isArray(c)&&c.length){if(!this.buttonsHtml){this.btnEvents=[]}this.options.items=c;var e=createTag("");for(var d=0;d<c.length;d++){if(this.options.loadMore&&this.options.loadMoreCnt==d){this.$listMore.show();break}e.append(this.createItemTag(c[d],d))}this.$list.html(e.toString());b.parser.parse(this.options.pageProxy,this.$list)}else{this.$list.html(TagUtils.createEmpty().toString())}},loadMore:function(){this.$listMore.html("<i class='icon-spinner icon-spin icon-2x'></i>");var f=createTag(""),c=this.options.items;for(var d=this.options.loadMoreCnt;d<c.length;d++){f.append(this.createItemTag(c[d],d))}var e=this;setTimeout(function(){e.$listMore.hide();e.$list.append(f.toString())},1000)},addClickEvent:function(f){var e=null;if(f){var c=this.btnEvents.length;for(var d=0;d<c;d++){if(this.btnEvents[d].toString()==f.toString()){e=d;break}}if(e==null){e=c;this.btnEvents.push(f)}}return e},createItemTag:function(f,c){if(this.itemTemplate){if(this.buttonsRender){var e=this.exec(this.buttonsRender,[f,c]);if(b.isArray(e)){f.buttons=this.createItemButtonTag(e)}}var d=this.itemTemplate;var g=/\{\{([A-Za-z0-9\.]+)\}\}/img;d=d.replace(g,function(j,h){var m="";if(h&&f){m=f;var l=h.split(".");for(var k=0;k<l.length;k++){m=m[l[k]];if(typeof m==undefined){break}}}return m});return d}},createItemButtonTag:function(h){var d=[];for(var e=0;e<h.length;e++){var f=h[e];var c=null;var i=f.text;if(f.disabled){c=createTag("span").addClass("disabled").append(i)}else{var g=this.addClickEvent(f.onClick);f.data=b.extend({},f.data,{fnIndex:g});c=TagUtils.createHref({text:i,data:f.data,attrs:f.attrs})}d.push(c.toString())}return d.join("<i class='btn-linked-split'></i>")}});b.fn.list=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.list.constructor=a;a.DEFAULTS={escape:true,loadMore:false,loadMoreCnt:6,loadMoreBtnText:"加载更多"}}(window.jQuery);!function(b){var a=b.fn.baseInputTag.constructor.extend({initInputView:function(){b.fn.area.utils.getAreaData();this._super()},initInputViewEdit:function(){this.$select=this.$elem.find(".area-select");this.$selectValue=this.$select.find(".area-select-value");this.$dropdown=b(sprintf("<div class='area-select-dropdown'><div><ul class='nav nav-tabs'></ul><div class='tab-content'>%s</div></div></div>",this.createAreaTabTag(a.AREA_TREE,true)));this.$areaTitle=this.$dropdown.find("ul.nav");this.$areaContent=this.$dropdown.find(".tab-content");if(this.options.size){this.$dropdown.addClass("dropdown-"+this.options.size)}var c=this;this.$select.on("click",function(){var d=c.$select;var e=c.$dropdown;if(d.hasClass("open")){c.hideDropdownKeepFocus()}else{if(c.isDisabled()){return}if(!c.isReadonly()){c.showDropdown()}c.focus()}}).on("click.clear",".area-select-clear",function(d){if(c.isDisabled()||c.isReadonly()){return}c.clear();c.focus();d.stopPropagation()}).on("keydown",function(d){if(d.which==9){c.hideDropdown()}});b(document.body).on("mousedown.select."+this.options.tagId,function(h){var d=b(h.target),f=d.closest(".area-select"),g=b(".area-select");g.each(function(){if(this==f[0]){return}get(b(this).closest(".form-item")).hideDropdown()})});this.$dropdown.on("mousedown",function(d){d.stopPropagation()});this.$areaContent.on("click","li",function(g){var i=b(this).data("id");var f=a.AREA_MAP[i];var d=c.$areaTitle.find("li.active").index();if(c.options.selectLevel>d&&f.children){c.$areaTitle.find("li.active").removeClass("active").text(f.name);c.$areaTitle.append("<li class='active'>请选择</li>");c.$areaContent.find(".active").removeClass("active");c.$areaContent.append(c.createAreaTabTag(f.children,true));c.$dropdown.position({of:c.$select,my:"left top",at:"left bottom+4px"})}else{var h=b(this).parent().find(".active");if(!h.is(this)){c.$areaTitle.find("li:last").text(f.name);if(h.length){h.removeClass("active")}b(this).addClass("active");c.setValueWithoutView(c.trans2InpValue(i))}c.hideDropdownKeepFocus()}c.$select.focus()});this.$areaTitle.on("click","li:not(.active)",function(f){var d=b(this).index();b(this).addClass("active").text("请选择");c.$areaTitle.find("li:gt("+d+")").remove();c.$areaContent.find(".tab-pane:eq("+d+")").addClass("active");c.$areaContent.find(".tab-pane:gt("+d+")").remove();c.$select.focus();c.$dropdown.position({of:c.$select,my:"left top",at:"left bottom+4px"})});b(window).off("resize.select").on("resize.select",function(d){b(document.body).find(".area-select.open").each(function(){get(b(this)).hideDropdownKeepFocus()})})},createTag:function(){var c=createTag("div").addClass("area-select").addClass("readonly",this.options.readonly).addClass(this.options.cls).addClass("disabled",this.options.disabled).addClass(this.options.size,"input-").attr("tabindex",0).append("<span class='area-select-value'></span><span class='area-select-arrow'><b></b></span>");this.$elem.append(c.toString())},createAreaTabTag:function(d,h,e){var c=createTag("ul").addClass("area clearfix");for(var f=0;f<d.length;f++){var g=d[f];createTag("li").attr("data-id",g.id).attr("title",g.name).addClass("active",h&&g.id==e).append(g.name).appendTo(c)}return sprintf("<div class='tab-pane ui-page%s'>%s</div>",h?" active":"",c.toString())},trans2InpValue:function(e){e=typeof e=="number"?(e+""):e;if(e){var d=[];var c=e.substring(0,2)+"0000";if(c!=e&&c in a.AREA_MAP){d.push(c)}var f=e.substring(0,4)+"00";if(f!=e&&f in a.AREA_MAP){d.push(f)}d.push(e);e=d}else{e=[]}return this._super(e)},setInputValue:function(h){this.$areaContent.find(".tab-pane:gt(0)").remove();this.$areaContent.find(".tab-pane").removeClass("active");var g=null;if(h.length){g=createTag("");var f=createTag("");for(var d=0;d<h.length;d++){var e=a.AREA_MAP[h[d]];if(e){var c=e.name;createTag("li").addClass("active",d==h.length-1).append(c).appendTo(g);if(e.children){f.append(this.createAreaTabTag(e.children,d==h.length-2,h[d+1]))}else{if(d==0){f.append(this.createAreaTabTag(a.AREA_TREE,true,h[d]))}}}else{createTag("li").addClass("active").append("请选择").appendTo(g);if(d==0){this.$areaContent.find(".tab-pane").addClass("active")}break}}this.$areaContent.append(f.toString())}else{this.$areaContent.find(".tab-pane").addClass("active");g=createTag("li").addClass("active").append("请选择")}this.setSelectText();this.$areaTitle.html(g.toString())},setViewValue:function(c){if(this.isPureText()){c=this.getText()}this._super(c)},getText:function(){var f=null;if(this.opts.value){var e=[];for(var c=0;c<this.opts.value.length;c++){var d=this.opts.value[c];if(a.AREA_MAP[d]){e.push(a.AREA_MAP[d].name)}}f=e.join(" - ")}return f},setValueWithoutView:function(c){this._super(c);this.setSelectText()},setSelectText:function(){var d=this.getText();var c=this.$selectValue.next(".area-select-clear");if(d){this.$selectValue.attr("title",d).html(d);if(!c.length){this.$selectValue.after("<span class='area-select-clear'>&times</span>")}}else{this.$selectValue.attr("title","").html(sprintf("<span class='area-select-placeholder'>%s</span>",this.options.placeholder));c.remove()}},showDropdown:function(){var c=this.$select,e=this.$dropdown;if(e.is(":hidden")){e.appendTo(b(document.body))}c.addClass("open");e.css("width",c[0].getBoundingClientRect().width+"px");e.show();e.position({of:c,my:"left top",at:"left bottom+4px"});var d=this;TagUtils.bindScrollEvent(c,"area-select",function(){d.hideDropdownKeepFocus()})},hideDropdown:function(){this.$select.removeClass("open area-select-focus");this.$dropdown.detach()},hideDropdownKeepFocus:function(){this.$select.removeClass("open");this.$dropdown.detach()},focus:function(){this.$select.addClass("area-select-focus").focus();return this},getValue:function(){var c=this.getTypeValue();return c.length>0?c[c.length-1]:null},_readonly:function(c){this.$select.toggleClass("readonly",c)},_disable:function(c){this.$select.toggleClass("disabled",c)},isChange:function(d,c){d=d.length>0?d[d.length-1]:null;c=c.length>0?c[c.length-1]:null;return this._super(d,c)},change:function(d,c){d=d&&d.length>0?d[d.length-1]:null;c=c&&c.length>0?c[c.length-1]:null;this._super(d,c)}});a.DEFAULTS=b.extend({},b.fn.baseInputTag.constructor.DEFAULTS,{placeholder:"请选择所在地区",disableCity:false,disableDistrict:false});b.fn.area=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.area.utils={getAreaData:function(){var h=a.AREA_MAP;if(typeof h=="undefined"){var c=b.req("sysCommon/getArea",false);h={};var g=[];for(var d=0;d<c.length;d++){var f=c[d];h[f.id]=f}for(var d=0;d<c.length;d++){var f=c[d];if(f.parent=="0"){g.push(f)}else{var e=h[f.parent];if(e){if(!e.children){e.children=[]}e.children.push(f)}}}a.AREA_MAP=h;a.AREA_TREE=g}return h}};b.fn.area.constructor=a}(window.jQuery);!function(e){var c=e.fn.baseTag.constructor.extend({initTag:function(){var f=this.options;this.chart=echarts.init(this.elem,"ez-echarts");var g=this.getChartOptions();this.setChartOptions(g);if(f.url){this.load(f.url)}else{if(this.options.dataContext){e.getContextData({key:this.options.dataContext,async:true,onLoading:function(){this.chart.showLoading()},onLoadSuccess:function(h){this.chart.hideLoading();this.loadData(h)}})}}e(window).off("resize.chart").on("resize.chart",function(){e(document.body).find(".ez-chart").each(function(){get(this).resize()})})},getChartOptions:function(){var f=this.options;var m={};if(f.title){var j={text:f.title,subtext:f.subTitle,x:f.titleAlign};m.title=j}if(f.showTooltip){m.tooltip={}}var h=[{type:f.toggle.replace("Chart",""),valueField:"value"}];m.series=h;if(typeof f.showLegend=="undefined"){f.showLegend=h.length>1}if(f.showLegend){m.legend={}}this.exec(f.onInitOptions,[h,m]);this.initChartOptions(h,m);var l=[f.categoryField];for(var g=0;g<h.length;g++){var k=h[g];l.push(k.valueField)}this.dimensions=l;return m},initChartOptions:function(){},load:function(f){f=e.isPlainObject(f)?f:{url:f||this.options.url};e.extend(this.options,f);this.req({url:this.options.url,onLoading:function(){this.chart.showLoading()},onLoadSuccess:function(g){this.chart.hideLoading();this.loadData(g);this.exec(this.options.onLoadSuccess,[g])}});return this},loadData:function(f){if(this.options.dataHandler){this.exec(this.options.dataHandler,[f])}else{this.setChartOptions({dataset:{dimensions:this.dimensions,source:f}})}return this},resize:function(){this.chart.resize()},setChartOptions:function(f){this.chart.setOption(f)}});c.DEFAULTS={categoryField:"name",showTooltip:true};var a=c.extend({initChartOptions:function(g,h){for(var f=0;f<g.length;f++){if(!g[f].name){g[f].name="值"}}h.xAxis={type:"category",axisTick:{alignWithLabel:true}};h.yAxis={type:"value"};h.tooltip=e.extend({},h.tooltip,{trigger:"axis",axisPointer:{type:"shadow"}})}});e.fn.lineChart=function(f,g){return e.fn.baseTag.apply(this,[f,g,a])};a.DEFAULTS=e.extend({},c.DEFAULTS,{});var d=a.extend({});e.fn.barChart=function(f,g){return e.fn.baseTag.apply(this,[f,g,d])};d.DEFAULTS=e.extend({},a.DEFAULTS,{});var b=c.extend({initChartOptions:function(h,k){var f=this.options;for(var g=0;g<h.length;g++){var j=h[g];j.encode={itemName:f.categoryField,value:j.valueField};if(!f.showLabel){j.label={normal:{show:false}}}}}});e.fn.pieChart=function(f,g){return e.fn.baseTag.apply(this,[f,g,b])};b.DEFAULTS=e.extend({},c.DEFAULTS,{showLabel:true})}(window.jQuery);!function(a){var b=a.fn.baseTag.constructor.extend({initTag:function(){var c=this;if(this.options.onSlide){this.$elem.on("slide.bs.carousel",function(d){c.exec(c.options.onSlide,[d])})}},cycle:function(){this.$elem.bsCarousel("cycle")},pause:function(c){this.$elem.bsCarousel("pause")},prev:function(){this.$elem.bsCarousel("prev")},next:function(c){this.$elem.bsCarousel("next")},slideTo:function(c){if(typeof c=="number"){this.$elem.bsCarousel(c)}},toggle:function(c){this.$elem.toggle(c);return this}});a.fn.bsCarousel=a.fn.carousel;a.fn.carousel=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.carousel.constructor=b;b.DEFAULTS={}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var e=this;var d=this.options;if(!this.$elem.hasClass("dropdown")){this.$elem.addClass("dropdown")}this.$target=this.$elem.children().eq(0);var c=createTag("ul").addClass("dropdown-menu").data("index",0);if(d.position=="bottomRight"){c.addClass("dropdown-menu-right")}this.$menu=b(c.toString());var f=this.$elem;if(d.menuContainer){f=b(d.menuContainer)}this.$menu.appendTo(f);if(this.options.url){this.load()}else{if(this.opts.dataContext){this.options.items=b.getContextData(this.options.dataContext)}if(d.items){this.loadData(d.items)}}if(this.$target.data("toggle")=="button"&&!this.$target.find(".icon-caret-down").length){this.$target.append(TagUtils.createIcon("icon-caret-down").toString())}},getItems:function(){return this.options.items},load:function(c){c=b.isPlainObject(c)?c:{url:c||this.opts.url};b.extend(this.opts,c);var d=this;this.req({url:this.opts.url,onLoadSuccess:function(e){this.loadData(e);this.exec(this.opts.onLoadSuccess,[e])}});return this},loadData:function(d){function c(h,n,j){var m=null;if(n){m=createTag("ul").addClass("dropdown-menu").data("index",e).appendTo(f);g._menus[e]={parent:j,items:h};j=e++}else{m=createTag("")}var l=g.options.itemRender;for(var k=0;k<h.length;k++){var p=h[k];if(p.itemRender){l=p.itemRender}var o=createTag("li").attr("id",p[g.options.idField]).addClass(p.cls).appendTo(m);if(p.active){o.addClass("active")}if(p.divider){o.addClass("divider")}else{if(l){o.append(g.exec(l,[p,k]))}else{if(p.disabled){o.addClass("disabled");createTag("span").append(p.title).appendTo(o)}else{TagUtils.createHref({text:p[g.options.textField],url:p.url,target:p.target,iconCls:p.iconCls}).appendTo(o)}if(g.options.childrenField&&p[g.options.childrenField]&&p[g.options.childrenField].length){o.addClass("dropdown-menu-sub").data("index",e);TagUtils.createIcon({icon:"icon-angle-right",cls:"menu-sub-arrow"}).appendTo(o);c(p[g.options.childrenField],true,j)}}}}return m}var g=this;this._menus={0:{parent:null,menu:this.$menu,items:d}};var e=1;var f=createTag("");this.options.items=d;this.$menu.html(c(d,false,0).toString());this.$submenu=b(f.toString()).appendTo(b(document.body));this.$submenu.each(function(){var i=b(this).data("index");if(g._menus[i]){g._menus[i].menu=b(this);var h=g._menus[i].parent;g._menus[h].childMenu=g._menus[h].childMenu?g._menus[h].childMenu.add(b(this)):b(this)}});this.initTriggerEvent()},on:function(d,e){var c="on"+d.charAt(0).toUpperCase()+d.slice(1);this.options[c]=e;return this},showDropdownMenu:function(){if(this.options.menuContainer){this.$menu.css({top:0,left:0,display:"none"});this.$menu.position({of:this.$elem,my:"left top",at:"left bottom+4px"}).show();var c=this;TagUtils.bindScrollEvent(this.$elem,"dropdown"+c.options.tagId,function(){c.hideDropdownMenu()})}if(this.$target.data("toggle")=="button"){this.$menu.css("min-width",this.$target.outerWidth())}this.$elem.addClass("open");return this},hideDropdownMenu:function(){if(this.options.menuContainer){this.$menu.hide();TagUtils.unbindScrollEvent(this.$elem,"dropdown"+this.options.tagId)}this.$elem.removeClass("open");return this},unselect:function(){this.$menu.find(".active").removeClass("active");return this},select:function(c){var d=this.$menu.find("[id='"+c+"']");if(!d.hasClass("divider")&&!d.hasClass("disabled")){var e=this.$menu.find("li.active");e.removeClass("active");d.addClass("active")}return this},initTriggerEvent:function(){this.showMenu=b();this.closeMenu=b();var f=this;var d=this.options;var e=d.trigger.split(",");if(e.contains("hover")){var g;this.$elem.hover(function(i){clearTimeout(g);f.showDropdownMenu()},function(i){if(g){clearTimeout(g)}g=setTimeout(function(){f.hideDropdownMenu()},100)});if(d.menuContainer){this.$menu.hover(function(i){clearTimeout(g)},function(){if(g){clearTimeout(g)}g=setTimeout(function(){f.hideDropdownMenu()},100)})}if(this.$submenu.length){var c=null;this.$hideSubMenu=b("");this.$submenu.add(this.$menu).find("li.dropdown-menu-sub:not(.disabled, .divider)").hover(function(){var j=b(this).data("index");var i=b(this);setTimeout(function(){f._menus[j].menu.css({top:0,left:0,display:"none"}).position({of:i,my:"left top",at:"right+4px top-4px"}).show()},100)},function(m){var l=b(this).data("index");var k=f._menus[l].parent;var j=false;if(m.relatedTarget){j=f._menus[k].menu.find(b(m.relatedTarget)).length>0}f.$hideSubMenu=f.$hideSubMenu.add(f._menus[l].menu);var i=b("");while(f._menus[k].parent!=null){i=i.add(f._menus[k].menu);k=f._menus[k].parent}if(j){f.$hideSubMenu=f.$hideSubMenu.not(i);c=setTimeout(function(){f.$hideSubMenu.hide();f.$hideSubMenu=f.$hideSubMenu.not(f._menus[l].menu)},100)}else{f.$hideSubMenu=f.$hideSubMenu.add(i);c=setTimeout(function(){f.$hideSubMenu.hide();f.$hideSubMenu=f.$hideSubMenu.not(i.add(f._menus[l].menu))},100)}});var h=this.$menu;this.$submenu.hover(function(k){clearTimeout(g);clearTimeout(c);var j=h.data("index");var i=f._menus[j].parent;if(i!=null&&f._menus[i].menu.is(b(this))){if(b(k.target).closest("li").data("index")!=j){h.hide()}}},function(i){h=b(this);clearTimeout(c);c=setTimeout(function(){f.$hideSubMenu.add(h).hide()},100);g=setTimeout(function(){f.hideDropdownMenu()},100)})}}if(e.contains("click")){this.$elem.on("click",function(i){if(b(this).hasClass("disabled")||b(i.target).closest("li.disabled").length){return false}if(f.$elem.hasClass("open")){f.$submenu.hide();f.hideDropdownMenu()}else{f.showDropdownMenu()}return true});b(document).off("click.dropdown."+d.tagId).on("click.dropdown."+d.tagId,function(i){if(!(b(i.target).closest(f.$elem).length||f.$submenu.add(f.$menu).is(b(i.target).closest("ul.dropdown-menu")))){f.$submenu.filter(":visible").hide();f.hideDropdownMenu()}});if(this.$submenu.length){this.$submenu.add(this.$menu).find(".dropdown-menu-sub").on("click",function(l){l.stopPropagation();if(b(this).hasClass("disabled")){return false}var k=b(this).data("index");var i=b("");var j=f._menus[k].parent;while(f._menus[j].parent!=null){i=i.add(f._menus[j].menu);j=f._menus[j].parent}if(!f._menus[k].menu.is(":visible")){f.$submenu.not(i).filter(":visible").hide();f._menus[k].menu.css({top:0,left:0,display:"none"}).position({of:b(this),my:"left top",at:"right+4px top-4px"}).show()}})}if(d.menuContainer||this.$submenu.length){b(window).off("resize.dropdown").on("resize.dropdown",function(i){b(document.body).find(".dropdown.open").each(function(){var j=get(b(this));if(j.options.menuContainer){j.hideDropdownMenu()}if(j.$submenu.length){j.$submenu.filter(":visible").hide()}})})}}this.$menu.add(this.$submenu).off("click").on("click","li:not(.disabled, .divider, .dropdown-menu-sub)",function(k){k.stopPropagation();if(d.selectable){f.$menu.add(f.$submenu).find("li.active").removeClass("active");b(this).addClass("active")}f.$submenu.filter(":visible").hide();f.hideDropdownMenu();var i=b(this).closest("ul.dropdown-menu").data("index");var j=f._menus[i].items[b(this).index()];var l=j.onClick||d.onClick;return f.exec(l,[j])})}});b.fn.bsDropdown=b.fn.dropdown;b.fn.dropdown=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.dropdown.constructor=a;a.DEFAULTS={trigger:"hover",idField:"id",textField:"title",parentField:"parent",childrenField:null,onClick:null,url:null,itemRender:null,onLoadSuccess:null,menuContainer:null,selectable:null,position:"bottomLeft"}}(window.jQuery);!function(b){var a=b.fn.tooltip.constructor.extend({initTag:function(){var f=this,d=this.options;d.triggers=d.trigger.split(" ");var e=d.triggers.contains("sticky");var c={placement:d.position,trigger:d.trigger,html:true,container:e?null:"body",content:d.content,title:d.title};this.$elem.bsPopover(c);if(e){f.show()}},show:function(){this.$elem.bsPopover("show")},hide:function(){this.$elem.bsPopover("hide")},destroy:function(){this.$elem.bsPopover("destroy");this.$elem.removeData("ez.popover")},setTitle:function(c){this.options.title=c;this.$elem.data("bs.popover").options.title=c;this.$elem.bsPopover("setContent")},setContent:function(c){this.options.content=c;this.$elem.data("bs.popover").options.content=c;this.$elem.bsPopover("setContent")},});b.fn.bsPopover=b.fn.popover;b.fn.popover=function(e,h){var g=this;if(b(g).hasClass("popover-proxy")){var d=b(g).find(".popover-content");e.content=d;d.detach();var c=b(g).find("[data-toggle]");if(c.length){c.eq(0).data("popover",e);b(this).replaceWith(b(this).children());return}var f=b(g).children();if(f.length==0){return}g=f.eq(0).attr("data-toggle","popover")}return b.fn.baseTag.apply(g,[e,h,a,"ez.popover"])};b.fn.popover.constructor=a;a.DEFAULTS={type:"default",position:"auto",trigger:"hover focus"}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var g=this;var d=this.options;var f=get(g.$elem.closest("form"));if(d.onQuery){this.$elem.find("button.query-btn").on("click",function(h){return g.exec(d.onQuery)})}this.$elem.find("button.clear-btn").on("click",function(h){if(d.onReset){return g.exec(d.onReset)}else{if(f){get(f).reset();g.exec(d.onQuery)}}});if(d.moreBtn){var e=this.$elem.next();var c=e.children();var f=g.$elem.closest("form");this.$elem.find(".more-btn").on("click",function(){if(!b(this).hasClass("expand")){b(this).addClass("expand");b(this).find("i").removeClass("icon-angle-down-l");b(this).find("i").addClass("icon-angle-up-l");if(d.isInline){e.show()}else{c.insertBefore(g.$elem);g.$elem.css("text-align",d.expandAlign);if(d.span!=d.expandSpan){g.$elem.removeClass("col-xs-"+d.span).addClass("col-xs-"+d.expandSpan)}}}else{b(this).removeClass("expand");b(this).find("i").removeClass("icon-angle-up-l");b(this).find("i").addClass("icon-angle-down-l");if(d.isInline){e.hide()}else{c.appendTo(e);g.$elem.css("text-align",d.align);if(d.span!=d.expandSpan){g.$elem.removeClass("col-xs-"+d.expandSpan).addClass("col-xs-"+d.span)}}}})}}});b.fn.queryBtns=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.queryBtns.constructor=a;a.DEFAULTS={moreBtn:false,span:4,expandSpan:4,align:"left",expandAlign:"right"};b.progress={status:-100,init:function(){var f=b(".progress-bar");if(f.length==0){var c=createTag("div").addClass("progress-container");var d=createTag("div").addClass("progress-bar").appendTo(c);createTag("div").addClass("progress-peg").appendTo(d);var e=createTag("div").addClass("progress-spinner").appendTo(c);createTag("i").addClass("icon-spin").addClass("icon-spinner").appendTo(e);b("body").append(c.toString());f=b(".progress-bar");this.status=-100}f.css("transition","all 0 linear").css("transform","translate3d("+this.status+"%, 0px, 0px)")},set:function(c){this.status=c},start:function(){this.init();var c=function(){setTimeout(function(){if(!b.progress.status){b(".progress-container").remove();return}var e=b(".progress-bar");var f=b.progress.status;var d=b.progress.clamp(Math.random(),0.1,1);f=b.progress.clamp(f+d,-100,-1);e.css("transform","translate3d("+f+"%, 0px, 0px)");e.css("opacity","1");e.css("transition","all 0.2s ease 0s");if(b.progress.status>-1){b.progress.status=null}else{b.progress.status=f}c()},200)};c()},done:function(){this.set(1)},clamp:function(e,d,c){if(e<d){return d}if(e>c){return c}return e}}}(window.jQuery);!function(a){var b=a.fn.baseInputTag.constructor.extend({initInputViewEdit:function(){this.$select=this.$elem.find(".input-group-btn select");this.$input=this.$elem.find("input.form-control");var c=this;var d=c.options.splitChar;this.$input.on("change",function(f){var g=a(this).val().trim();g=c.$select.val()+d+g;c.setValue(g)});this.$select.on("change",function(){var e=c.$input.val().trim();var f=a(this).val();f=f+d+e;c.setValue(f)})},trans2InpValue:function(e){if(e!=null&&typeof e!="string"){e+=""}if(e){var g=this.options.splitChar;var c=e.split(g);if(c.length==1){e="86"+g+e}else{if(c.length==2){if(c[1]==""){e=null}}else{var f=c.shift();var d=c.join("");e=f+g+d}}}return e},getInput:function(){return this.$input},_extraValidate:function(e){if(e!=null){var d=e.split(this.options.splitChar);var c=null;if(d[0]=="86"){c=StringUtils.validate(d[1],"phone")}else{c=StringUtils.validate(d[1],"number");if(c.isValid){c=StringUtils.validate(e,"length[20]")}}if(!c.isValid){return c.msg}}return true},setInputValue:function(d){if(d){var c=d.split(this.options.splitChar);if(c.length==2){this.$select.val(c[0]);this.$input.val(c[1])}}else{this.$input.val("")}},setTextValue:function(d){var c=d.split(this.options.splitChar);this._super((this.options.data[c[0]]||c[0])+this.options.splitChar+c[1])},getTooltipTarget:function(){return this.$input},_disable:function(c){this.getInput().prop("disabled",c);this.$select.prop("disabled",c)},_readonly:function(c){this.getInput().prop("readonly",c);this.$select.prop("disabled",c)},validate:function(c,d){return this._super("auto bottom",d)}});a.fn.intlTelInput=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.intlTelInput.constructor=b;b.DEFAULTS=a.extend({},a.fn.baseInputTag.constructor.DEFAULTS,{countryDict:null,splitChar:" "})}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var d=this.$elem.find(".ez-template");if(d.length){this.itemTemplate=d.html().replaceAll(" _src="," src=");d.remove()}if(this.options.url){this.load()}else{if(this.options.dataContext){var c=b.getContextData(this.opts.dataContext);if(c.length){this.loadData(c)}}}},load:function(c){c=b.isPlainObject(c)?c:{url:c||this.opts.url};b.extend(this.opts,c);var d=this;this.req({url:this.opts.url,onLoadSuccess:function(e){this.loadData(e)}})},loadData:function(f){if(b.isArray(f)){this.options.datas=f;var j=createTag("");var g=0;var c=false;for(var e=0;e<f.length;e++){var d=f[e];var m=createTag("li").addClass("ez-timeline-item").appendTo(j);if(d.period){m.addClass("ez-timeline-item-period").append(d.content);g=0}else{var h=d.text;if(this.itemTemplate){h=this.itemTemplate;var l=/\{\{([A-Za-z0-9\.]+)\}\}/img;h=h.replace(l,function(o,n){var r=null;if(n&&d){r=d;var q=n.split(".");for(var p=0;p<q.length;p++){r=r[q[p]];if(typeof r==undefined){break}}}return r})}if(this.options.itemRender){h=this.exec(this.options.itemRender,[d])}m.addClass(d.type);if(this.options.mode=="alternate"){if(g++%2==0){m.addClass("ez-timeline-item-right")}else{m.addClass("ez-timeline-item-left")}}createTag("div").addClass("ez-timeline-item-tail").appendTo(m);var k=createTag("div").addClass("ez-timeline-item-head").appendTo(m);if(d.icon){c=true;k.addClass("ez-timeline-item-head-custom");TagUtils.createIcon("icon-"+d.icon).appendTo(k)}createTag("div").addClass("ez-timeline-item-content").append(h).appendTo(m)}}this.$elem.html(j.toString());if(c){this.$elem.addClass("ez-timeline-icon");if(this.options.iconSize){this.$elem.addClass("ez-timeline-icon-"+this.options.iconSize)}}b.parser.parse(this.options.pageProxy,this.$elem)}}});b.fn.timeline=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.timeline.constructor=a;a.DEFAULTS={url:null,dataContext:null,mode:"left",iconSize:"x",itemRender:null}}(window.jQuery);!function(b){var a=b.fn.baseSelectTag.constructor.extend({initInputViewEdit:function(){var j=this,o=this.options;this.$select=this.getInput();var c='<div style="display: flex;margin: 12px 0 0;"><div class="form-item search-input" style="flex: 1 1 auto;"><div class="has-feedback input-wrapper"><input class="form-control" type="text" autocomplete="off" placeholder="请输入名称搜索"><span class="form-control-feedback icon-search"></span></div></div><div class="tree-operate-btn" style="flex: auto;"><button class="btn expand-btn btn-link" type="button">展开/折叠</button></div></div>';this.$dropdown=b("<div class='tree-select-dropdown'>"+c+"<div class='tree-container'><div></div>");this.$dropdown.append(TagUtils.createEmpty().css("display","none").toString());this.$tree=this.$dropdown.find(".tree-container");this.expandFlag=this.options.expandAll;this.$dropdown.find("input").on("input",function(){var i=b(this).val();if(!i){i=""}var e=get(j.$tree);var p=e.getNodesByFilter(function(q){if(i.length==0){e.showNode(q);return true}var r=q[o.textField];if(r&&r.toLowerCase().indexOf(i.toLowerCase())!=-1){e.showNode(q);return true}if(q.tag&&q.tag.indexOf(i)!=-1){e.showNode(q);return true}e.hideNode(q);return false});if(p&&p.length>0){j.$dropdown.find(".ez-empty").hide();if(i.length>0){b.each(p,function(t,s){var r=s.getPath();if(r&&r.length>0){for(var q=0;q<r.length-1;q++){e.showNode(r[q])}}})}}else{j.$dropdown.find(".ez-empty").show()}});this.isExpand=false;this.$dropdown.find(".btn").on("click",function(){j.isExpand=!j.isExpand;get(j.$tree).expandAll(j.isExpand)});var m=undefined;var g=function(e){return j.exec(o.onBeforeClick,[e])};var n=undefined;var d=undefined;if(o.multiple){m=function(e){get(j.$tree).checkNode(e,undefined,false,true)};n=function(s){var r=s.checked;var e=get(j.$tree).getCheckedNodes(r);var p=j.getValues().slice();for(var q=0;q<e.length;q++){var t=e[q][o.idField];if(r){if(!p.contains(t)){p.push(t)}}else{p.remove(t)}}j.setValue(p.join(","));j.$dropdown.position({of:j.$select,my:"left top",at:"left bottom+4px"});if(r){if(o.onSelect){j.exec(o.onSelect,[s])}}else{if(o.onUnselect){j.exec(o.onUnselect,[s])}}};if(o.chkboxType){try{var h=o.chkboxType.split(",");d={};for(var f=0;f<h.length;f++){var l=h[f].split(":");d[l[0]]=l[1]}}catch(k){console.error("ChkBoxType设置不正确");console.error(k)}}}else{m=function(e){j.setValue(e[o.idField]);j.hideDropdownKeepFocus();j.$select.focus();j.exec(o.onSelect,[e]);return j.exec(o.onClick,[e])}}this.$select.on("click.dropdown",function(){var q=j.$select;var u=j.$dropdown;if(q.hasClass("open")){j.hideDropdownKeepFocus()}else{if(j.isDisabled()||j.isReadonly()){return}j.showDropDown();j.focus();TagUtils.bindScrollEvent(j.$select,"tree-select",function(){j.hideDropdownKeepFocus()});if(j.isInitDropdown){if(o.datas.length){var e=get(j.$tree);var s=!e;if(s){var v=b.extend({},{tagId:o.tagId,toggle:"tree",idField:o.idField,multiple:o.multiple,parentField:o.parentField,textField:o.textField,onBeforeClick:g,onClick:m,onCheck:n,chkboxType:d});j.$tree.html(j.createTree(v).toString());j.$tree.tree(v);e=get(j.$tree)}e.loadData(o.datas);if(s&&j.expandFlag){j.expandAll(true)}j.isInitDropdown=false;j.$dropdown.find(".ez-empty").hide()}else{if(j.isLoading){j.$tree.html(TagUtils.createEmpty({icon:"spinner icon-spin",description:"数据加载中..."}).toString())}else{j.$dropdown.find(".ez-empty").show()}}}if(u.find(".ztree").length){var e=get(j.$tree);if(o.multiple){e.checkAllNodes(false);var p=j.getValues();for(var r=0;r<p.length;r++){var t=e.getNodeByParam(o.idField,p[r]);if(t){e.checkNode(t,true,false,false)}}}else{e.cancelSelectedNode();var p=j.getValues();for(var r=0;r<p.length;r++){var t=e.getNodeByParam(o.idField,p[r]);if(t){e.selectNode(t,true)}}b(this).focus()}}}}).on("click.removeChoice",".tree-select-choice_remove",function(){if(j.isDisabled()||j.isReadonly()){return}var q=b(this).parent();var r=q.data("id");var i=j.getValues();i.remove(r);j.setValueWithoutView(i);if(!i.length){j.$select.find(".tree-select-placeholder").show()}q.remove();j.hideDropdown();if(o.onUnselect){var e=get(j.$tree);var p=e.getNodeByParam(o.idField,r);j.exec(o.onUnselect,[p])}return false}).on("keydown",function(i){if(i.which==9){j.hideDropdown()}});if(!o.multiple){this.$select.find(".tree-select-clear").on("click",function(i){if(j.isDisabled()||j.isReadonly()){return}j.clear();j.focus();j.validate();i.stopPropagation()})}this.$dropdown.on("mousedown",function(i){j.$select.focus();i.stopPropagation()});b(document.body).on("mousedown.select"+this.options.tagId,function(r){var i=b(r.target),p=i.closest(".tree-select"),q=b(".tree-select");q.each(function(){if(this==p[0]){return}get(b(this).closest(".ui-input")).hideDropdown()})})},createTree:function(d){var c=createTag("ul").attr("id",d.tagId).addClass("ztree").append(TagUtils.createEmpty({icon:"spinner icon-spin",description:"数据加载中..."}));return c},change:function(d,c){if(!this.options.multiple&&this.options.onUnselect){if(this.getValue()==null){var e=this._getOption(c.join(","));this.exec(this.options.onUnselect,[e])}}this._super(d,c)},showDropDown:function(){var c=this.$select,e=this.$dropdown;c.addClass("open");e.appendTo(b(document.body));e.show();e.position({of:c,my:"left top",at:"left bottom+4px",});var d=c[0].getBoundingClientRect().width;if(d<this.options.dropdownMinWidth){d=this.options.dropdownMinWidth}if(this.options.dropdownMaxWidth&&d>this.options.dropdownMaxWidth){d=this.options.dropdownMaxWidth}e.css("width",d);e.css("maxHeight","50%")},hideDropdown:function(){this.$select.removeClass("open tree-select-focus");this.$dropdown.detach()},hideDropdownKeepFocus:function(){this.$select.removeClass("open");this.$dropdown.detach()},focus:function(){this._super();this.$select.addClass("tree-select-focus");return this},setInputValue:function(j){var h=this.$select.find(".tree-select-placeholder");var c=j.length==0;if(c){h.show()}else{h.hide()}var m=null;var g=this.dataMap;if(this.options.multiple){if(!c){var k=createTag("");for(var e=0;e<j.length;e++){var d=j[e];var l=createTag("li").attr("data-id",d).append(g[d]).appendTo(k);createTag("span").addClass("tree-select-choice_remove").append("&times").appendTo(l)}m=k.toString()}}else{var f=this.$select.find(".tree-select-clear");if(!c){m=g[j];f.show()}else{f.hide()}}this.$select.find(".tree-select-text").html(m)},load:function(c){this.isInitDropdown=true;c=b.isPlainObject(c)?c:{url:c||this.opts.dataUrl};c.dataUrl=c.url;delete c.url;b.extend(this.opts,c);var d=this;this.req({url:this.opts.dataUrl,onLoading:function(){d.isLoading=true},onLoadSuccess:function(e){d.isLoading=false;this.loadData(e);if(this.options.selectFirst&&this.getValue()==null){this.initValue(null)}this.exec(this.opts.onLoadSuccess,[e])}});return this},loadData:function(c){this.isInitDropdown=true;if(b.isArray(c)){var d=this.opts;if(d.filterFn){c=this.exec(d.filterFn,[c])}this.options.datas=c;this.dataMap={};this.loadAllDataMap(c);this.setViewValue(this.getValues())}},loadAllDataMap:function(d){var c=d.length,f=this.opts.idField,e=this.opts.textField;for(var g=0;g<c;g++){var h=d[g],k=h[f],j=h[e];this.dataMap[k]=j;if(d[g].children){this.loadAllDataMap(d[g].children)}}},_readonly:function(c){this.$select.toggleClass("readonly",c);this.opts.disabled=c;this.hideDropdownKeepFocus()},_disable:function(c){this.$select.toggleClass("disabled",c);this.opts.disabled=c;this.hideDropdownKeepFocus()},setCascadeReadonly:function(c){if(!this.isPureText()){this.options.cascadeReadonly=c;if(!this.options.readonly){this._disable(c)}}},expandAll:function(d){this.expandFlag=d;var c=get(this.$tree);if(c){c.expandAll(d)}}});b.fn.treeSelect=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.treeSelect.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseSelectTag.constructor.DEFAULTS,{idField:"id",valueField:"id",parentField:"parent",textField:"text",multiple:false,dataUrl:null,dataContext:null,treeData:true,onClick:null,dropdownMinWidth:240,dropdownMaxWidth:null,onBeforeClick:null})}(window.jQuery);!function(b){var a=b.fn.textInput.constructor.extend({initInputViewEdit:function(){this._super();if(!this.opts.publicKey){throw new Error("密码组件初始化需要公钥，请确定request是否设置公钥且通过属性publicKeyContextAttrName指定")}this.$elem.removeAttr("data-public-key");var c=this;this.$input.off("change").on("change",function(d){var f=b(this).val();f=f==""?null:f.trim();f=c.trans2InpValue(f);c.setValueWithoutView(f)});this.$elem.find(".form-control-feedback").addClass("clickable").off("click.iconClick").on("click.iconClick",function(f){var d=c.$input.attr("type")==="text";if(d){c.$input.attr("type","password");b(this).removeClass("icon-eye").addClass("icon-eye-slash")}else{c.$input.attr("type","text");b(this).removeClass("icon-eye-slash").addClass("icon-eye")}})},trans2InpValue:function(c){if(c){if(this.options.algorithm=="SM2"){c=Sm2Utils.encrypt(c,this.opts.publicKey)}else{c=RsaUtils.encode(c,this.opts.publicKey)}}return this._super(c)},_extraValidate:function(d){if(d!=null){d=this.getInput().val();var c={isValid:true};if(!this.options.cancelPasswordValidate){c=StringUtils.validate(d,this.options.validateType)}if(c.isValid){return this._super(d)}else{return c.msg}}return true},isWeekPassword:function(){var c=this.$input.val();return !c||!StringUtils.validate(c,this.options.validateType).isValid},getInputValue:function(){return this.getInput().val()}});b.fn.password=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.password.constructor=a;a.DEFAULTS=b.extend({},b.fn.textInput.constructor.DEFAULTS,{publicKey:null,cancelPasswordValidate:false})}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var e=this;var c=this.$elem.closest(".page");if(c.length){this.options.target=c.parent()}if(this.options.target){var d=b(this.options.target)[0].offsetTop;if(!this.options.offsetTop){this.options.offsetTop=d}this.options.maxHeightOffset+=d}else{this.options.target=b(window)}this.$elem.css("max-height",window.innerHeight-this.options.maxHeightOffset);b(window).off("resize.affix").on("resize.affix",function(f){e.$elem.css("max-height",window.innerHeight-e.options.maxHeightOffset);e.updatePosition(e.getStatus())});this.offset={};if(this.options.offsetTop==null&&this.options.offsetBottom==null){this.options.offsetTop=0}this.offset=this.elem.getBoundingClientRect();this.status=this.getStatus();if(this.status!="none"){this.updatePosition(this.status)}this.options.target.on("scroll.affix",function(){var f=e.getStatus();if(e.status!=f){e.updatePosition(f)}})},getStatus:function(){var c=this.options.target.scrollTop();if(this.options.offsetTop!=null&&c>(this.offset.top-this.options.offsetTop)){return"top"}else{if(this.options.offsetBottom!=null&&c<this.options.offsetBottom+this.offset.bottom-window.innerHeight){return"bottom"}else{return"none"}}},updatePosition:function(d){var c=this.$elem.height();var f=this.$elem.width();switch(d){case"top":var e={height:c,width:f,top:this.options.offsetTop};this.$elem.addClass("affix").css(e);this.$elem.parent().css({height:c,width:f});this.status="top";break;case"bottom":var e={height:c,width:f,bottom:this.options.offsetBottom};this.$elem.addClass("affix").css("top","").css(e);this.$elem.parent().css({height:c,width:f});this.status="bottom";break;case"none":this.$elem.removeClass("affix").css("top","").css("bottom","").css("height","").css("width","");this.$elem.parent().css("height","").css("width","");this.status="none";break;default:break}}});b.fn.affix=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.affix.constructor=a;a.DEFAULTS={offsetTop:null,offsetBottom:null,maxHeightOffset:0}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){var c=this;this.$elem.on("click",function(d){if(c.options.disabled){return}c.check(!c.options.checked);if(c.opts.onClick){return c.exec(c.opts.onClick,[d,c.options.checked])}})},isChecked:function(){return this.options.checked},setDisabled:function(d){var c=typeof d==="boolean"?d:!this.opts.disabled;this.$elem.toggleClass("disabled",c);this.opts.disabled=c;return this},check:function(c){this.options.checked=c;if(c){this.$elem.find(".ez-switch-inner").text(this.options.checkedText);this.$elem.addClass("ez-switch-checked")}else{this.$elem.find(".ez-switch-inner").text(this.options.unCheckedText);this.$elem.removeClass("ez-switch-checked")}this.change(c)},change:function(c){this.exec(this.opts.onChange,[c])}});b.fn.Switch=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.Switch.constructor=a;a.DEFAULTS={checked:false,checkedText:null,disabled:false,onClick:null,onChange:null,unCheckedText:null}}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){if(this.options.formatter){var c=this.exec(this.options.formatter,[this.options.value]);this.$elem.find(".ez-statistic-content-value").html(c)}},updateValue:function(c){this.options.value=c;if(Number.isNaN(c)){this.$elem.find(".ez-statistic-content-value").html(c)}else{this.$elem.find(".ez-statistic-content-value").html(sprintf("<span class='ez-statistic-content-value-int'>%s</span>",c))}}});b.fn.statistic=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.statistic.constructor=a;a.DEFAULTS={formatter:null,value:0}}(window.jQuery);!function(b){var a=b.fn.textInput.constructor.extend({initInputViewEdit:function(){var c=this;this.$input=this.$elem.find(".form-control");this.$input.on("change",function(f){var g=b(this).val();g=AppParam.IS_AUTO_TRIM?g.trim():g;g=g==""?null:g;c.setValueWithoutView(g)});var e={items:"all",showHintOnFocus:true,autoSelect:false,selectOnBlur:false,changeInputOnMove:false,appendTo:"body",source:[],valueField:this.options.valueField,textField:this.options.textField};if(this.options.dynamic){e.delay=300}if(this.options.onSelect){e.afterSelect=function(f){c.exec(c.options.onSelect,[f])}}this.$input.typeahead(e);if(this.opts.dataUrl){if(this.options.dynamic){var d=function(f,g){c.load({},g)};this.$input.typeahead("setSource",d)}else{this.load()}}else{if(this.opts.dataContext){this.opts.datas=b.getContextData(this.opts.dataContext)}this.loadData(this.opts.datas)}this.$input.on("show.typeahead",function(){TagUtils.bindScrollEvent(c.$input,"auto-complete"+c.options.tagId,function(){c.hideDropdown()})});b(window).off("resize.autoComplate").on("resize.autoComplate",function(f){b("[data-toggle='autoComplete']").each(function(){get(b(this)).hideDropdown()})})},load:function(c,e){c=b.isPlainObject(c)?c:{dataUrl:c||this.opts.dataUrl};b.extend(this.opts,c);var d=this;this.req({url:this.opts.dataUrl,onBeforeLoad:function(f){f.query=d.$input.val();return d.exec(d.opts.onBeforeLoad,[f])},onLoadSuccess:function(f){if(e){e(f)}else{d.loadData(f);d.exec(d.opts.onLoadSuccess,[f])}}});return this},loadData:function(c){this.options.datas=c;var e=c;var d=this;if(this.options.onSearch){e=function(f,g){g(d.exec(d.opts.onSearch,[f,c]))}}this.$input.typeahead("setSource",e)},hideDropdown:function(){this.$input.typeahead("hide")}});b.fn.autoComplete=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.autoComplete.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseInputTag.constructor.DEFAULTS,{dataUrl:null,dataContext:null,dynamic:false,valueField:"value",textField:null,onSelect:null,onSearch:null,dataDict:null})}(window.jQuery);!function(a){var b=a.fn.baseInputTag.constructor.extend({initInputView:function(){this.$userBadgeList=this.$elem.find(".ez-user-select-list");this.$addBtn=this.$elem.find("button");this.$userSelectNum=this.$elem.find(".ez-user-select-num");var c=this;this.$elem.on("click","button, .user-badge-ellipsis",function(){var e=new Url("sys/userselect/enterSelectUserPage");e.addParam("tagId",c.options.tagId);var d=[];for(var f=0;f<c.options.selectTypes.length;f++){d.push({target:c.options.selectTypes[f].target})}e.addParam("selectTypes",d);a.openDialog({title:"添加用户",url:e,width:TagConstant.DialogWidth.LONG,buttons:[{text:"确定",onClick:function(){setUserIds()}}]})});this.$elem.on("click",".user-badge .badge-close-btn",function(){if(c.isDisabled()||c.isReadonly()){return false}var f=a(this).closest(".badge");if(f.length){f.tooltip("destroy");var d=f.data("id");if(d){var e=c.getTypeValue();e.remove(d);c.setValue(e)}}})},trans2InpValue:function(j){j=TagUtils.strToArray(j);var d=j.length;if(d){var g=this.options;for(var h=0;h<d;h++){var e=j[h];if(!(e in g.data)){var f=new Url(g.dataUrl);f.addObjectParam("userIds",j);var c=a.req({url:f,async:false,context:this});g.data=this._initUserMap(c);break}}}return j},_initUserMap:function(c){var d={};if(a.isArray(c)){for(var e=0;e<c.length;e++){d[c[e].userId]=c[e]}}return d},_addUserInfo:function(d,c){if(!(d in this.options.data)){this.options.data[d]=c}},getValue:function(){var c=this.getTypeValue();return TagUtils.arrayToStr(c)},getText:function(){var d=this.getTypeValue();var h=[];var c=this.options.data;for(var e=0;e<d.length;e++){var g=d[e];var f=c[g].userName;h.push(f)}return h.join(",")},setInputValue:function(c){this.$userBadgeList.find(">.user-badge").remove();this.$userSelectNum.text("已选择"+c.length+"人");this.$userBadgeList.prepend(this.createUserBadge(c));this.$userBadgeList.find(".user-badge").each(function(){var f=a(this).data("userName");var e=a(this).data("loginId");a(this).tooltip({title:f+"（"+e+"）"})});var d=this.$userBadgeList.find(".user-badge-ellipsis");if(d.length){d.tooltip({title:"查看更多"})}},setTextValue:function(c){c=this.getText();this._super(c)},createUserBadge:function(h){var g=createTag("");if(h.length){var e=this.options.data;for(var f=0;f<h.length;f++){var d=e[h[f]];if(d){var c=TagUtils.createBadge({cls:"user-badge",text:d.userName,data:{id:d.userId,userName:d.userName,loginId:d.loginId}}).appendTo(g);if(!this.isPureText()){createTag("span").addClass("badge-close-btn").append("×").appendTo(c)}if(f>20){createTag("span").addClass("user-badge-ellipsis").append("...").appendTo(g);break}}}}return g.toString()},getUserBadge:function(d){var c=TagUtils.createBadge({cls:"user-badge",text:d.userName,data:{id:d.userId,}});if(!this.isPureText()){createTag("span").addClass("badge-close-btn").append("×").appendTo(c)}return c},getInput:function(){return this.$userBadgeList},getTooltipTarget:function(){return this.$userBadgeList},_extraValidate:function(h){var d=true;var g=this.options;h=this.getTypeValue();var f=h.length,e=g.min,c=g.max;if(e!=null&&e>f){d=sprintf(g.minOptionsText,e)}if(d==true&&c!=null&&c<f){d=sprintf(g.maxOptionsText,c)}if(d===true){d=this._super(h)}return d},_readonly:function(c){this._disable(c)},_disable:function(c){this.$userBadgeList.toggleClass("disable");get(this.$addBtn).setDisabled(c)},getTypeValue:function(){return this.options.value.concat()}});a.fn.userSelect=function(c,d){return a.fn.baseTag.apply(this,[c,d,b])};a.fn.userSelect.constructor=b;b.DEFAULTS=a.extend({},a.fn.baseInputTag.constructor.DEFAULTS,{dataUrl:"sys/userselect/listUserName",data:{},min:null,max:null,minOptionsText:"至少选择%s个用户",maxOptionsText:"最多选择%s个用户",selectTypes:[{target:"全部用户",url:"sys/userselect/enterSelectUserTable",userIdField:"userId",loginIdField:"loginId",userNameField:"userName"}]})}(window.jQuery);!function(b){var a=b.fn.baseInputTag.constructor.extend({initInputViewEdit:function(){this.$input=this.$elem.find("input");var c=this;this.$input.tagsInput({delimiter:this.options.separator,disabled:this.options.readonly||this.options.disabled,onChange:function(){var e=b(this).val();var d=c.trans2InpValue(e);if(c.isChange(d,c.getTypeValue())){c.setValueWithoutView(d)}}})},trans2InpValue:function(c){c=TagUtils.strToArray(c,this.options.separator);return c},getValue:function(){var c=this.getTypeValue();return TagUtils.arrayToStr(c,this.options.separator)},getText:function(){return this.getValue()},setInputValue:function(c){this.$input.importTags(TagUtils.arrayToStr(c,this.options.separator)||"")},setTextValue:function(c){this._super(this.getValue()||"-")},validateRequired:function(){var c=this.getTypeValue();return c.length>0},_extraValidate:function(k){var g=true;var c=this.options;var m=this.getTypeValue();var d=m.length;var l=[];for(var f=0;f<d;f++){if(l.contains(m[f])){g=sprintf("【%s】是重复标记，请删除",m[f]);break}l.push(m[f])}var e=c.minTagCount,j=c.maxTagCount;if(e!=null&&e>d){g=sprintf("最少录入%s个标记",e)}if(g==true&&j!=null&&j<d){g=sprintf("最多录入%s个标记",j)}if(g==true&&this.options.maxTagTextLength){for(var f=0;f<d;f++){var n=StringUtils.validate(m[f],"charLength["+this.options.maxTagTextLength+"]");if(!n.isValid){g=sprintf("每个标记最多录入%s字",this.options.maxTagTextLength);break}}}if(g==true&&this.options.maxTextLength){var h=m.join("");var n=StringUtils.validate(h,"charLength["+this.options.maxTextLength+"]");if(!n.isValid){g=sprintf("全部标记最多录入%s字",this.options.maxTextLength)}}if(g===true){g=this._super(k)}return g},_readonly:function(c){this._disable(c)},_disable:function(c){this.$input.setDisabled(c)},getTypeValue:function(){return this.options.value.concat()},getTooltipTarget:function(){return this.getInput().next()},isChange:function(d,c){d=d.join(",");c=c.join(",");return this._super(d,c)},change:function(d,c){d=TagUtils.arrayToStr(d,this.options.separator);c=TagUtils.arrayToStr(c,this.options.separator);this._super(d,c)}});b.fn.TagsInput=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.TagsInput.constructor=a;a.DEFAULTS=b.extend({},b.fn.baseInputTag.constructor.DEFAULTS,{maxTagCount:null,minTagCount:null,maxTagTextLength:null,maxTextLength:null,separator:","})}(window.jQuery);!function(b){var a=b.fn.baseTag.constructor.extend({initTag:function(){if(this.options.type!=="circle"){return}this._circumference=Math.round(Math.PI*this.options.radius*2);this._incompleteCircle=this.elem.querySelector("circle.incomplete");this._incompleteCircle.style.strokeDasharray=this._circumference;this._completeCircle=this.elem.querySelector("circle.complete");this._completeCircle.style.strokeDasharray=this._circumference;this._progressText=this.elem.querySelector("text");this.updateProgress(this.options.percent)},updateProgress:function(d){if(Number.isNaN(d)||d<0){d=0}var e=this._circumference-(this._circumference*d/100);this._completeCircle.style.strokeDashoffset=e;var c=d%1!==0;if(c){d=d.toFixed(2)}this._progressText.textContent=d+"%"}});b.fn.progress=function(c,d){return b.fn.baseTag.apply(this,[c,d,a])};b.fn.progress.constructor=a;a.DEFAULTS={value:0}}(window.jQuery);